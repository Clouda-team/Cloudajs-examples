function BigInteger(e,t,n){null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function nbi(){return new BigInteger(null)}function am1(e,t,n,r,i,o){for(;--o>=0;){var a=t*this[e++]+n[r]+i;i=Math.floor(a/67108864),n[r++]=67108863&a}return i}function am2(e,t,n,r,i,o){for(var a=32767&t,s=t>>15;--o>=0;){var u=32767&this[e],l=this[e++]>>15,c=s*u+l*a;u=a*u+((32767&c)<<15)+n[r]+(1073741823&i),i=(u>>>30)+(c>>>15)+s*l+(i>>>30),n[r++]=1073741823&u}return i}function am3(e,t,n,r,i,o){for(var a=16383&t,s=t>>14;--o>=0;){var u=16383&this[e],l=this[e++]>>14,c=s*u+l*a;u=a*u+((16383&c)<<14)+n[r]+i,i=(u>>28)+(c>>14)+s*l,n[r++]=268435455&u}return i}function int2char(e){return BI_RM.charAt(e)}function intAt(e,t){var n=BI_RC[e.charCodeAt(t)];return null==n?-1:n}function bnpCopyTo(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function bnpFromInt(e){this.t=1,this.s=0>e?-1:0,e>0?this[0]=e:-1>e?this[0]=e+DV:this.t=0}function nbv(e){var t=nbi();return t.fromInt(e),t}function bnpFromString(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return this.fromRadix(e,t),void 0;n=2}this.t=0,this.s=0;for(var r=e.length,i=!1,o=0;--r>=0;){var a=8==n?255&e[r]:intAt(e,r);0>a?"-"==e.charAt(r)&&(i=!0):(i=!1,0==o?this[this.t++]=a:o+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this[this.t++]=a>>this.DB-o):this[this.t-1]|=a<<o,o+=n,o>=this.DB&&(o-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),i&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n=(1<<t)-1,r,i=!1,o="",a=this.t,s=this.DB-a*this.DB%t;if(a-->0)for(s<this.DB&&(r=this[a]>>s)>0&&(i=!0,o=int2char(r));a>=0;)t>s?(r=(this[a]&(1<<s)-1)<<t-s,r|=this[--a]>>(s+=this.DB-t)):(r=this[a]>>(s-=t)&n,0>=s&&(s+=this.DB,--a)),r>0&&(i=!0),i&&(o+=int2char(r));return i?o:"0"}function bnNegate(){var e=nbi();return BigInteger.ZERO.subTo(this,e),e}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(t=n-e.t,0!=t)return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this[n]-e[n]))return t;return 0}function nbits(e){var t=1,n;return 0!=(n=e>>>16)&&(e=n,t+=16),0!=(n=e>>8)&&(e=n,t+=8),0!=(n=e>>4)&&(e=n,t+=4),0!=(n=e>>2)&&(e=n,t+=2),0!=(n=e>>1)&&(e=n,t+=1),t}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function bnpDRShiftTo(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function bnpLShiftTo(e,t){var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,o=Math.floor(e/this.DB),a=this.s<<n&this.DM,s;for(s=this.t-1;s>=0;--s)t[s+o+1]=this[s]>>r|a,a=(this[s]&i)<<n;for(s=o-1;s>=0;--s)t[s]=0;t[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()}function bnpRShiftTo(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)return t.t=0,void 0;var r=e%this.DB,i=this.DB-r,o=(1<<r)-1;t[0]=this[n]>>r;for(var a=n+1;a<this.t;++a)t[a-n-1]|=(this[a]&o)<<i,t[a-n]=this[a]>>r;r>0&&(t[this.t-n-1]|=(this.s&o)<<i),t.t=this.t-n,t.clamp()}function bnpSubTo(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);i>n;)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=0>r?-1:0,-1>r?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function bnpMultiplyTo(e,t){var n=this.abs(),r=e.abs(),i=n.t;for(t.t=i+r.t;--i>=0;)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&BigInteger.ZERO.subTo(t,t)}function bnpSquareTo(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function bnpDivRemTo(e,t,n){var r=e.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)return null!=t&&t.fromInt(0),null!=n&&this.copyTo(n),void 0;null==n&&(n=nbi());var o=nbi(),a=this.s,s=e.s,u=this.DB-nbits(r[r.t-1]);u>0?(r.lShiftTo(u,o),i.lShiftTo(u,n)):(r.copyTo(o),i.copyTo(n));var l=o.t,c=o[l-1];if(0!=c){var d=c*(1<<this.F1)+(l>1?o[l-2]>>this.F2:0),f=this.FV/d,p=(1<<this.F1)/d,h=1<<this.F2,g=n.t,_=g-l,m=null==t?nbi():t;for(o.dlShiftTo(_,m),n.compareTo(m)>=0&&(n[n.t++]=1,n.subTo(m,n)),BigInteger.ONE.dlShiftTo(l,m),m.subTo(o,o);o.t<l;)o[o.t++]=0;for(;--_>=0;){var v=n[--g]==c?this.DM:Math.floor(n[g]*f+(n[g-1]+h)*p);if((n[g]+=o.am(0,v,n,_,0,l))<v)for(o.dlShiftTo(_,m),n.subTo(m,n);n[g]<--v;)n.subTo(m,n)}null!=t&&(n.drShiftTo(l,t),a!=s&&BigInteger.ZERO.subTo(t,t)),n.t=l,n.clamp(),u>0&&n.rShiftTo(u,n),0>a&&BigInteger.ZERO.subTo(n,n)}}}function bnMod(e){var t=nbi();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(BigInteger.ZERO)>0&&e.subTo(t,t),t}function Classic(e){this.m=e}function cConvert(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function cRevert(e){return e}function cReduce(e){e.divRemTo(this.m,null,e)}function cMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function cSqrTo(e,t){e.squareTo(t),this.reduce(t)}function bnpInvDigit(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return t=15&t*(2-(15&e)*t),t=255&t*(2-(255&e)*t),t=65535&t*(2-(65535&(65535&e)*t)),t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function Montgomery(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function montConvert(e){var t=nbi();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(BigInteger.ZERO)>0&&this.m.subTo(t,t),t}function montRevert(e){var t=nbi();return e.copyTo(t),this.reduce(t),t}function montReduce(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function montSqrTo(e,t){e.squareTo(t),this.reduce(t)}function montMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnpIsEven(){return 0==(this.t>0?1&this[0]:this.s)}function bnpExp(e,t){if(e>4294967295||1>e)return BigInteger.ONE;var n=nbi(),r=nbi(),i=t.convert(this),o=nbits(e)-1;for(i.copyTo(n);--o>=0;)if(t.sqrTo(n,r),(e&1<<o)>0)t.mulTo(r,i,n);else{var a=n;n=r,r=a}return t.revert(n)}function bnModPowInt(e,t){var n;return n=256>e||t.isEven()?new Classic(t):new Montgomery(t),this.exp(e,n)}function Arcfour(){this.i=0,this.j=0,this.S=new Array}function ARC4init(e){var t,n,r;for(t=0;256>t;++t)this.S[t]=t;for(n=0,t=0;256>t;++t)n=255&n+this.S[t]+e[t%e.length],r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0}function ARC4next(){var e;return this.i=255&this.i+1,this.j=255&this.j+this.S[this.i],e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[255&e+this.S[this.i]]}function prng_newstate(){return new Arcfour}function rng_seed_int(e){rng_pool[rng_pptr++]^=255&e,rng_pool[rng_pptr++]^=255&e>>8,rng_pool[rng_pptr++]^=255&e>>16,rng_pool[rng_pptr++]^=255&e>>24,rng_pptr>=rng_psize&&(rng_pptr-=rng_psize)}function rng_seed_time(){rng_seed_int((new Date).getTime())}function rng_get_byte(){if(null==rng_state){for(rng_seed_time(),rng_state=prng_newstate(),rng_state.init(rng_pool),rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(e){var t;for(t=0;t<e.length;++t)e[t]=rng_get_byte()}function SecureRandom(){}function parseBigInt(e,t){return new BigInteger(e,t)}function linebrk(e,t){for(var n="",r=0;r+t<e.length;)n+=e.substring(r,r+t)+"\n",r+=t;return n+e.substring(r,e.length)}function byte2Hex(e){return 16>e?"0"+e.toString(16):e.toString(16)}function pkcs1pad2(e,t){if(t<e.length+11)return console.log("Message too long for RSA"),null;for(var n=new Array,r=e.length-1;r>=0&&t>0;){var i=e.charCodeAt(r--);128>i?n[--t]=i:i>127&&2048>i?(n[--t]=128|63&i,n[--t]=192|i>>6):(n[--t]=128|63&i,n[--t]=128|63&i>>6,n[--t]=224|i>>12)}n[--t]=0;for(var o=new SecureRandom,a=new Array;t>2;){for(a[0]=0;0==a[0];)o.nextBytes(a);n[--t]=a[0]}return n[--t]=2,n[--t]=0,new BigInteger(n)}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(e,t){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16)):console.log("Invalid RSA public key")}function RSADoPublic(e){return e.modPowInt(this.e,this.n)}function RSAEncrypt(e){var t=pkcs1pad2(e,this.n.bitLength()+7>>3);if(null==t)return null;var n=this.doPublic(t);if(null==n)return null;var r=n.toString(16);return 0==(1&r.length)?r:"0"+r}function bnClone(){var e=nbi();return this.copyTo(e),e}function bnIntValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16}function bnpChunkSize(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function bnpToRadix(e){if(null==e&&(e=10),0==this.signum()||2>e||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=nbv(n),i=nbi(),o=nbi(),a="";for(this.divRemTo(r,i,o);i.signum()>0;)a=(n+o.intValue()).toString(e).substr(1)+a,i.divRemTo(r,i,o);return o.intValue().toString(e)+a}function bnpFromRadix(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,o=0,a=0,s=0;s<e.length;++s){var u=intAt(e,s);0>u?"-"==e.charAt(s)&&0==this.signum()&&(i=!0):(a=t*a+u,++o>=n&&(this.dMultiply(r),this.dAddOffset(a,0),o=0,a=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(a,0)),i&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(e,t,n){if("number"==typeof t)if(2>e)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(e-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(BigInteger.ONE.shiftLeft(e-1),this);else{var r=new Array,i=7&e;r.length=(e>>3)+1,t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}}function bnToByteArray(){var e=this.t,t=new Array;t[0]=this.s;var n=this.DB-e*this.DB%8,r,i=0;if(e-->0)for(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)8>n?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=255&this[e]>>(n-=8),0>=n&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t}function bnEquals(e){return 0==this.compareTo(e)}function bnMin(e){return this.compareTo(e)<0?this:e}function bnMax(e){return this.compareTo(e)>0?this:e}function bnpBitwiseTo(e,t,n){var r,i,o=Math.min(e.t,this.t);for(r=0;o>r;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){for(i=e.s&this.DM,r=o;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=o;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function op_and(e,t){return e&t}function bnAnd(e){var t=nbi();return this.bitwiseTo(e,op_and,t),t}function op_or(e,t){return e|t}function bnOr(e){var t=nbi();return this.bitwiseTo(e,op_or,t),t}function op_xor(e,t){return e^t}function bnXor(e){var t=nbi();return this.bitwiseTo(e,op_xor,t),t}function op_andnot(e,t){return e&~t}function bnAndNot(e){var t=nbi();return this.bitwiseTo(e,op_andnot,t),t}function bnNot(){for(var e=nbi(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function bnShiftLeft(e){var t=nbi();return 0>e?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function bnShiftRight(e){var t=nbi();return 0>e?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function lbit(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function bnGetLowestSetBit(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+lbit(this[e]);return this.s<0?this.t*this.DB:-1}function cbit(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function bnBitCount(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=cbit(this[n]^t);return e}function bnTestBit(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)}function bnpChangeBit(e,t){var n=BigInteger.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function bnSetBit(e){return this.changeBit(e,op_or)}function bnClearBit(e){return this.changeBit(e,op_andnot)}function bnFlipBit(e){return this.changeBit(e,op_xor)}function bnpAddTo(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);i>n;)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=0>r?-1:0,r>0?t[n++]=r:-1>r&&(t[n++]=this.DV+r),t.t=n,t.clamp()}function bnAdd(e){var t=nbi();return this.addTo(e,t),t}function bnSubtract(e){var t=nbi();return this.subTo(e,t),t}function bnMultiply(e){var t=nbi();return this.multiplyTo(e,t),t}function bnSquare(){var e=nbi();return this.squareTo(e),e}function bnDivide(e){var t=nbi();return this.divRemTo(e,t,null),t}function bnRemainder(e){var t=nbi();return this.divRemTo(e,null,t),t}function bnDivideAndRemainder(e){var t=nbi(),n=nbi();return this.divRemTo(e,t,n),new Array(t,n)}function bnpDMultiply(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}}function NullExp(){}function nNop(e){return e}function nMulTo(e,t,n){e.multiplyTo(t,n)}function nSqrTo(e,t){e.squareTo(t)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(e,t,n){var r=Math.min(this.t+e.t,t);for(n.s=0,n.t=r;r>0;)n[--r]=0;var i;for(i=n.t-this.t;i>r;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);i>r;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}function bnpMultiplyUpperTo(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function Barrett(e){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function barrettConvert(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=nbi();return e.copyTo(t),this.reduce(t),t}function barrettRevert(e){return e}function barrettReduce(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function barrettSqrTo(e,t){e.squareTo(t),this.reduce(t)}function barrettMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnModPow(e,t){var n=e.bitLength(),r,i=nbv(1),o;if(0>=n)return i;r=18>n?1:48>n?3:144>n?4:768>n?5:6,o=8>n?new Classic(t):t.isEven()?new Barrett(t):new Montgomery(t);var a=new Array,s=3,u=r-1,l=(1<<r)-1;if(a[1]=o.convert(this),r>1){var c=nbi();for(o.sqrTo(a[1],c);l>=s;)a[s]=nbi(),o.mulTo(c,a[s-2],a[s]),s+=2}var d=e.t-1,f,p=!0,h=nbi(),g;for(n=nbits(e[d])-1;d>=0;){for(n>=u?f=e[d]>>n-u&l:(f=(e[d]&(1<<n+1)-1)<<u-n,d>0&&(f|=e[d-1]>>this.DB+n-u)),s=r;0==(1&f);)f>>=1,--s;if((n-=s)<0&&(n+=this.DB,--d),p)a[f].copyTo(i),p=!1;else{for(;s>1;)o.sqrTo(i,h),o.sqrTo(h,i),s-=2;s>0?o.sqrTo(i,h):(g=i,i=h,h=g),o.mulTo(h,a[f],i)}for(;d>=0&&0==(e[d]&1<<n);)o.sqrTo(i,h),g=i,i=h,h=g,--n<0&&(n=this.DB-1,--d)}return o.revert(i)}function bnGCD(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),o=n.getLowestSetBit();if(0>o)return t;for(o>i&&(o=i),o>0&&(t.rShiftTo(o,t),n.rShiftTo(o,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return o>0&&n.lShiftTo(o,n),n}function bnpModInt(e){if(0>=e)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function bnModInverse(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return BigInteger.ZERO;for(var n=e.clone(),r=this.clone(),i=nbv(1),o=nbv(0),a=nbv(0),s=nbv(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(i.isEven()&&o.isEven()||(i.addTo(this,i),o.subTo(e,o)),i.rShiftTo(1,i)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;r.isEven();)r.rShiftTo(1,r),t?(a.isEven()&&s.isEven()||(a.addTo(this,a),s.subTo(e,s)),a.rShiftTo(1,a)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(a,i),o.subTo(s,o)):(r.subTo(n,r),t&&a.subTo(i,a),s.subTo(o,s))}return 0!=r.compareTo(BigInteger.ONE)?BigInteger.ZERO:s.compareTo(e)>=0?s.subtract(e):s.signum()<0?(s.addTo(e,s),s.signum()<0?s.add(e):s):s}function bnIsProbablePrime(e){var t,n=this.abs();if(1==n.t&&n[0]<=lowprimes[lowprimes.length-1]){for(t=0;t<lowprimes.length;++t)if(n[0]==lowprimes[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<lowprimes.length;){for(var r=lowprimes[t],i=t+1;i<lowprimes.length&&lplim>r;)r*=lowprimes[i++];for(r=n.modInt(r);i>t;)if(0==r%lowprimes[t++])return!1}return n.millerRabin(e)}function bnpMillerRabin(e){var t=this.subtract(BigInteger.ONE),n=t.getLowestSetBit();if(0>=n)return!1;var r=t.shiftRight(n);e=e+1>>1,e>lowprimes.length&&(e=lowprimes.length);for(var i=nbi(),o=0;e>o;++o){i.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var a=i.modPow(r,this);if(0!=a.compareTo(BigInteger.ONE)&&0!=a.compareTo(t)){for(var s=1;s++<n&&0!=a.compareTo(t);)if(a=a.modPowInt(2,this),0==a.compareTo(BigInteger.ONE))return!1;if(0!=a.compareTo(t))return!1}}return!0}function pkcs1unpad2(e,t){for(var n=e.toByteArray(),r=0;r<n.length&&0==n[r];)++r;if(n.length-r!=t-1||2!=n[r])return null;for(++r;0!=n[r];)if(++r>=n.length)return null;for(var i="";++r<n.length;){var o=255&n[r];128>o?i+=String.fromCharCode(o):o>191&&224>o?(i+=String.fromCharCode((31&o)<<6|63&n[r+1]),++r):(i+=String.fromCharCode((15&o)<<12|(63&n[r+1])<<6|63&n[r+2]),r+=2)}return i}function RSASetPrivate(e,t,n){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16)):console.log("Invalid RSA private key")}function RSASetPrivateEx(e,t,n,r,i,o,a,s){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16),this.p=parseBigInt(r,16),this.q=parseBigInt(i,16),this.dmp1=parseBigInt(o,16),this.dmq1=parseBigInt(a,16),this.coeff=parseBigInt(s,16)):console.log("Invalid RSA private key")}function RSAGenerate(e,t){var n=new SecureRandom,r=e>>1;this.e=parseInt(t,16);for(var i=new BigInteger(t,16);;){for(;this.p=new BigInteger(e-r,1,n),0!=this.p.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(r,1,n),0!=this.q.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var o=this.p;this.p=this.q,this.q=o}var a=this.p.subtract(BigInteger.ONE),s=this.q.subtract(BigInteger.ONE),u=a.multiply(s);if(0==u.gcd(i).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=i.modInverse(u),this.dmp1=this.d.mod(a),this.dmq1=this.d.mod(s),this.coeff=this.q.modInverse(this.p);break}}}function RSADoPrivate(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(n)<0;)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}function RSADecrypt(e){var t=parseBigInt(e,16),n=this.doPrivate(t);return null==n?null:pkcs1unpad2(n,this.n.bitLength()+7>>3)}var SUMERU_APP_FW_DEBUG=!1;!function(e,t){var n="NAMESPACE",r="sumeru_AppFW",i={},o=!1,a=function(e,t){Library.net.get({url:e,callback:function(e){var n={};new Function("exports",e).call(null,n),t&&t(n)}})},s=function(e){function t(){}var r,o={};return Object.create?r=Object.create(o):(t.prototype=o,r=new t,r.__getPrototypeof=function(){return o}),r.__namespace=n,r.__isSeal=!1,r.__require=function(e,t,n){a(e,function(e){t&&t(e),n&&r.__reg(n,e)})},r.__runTraps=function(t){var n=i[e].traps[t];n&&n.length>0&&n.forEach(function(e){e(r[t])})},r.__reg=function(e,t,n){return n?r[e]=t:o[e]=t,r.__runTraps(e),t},r.__regAsync=function(e,t){return function(n){t?r[e]=n:o[e]=n,r.__runTraps(e)}},r.__load=function(e){return r[e]},r.__loadAsync=function(t,n){var o;o=i[e].traps[t]?i[e].traps[t]:i[e].traps[t]=[],o.push(n),void 0!==r[t]&&n(r[t])},r.addSubPackage=function(t){var n=e+"."+t;if(i[e].isSeal)throw'package ["'+e+'"] has sealed.';if(i[n])throw'package ["'+n+'"] already exists';return o[t]=s(n),i[n]={spaceObj:r[t],isSeal:!1,traps:{}},o[t]},r.__clear=function(){var t;if(!i[e].isSeal){for(var a in o)t=o[a],t.__namespace===n&&(t.__clear(),o[a]=Object.getPrototypeOf?Object.getPrototypeOf(t):t.__getPrototypeof(),r[a]=t);i[e].isSeal=!0}},r};if(o=e[t],e[t]=s(r),i[r]={spaceObj:e[t],isSeal:!1,traps:{}},o)for(var u in o)e[t].__reg([u],o[u]);e[t].clear=function(){e[t].__clear(),e[t].seal=void 0,delete e[t].seal,e[t]=Object.getPrototypeOf(e[t])},"undefined"!=typeof module&&module.exports&&(GLOBAL[t]=e[t],module.exports=function(){return e[t]}),SUMERU_APP_FW_DEBUG&&(e.DEBUG_PKG_MAPPING=i,e[t].__reg("SUMERU_APP_FW_DEBUG",!0))}(this,"sumeru");var Run_UnitTest_PKG=function(){var e=sumeru;a=fw.addSubPackage("a"),b=a.addSubPackage("b"),a.__loadAsync("name",function(e){console.log("fire trap...fw.a.name : "+e)}),b.__loadAsync("name",function(e){console.log("fire trap...fw.b.name : "+e)}),fw.a.b.__reg("age",100,!0),b.__loadAsync("age",function(e){console.log("fire trap...fw.b.age : "+e)});var t=a.__regAsync("name"),n=fw.a.b.__regAsync("name");setTimeout(function(){t("package fw.a"),n("package fw.a.b");for(var e=100;110>e;e++)n("name _ "+e);console.log(a.b.age),console.log(fw.a.b.age),console.log("async done...")},1e3),fw.clear(),console.log(void 0===fw.a.b.age),console.log(100===e.a.b.age),console.log(void 0===fw.addSubPackage),console.log(void 0===fw.a.addSubPackage),console.log(void 0===fw.a.b.addSubPackage),console.log(void 0===a.addSubPackage),console.log(void 0===b.addSubPackage)},_log=function(){console&&console.log.apply(this,arguments)},logTrace_level=1,configLogTrace=function(e){logTrace_level=e},getLogTrace=function(e){if(0==logTrace_level)return"";if(sumeru.IS_SUMERU_SERVER&&logTrace_level&!1)return"";if(!sumeru.IS_SUMERU_SERVER&&logTrace_level&!1)return"";var t="",n="";try{throw new Error}catch(r){t=r.stack.split("\n")}return n="Error"==t[0]?t[3]:t[2]},arrPush=Array.prototype.push,runnable=function(e){var t=e.SUMERU_APP_FW_DEBUG||!1,n={log:function(){arrPush.call(arguments,getLogTrace(arguments.callee)),_log.apply(console,arguments)},dev:function(){t!==!1&&(arrPush.call(arguments,getLogTrace(arguments.callee)),_log.apply(console,arguments))}};e.__reg("log",n.log),e.__reg("dev",n.dev),e.__reg("ConfigLogTrace",configLogTrace);var r={};return e.__reg("logtimeclear",function(e){delete r[e]}),e.__reg("logtime",function(e,t){if("string"!=typeof e||null===e.match(/\w{11}/))return console.log(e,t),void 0;var n=0;r[e]&&(n=(new Date).getTime()-r[e]),r[e]=(new Date).getTime(),_log("["+e+"] ["+n+"]"+t)}),e.__reg("logerror",function(){arguments[0]=formatDate()+arguments[0],console&&console.error.apply(this,arguments)}),n};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){function t(e){s(e).forEach(function(t){this[t]=e[t]},this)}if(e.utils)return e.utils;var n=e.addSubPackage("utils"),r=Array.prototype.splice,i=Array.prototype.concat,o=Array.isArray,a=function(e){return r.apply(e,r.call(arguments,1))},s=Object.keys,u=function(e){return i.apply(a(e,0),a(arguments,1))},l=n.__reg("cpp",function(e){var n=a(arguments,1);return n.forEach(t,e),e}),c=n.__reg("extendFrom",function(e,t){var n=null,r=function(){};return Object.create?n=Object.create(e):(r.prototype=e,n=new r),l(n,t)}),d=n.__reg("getProxy",function(e,t){var n={};return t.forEach(function(e){var t=this;n[e]=function(){if(t[e]instanceof Function)return t[e].apply(t,arguments);throw e+" is not a function"}},e),n}),f=n.__reg("cleanObj",function(e,t){var n=Object.keys(e);n.forEach(function(e){try{"isDestroy"!=e&&(t&&t(this[e]),"array"==typeof this[e]&&(this[e].length=0),delete this[e])}catch(n){}},e)}),p=n.__reg("encodeURIComponentFull",function(e){var t=encodeURIComponent(e);return t=t.replace(/!/g,"%21"),t=t.replace(/\*/g,"%2A"),t=t.replace(/'/g,"%27"),t=t.replace(/\(/g,"%28"),t=t.replace(/\)/g,"%29"),t=t.replace(/\./g,"%2E"),t=t.replace(/\-/g,"%2D"),t=t.replace(/\_/g,"%5F"),t=t.replace(/\~/g,"%7E")}),h=n.__reg("uriParamToMap",function(e){var t={};if(!e)return t;var n=e.split("&");return n.forEach(function(e){var t=e.split("=");t[0]&&(this[t[0]]=decodeURIComponent(t[1]))},t),t}),g=function(e,t){var n=[];return e.forEach(function(e){n.push(p(e))}),n.join(t)},_=n.__reg("mapToUriParam",function(e){var t=[],n=null;return"object"!=typeof e||Array.isArray(e)?"":(n=Object.keys(e),n.forEach(function(n){var r=e[n];switch(typeof r){case"string":case"number":case"boolean":t.push(n+"="+p(r));case"object":Array.isArray(r)&&t.push(n+"="+g(r));default:return}}),t.join("&"))}),m=n.__reg("randomInt",function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}),v="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ",b=v.length-1;n.__reg("randomStr",function C(e){for(var t="",n=0;e>n;n++)t+=v[m(0,b)];return t});var y=n.__reg("parseJSON",function(e){return new Function("window","document","sumeru","XMLHttpRequest","return "+e+";").call({},void 0,void 0,void 0,void 0)}),S=n.__reg("isSimpleType",function(e){switch(typeof e){case"string":case"number":case"boolean":return!0}return!1}),w=n.__reg("setStyles",function k(e,t){var n=e.style,r="",i=/^(left|top|bottom|right|width|height)$/i;for(var o in t)r=t[o],"number"==typeof t[o]&&i.test(o)&&(r+="px"),n[o]=r;return e});e.utils.__reg("chain",function(e,t){if(!Array.isArray(e))return!1;var n=e[0].length;if(!e.every(function(e){return e instanceof Function&&e.length===n}))return!1;var r=0,i=null;return i=function(){var n=e[r++];if(void 0!==n){var o=u(arguments,i);n.apply(this,o)}else t.apply(this,a(arguments,0))}}),e.utils.__reg("getTimeStamp",function(){return(new Date).valueOf()});var E={};e.__random=function(e){e=e||10;for(var t="qwertyuiopasdfghjklzxcvbnm1234567890",n=t.length,r=e,i="";r--;)i+=t.charAt(Math.floor(Math.random()*n));return E[i]?random(e):(E[i]=1,i)};var T=function(e){if(!e)return e;var t=[Number,String,Boolean],n;if(t.forEach(function(t){e instanceof t&&(n=t(e))}),"undefined"==typeof n)if("[object Array]"===Object.prototype.toString.call(e))n=[],e.forEach(function(e,t,r){n[t]=T(e)});else if("object"==typeof e)if(e.nodeType&&"function"==typeof e.cloneNode)var n=e.cloneNode(!0);else if(e.prototype)n=e;else if(e instanceof Date)n=new Date(e);else{n={};for(var r in e)n[r]=T(e[r])}else n=e;return n};e.utils.__reg("deepClone",T);var I=function(e,t){var n=T(e);for(x in t)"undefined"!=typeof n[x]?!1:n[x]=t[x];return n};e.utils.__reg("merge",I);var M=function(){this._events={}};M.prototype={addEventListener:function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",e,"function"==typeof t.listener?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned){var n;n=this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}return this},on:function(e,t){return this.addEventListener.apply(this,arguments)},once:function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}if("function"!=typeof t)throw new Error(".once only takes instances of Function");var r=this;return n.listener=t,r.on(e,n),this},removeListener:function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[e])return this;var n=this._events[e];if(o(n)){for(var r=-1,i=0,a=n.length;a>i;i++)if(n[i]===t||n[i].listener&&n[i].listener===t){r=i;break}if(0>r)return this;n.splice(r,1),0==n.length&&delete this._events[e]}else(n===t||n.listener&&n.listener===t)&&delete this._events[e];return this},removeAllListeners:function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},emit:function(e){var t=arguments[0];if(!this._events)return!1;var n=this._events[t];if(!n)return!1;if("function"==typeof n){switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(var r=arguments.length,i=new Array(r-1),a=1;r>a;a++)i[a-1]=arguments[a];n.apply(this,i)}return!0}if(o(n)){for(var r=arguments.length,i=new Array(r-1),a=1;r>a;a++)i[a-1]=arguments[a];for(var s=n.slice(),a=0,r=s.length;r>a;a++)s[a].apply(this,i);return!0}return!1}},e.utils.__reg("emitter",M)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){e.event=e.event||{},e.event.domReady=function(e){/complete|loaded|interactive/.test(document.readyState)?e():document.addEventListener("DOMContentLoaded",function(){e()},!1)},e.event.onload=function(e){/complete/.test(document.readyState)?e():window.onload=function(){e()}},e.event.mapEvent=function(e,t){var n=document.querySelector(e);if(n)for(var r in t)"function"==typeof t[r]&&(r=r.split(","),r.forEach(function(e){n.addEventListener(e.trim(),t[r])}))}};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var dbits,canary=0xdeadbeefcafe,j_lm=15715070==(16777215&canary);BigInteger.prototype.am=am3,dbits=28,BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;for(rr="0".charCodeAt(0),vv=0;9>=vv;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),Arcfour.prototype.init=ARC4init,Arcfour.prototype.next=ARC4next;
var rng_psize=256,rng_state,rng_pool,rng_pptr;if(null==rng_pool){rng_pool=new Array,rng_pptr=0;for(var t,z;rng_psize>rng_pptr;)t=Math.floor(65536*Math.random()),rng_pool[rng_pptr++]=t>>>8,rng_pool[rng_pptr++]=255&t;rng_pptr=0,rng_seed_time()}SecureRandom.prototype.nextBytes=rng_get_bytes,RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare,RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt;var runnable=function(e,t,n){var r={e:"3"};e.addSubPackage("myrsa");var i=function(e,t){var n=new RSAKey,i="";n.setPublic(t,r.e);var o=n.encrypt(e);return o&&(o=linebrk(o,64)),o},o=function(e){var t=new RSAKey;if(0==e.length)return e;t.setPrivateEx(r.n,r.e,r.d,r.p,r.q,r.dmp1,r.dmq1,r.coeff);var n=t.decrypt(e);return n&&(n=n),n},a=function(e,t){if("string"!=typeof e||!d())return console.log("RSA encrypt canceled",e),e;if(!r.pk2&&"undefined"==typeof t)return console.log("pk2 没传入，rsa加密不启用"),e;t="string"==typeof t?t:r.pk2;for(var n=[],o=0,a=e.length;a>o;o+=5)n.push(i(e.substr(o,5),t));return n.join("|")},s=function(e){if("string"!=typeof e||!d())return console.log("RSA decrypt canceled",e),e;for(var t="",n=e.split("|"),r=0,i=n.length;i>r;r++)t+=o(n[r]);return t},u=function(e){var t=new RSAKey;return r.bits="number"==typeof e?e:128,t.generate(parseInt(r.bits),r.e),r.n=linebrk(t.n.toString(16),64),r.d=linebrk(t.d.toString(16),64),r.p=linebrk(t.p.toString(16),64),r.q=linebrk(t.q.toString(16),64),r.dmp1=linebrk(t.dmp1.toString(16),64),r.dmq1=linebrk(t.dmq1.toString(16),64),r.coeff=linebrk(t.coeff.toString(16),64),r},l=function(){return r.n},c=function(e){r.pk2=e},d=function(){return e.config.get("rsa_enable")},f=function(){return r.pk2};"undefined"!=typeof t&&u(),e.myrsa.__reg("encrypt",a,"private"),e.myrsa.__reg("decrypt",s,"private"),e.myrsa.__reg("generate",u,"private"),e.myrsa.__reg("getPk",l,"private"),e.myrsa.__reg("setPk2",c,"private"),e.myrsa.__reg("getPk2",f,"private")};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){if(!e.netMessage){var t=e.addSubPackage("netMessage"),n={0:"onLocalMessage",100:"onError",200:"onMessage",300:"onGlobalError",400:"onGlobalMessage",500:"onLogMessage"},r=Array.prototype.splice,i=e.IS_SUMERU_SERVER,o=Object.create(n),a=null,s=null,u=!1,l=null,c=[],d=[],f=[],p=[],h=function(e){var t=[];return e.forEach(function(e){t.push(e.filter)}),t},g=function(t){var n=null;return n=e.utils.parseJSON(t),void 0===n.number||void 0===n.type||void 0===n.content?!1:n};t.__reg("decodeMessage",g);var _=function(t,n,r){var i={number:n+"",type:null,target:r+"",content:null};return e.utils.isSimpleType(t)?(i.type="simple",i.content=t):(i.type="json",i.content="0"!==n?JSON.stringify(t):t),i};t.__reg("encodeMessage",_);var m=function(e){var t=null;if("0"===e.number)return S(e);if(t=i===!0&&"600"===e.number?l:s,null===t)throw"no output";return Array.prototype.splice.call(arguments,0,1,JSON.stringify(e)),t.apply({},arguments)},v=function(t){return function(n,i){var o=_(n,t,i),a=r.call(arguments,0),s=a[a.length-2];if(0!==p.length){var u=e.utils.chain(p,function(e){a.splice(0,2,e),m.apply({},a)});u(o,s instanceof Function?s:function(){})}else a.splice(0,2,o),m.apply({},a)}},b=function(){var e;for(var n in o)e=o[n],e="send"+e.substr(2),t.__reg(e,v(n));u=!0},y=function(e,t){return e.order<t.order};t.__reg("addInFilter",function(t,n){var r=2==t.length?function(n,r,i){var o=null;try{o=t(n,r)}catch(a){return e.log(a),void 0}i(o,r)}:t;c.push({filter:r,order:void 0===n?Number.MIN_VALUE:n}),c.sort(y),d=h(c)},!1),t.__reg("addOutFilter",function(e,t){var n=1==e.length?function(t,n,r){var i=null;try{i=e(t)}catch(o){n(o)}r(i,n)}:e;f.push({filter:n,order:void 0===t?Number.MIN_VALUE:t}),f.sort(y),p=h(f)},!1),t.__reg("onData",function(t,n){var r=null;try{r=g(t)}catch(o){throw"Server : "+t}if(i&&e.SUMERU_APP_FW_DEBUG===!1)try{S(r,n)}catch(o){console.error(o)}else S(r,n)},!1),t.__reg("addACL",function(e,t){var r=t;0!==t.indexOf("on")&&(r="on"+t.substr(0,1).toUpperCase()+t.substr(1)),void 0===n[e]&&(o[e]=r,b())},!1),t.__reg("setOutput",function(e){if(!(e instanceof Function))throw"__output is not a function.";s=e},!1),i&&(n["600"]="onS2SMessage",t.__reg("setOutputToServer",function(e){if(!(e instanceof Function))throw"__output is not a function.";l=e})),t.__reg("setReceiver",function(e){a=a||{};var t,n,r,i,s,l=!1;for(var c in o)if(t=o[c],s=e[t],void 0!==s){if(s instanceof Function)n="",r=s;else{if(n=s.target||"",l=!!s.overwrite,!(r=s.handle)instanceof Function)continue;r.once=!!s.once}i=a[t]=a[t]||{},Array.isArray(n)?n.forEach(function(e){l!==!0&&this[e]?Array.isArray(this[e])===!0&&this[e].push(r):this[e]=[r]},i):l!==!0&&i[n]?Array.isArray(i[n])===!0&&i[n].push(r):i[n]=[r]}Object.keys(o).forEach(function(e){this[o[e]]instanceof Function&&(a[o[e]]=this[o[e]])},e),0==u&&b()},!1);var S=function(t,n){var r=null,i=null,s=!1,u=null;if(null===a)throw"no receiver";if(void 0===t.number)return!1;if(void 0===(r=o[t.number]))return e.log("unidentifiable message number"),!1;if(void 0===a[r])return e.log("no receiver found"),!1;if(i=a[r][t.target||""],void 0===i&&""!==t.target&&(i=a[r][""],void 0===i))return!1;var l=function(){u="json"==t.type&&"0"!==t.number?e.utils.parseJSON(t.content):t.content;var o=[];if(i.forEach(function(e,r){e instanceof Function&&(s=s||e(u,t.target,n)),e.once&&o.push(r)}),o.length>0)if(o.length==i.length)i.length=0,delete a[r][t.target||""];else for(var l=void 0;void 0!==(l=o.pop());)i.splice(l,1);return s===!1&&"100"==t.number?(t.number="300",S(t,n)):s===!1&&"200"==t.number?(t.number="400",S(t,n)):void 0};if(0!==d.length){var c=e.utils.chain(d,l);c(t,n)}else l()};return e.dev("runing [NetMessage] in "+(e.IS_SUMERU_SERVER?"server":"client")),t}};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){!function(e){if(e.sense)return e.sense;var t=e.addSubPackage("sense");t.__reg("runSenseContext",function(e){t.__reg("_senseInspector",function(t,n){t.addObserver(n,e)},!0),e(),t.__reg("_senseInspector",function(){},!0)});var n={get:function(e){return t._senseInspector&&t._senseInspector(this,e),"object"!=typeof this.container?(console.warn("no container error in sense get on line 38 "+e),void 0):this.container[e]},set:function(e,t){if(this.container[e]=t,0!=this.observer.length)for(var n=0,r=this.observer.length;r>n;n++)this.observer[n].key!=e||this.toBeCommited.some(function(e){return e(this.observer[n])},this)||this.toBeCommited.push(function(t,n){return function(r){return 0!==arguments.length?r==n:(n.customClosure.call(t,e),void 0)}}(this,this.observer[n]))},commit:function(){var t=this.toBeCommited;if(0===t.length)return!0;var n=[];e.controller.__reg("_tapped_blocks",n,!0);for(var r=0,i=t.length;i>r;r++)t[r]();e.controller.__load("reactiveRender")(n),t.length=0},addObserver:function(e,t){for(var n=0,r=this.observer.length;r>n;n++)if(this.observer[n].key===e&&this.observer[n].customClosure==t)return;this.observer.push({key:e,customClosure:t})},removeObserver:function(e){for(var t=0,n=this.observer.length;n>t;t++)if(this.observer[t].customClosure===e)return this.observer.splice(t,1),void 0},cleanObserver:function(){this.observer.length=0,this.toBeCommited.length=0}};t.__reg("extend",function(t,r){var i=function(){return function(){this.toBeCommited=[],this.observer=[],this.container={},t.apply(this,arguments)}}(t);return i.prototype=e.utils.cpp(r||t.prototype,n),i})}(e)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){var t=e.addSubPackage("session"),n={},r={},i=e.utils.parseJSON,o=function(e){return JSON.parse(JSON.stringify(resumeObj))},a=e.utils.isSimpleType,s,u,l,c=e.sense.extend(function(e){this.__identifier=e,this.__hashKey=[],this.__snapshot={},this.__getId=function(){return e}});s=c.prototype.get,u=c.prototype.set,l=c.prototype.commit,c.prototype.get=function(e){return function(){return e.apply(this,arguments)}}(s),c.prototype.getContainer=function(){return this.container},c.prototype.set=function(e){return function(t,n){return e.call(this,t,n)}}(u),c.prototype.setIfNull=function(e){return function(t,n){if(!this.container.hasOwnProperty(t)){if(!a(n))throw"data type error";return e.call(this,t,n)}}}(u),c.prototype.commit=function(e){return function(){var n={},r=e.apply(this,arguments);return t.serialize(JSON.stringify(this.container),this.__identifier),r}}(l),c.prototype.__unserialize=function(){var e=!1,t=this.__identifier,r=n[t],o,a;if(this.__snapshot[r]&&(o=i(this.__snapshot[r])))this.container=o,e=!0;else if(""!==r&&null!=r){this.container={};for(var s in a=i(r))this.set(s,a[s]);e=!0}return e},c.prototype.clean=function(e){this.container={}},t.__reg("create",function(e){var t=null;return(t=r[e])?t:(t=r[e]=new c(e),t.__unserialize(),t)}),t.__reg("destroy",function(t){var i="string"==typeof t?r[t]:t;t=i.__identifier,e.utils.cleanObj(i),r[t]=void 0,n[t]=void 0,delete r[t],delete n[t]}),t.__reg("serialize",function(t){e.router.joinSessionToHash(t)},!0),t.__reg("setResumeNew",function(e,t){var o=e&&i("{"+e+"}")||{};for(var a in o)"{}"==o[a]&&(o[a]=""),n[t]=o[a];var a=t;r[a].__unserialize()&&r[a].commit()},!0),t.__reg("preResume",function(e,o){var a=e&&i("{"+e+"}")||{};for(var s in a)r[s]||t.create(s),"{}"==a[s]&&(a[s]=""),n[s]=a[s];var s=o+"!";r[s].__unserialize()},!0),t.__reg("getSessionByController",function(e){return n[e+"!"]},!0)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var ObjectId=function(){var e=0,t=Math.floor(32767*Math.random()),n=Math.floor(16777216*Math.random());if("undefined"!=typeof localStorage){var r=parseInt(localStorage.mongoMachineId);r>=0&&16777215>=r&&(n=Math.floor(localStorage.mongoMachineId)),localStorage.mongoMachineId=n,document.cookie="mongoMachineId="+n+"; path=/; expires=Tue, 19 Jan 2038 05:00:00 GMT"}else{var i=document.cookie.split("; ");for(var o in i){var a=i[o].split("=");if("mongoMachineId"==a[0]&&a[1]>=0&&a[1]<=16777215){n=a[1];break}}document.cookie="mongoMachineId="+n+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}return function(){return this instanceof ObjectId?("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=n,this.pid=t,e>16777215&&(e=0),this.increment=e++),void 0):new ObjectId(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}}();ObjectId.prototype.getDate=function(){return new Date(1e3*this.timestamp)},ObjectId.prototype.toString=function(){var e=this.timestamp.toString(16),t=this.machine.toString(16),n=this.pid.toString(16),r=this.increment.toString(16);return"00000000".substr(0,6-e.length)+e+"000000".substr(0,6-t.length)+t+"0000".substr(0,4-n.length)+n+"000000".substr(0,6-r.length)+r},sumeru.__reg("__ObjectId",ObjectId,!0),delete ObjectID,App="undefined"!=typeof App?App:{};var runnable=function(e){!function(e){var t=e.sense.extend(function(){}),n=function(){var e=function(){this.configMap={}},n=new t,r=function(){};return r.prototype=n,e.prototype=new r,e.prototype.set=function(){this.define.apply(this,arguments)},e.prototype.get=function(e){return n.get(e),this.configMap[e]},e.prototype.define=function(){var e;if(1==arguments.length)e=arguments[0];else{if(2!=arguments.length)throw new Error("config define error");e={},e[arguments[0]]=arguments[1]}for(var t in e)e.hasOwnProperty(t)&&(n.set(t,e[t]),this.configMap[t]=e[t])},new e},r=function(t){if("undefined"!=typeof t){var i=n(),o=function(){i.set.apply(i,arguments)};return o.defineModule=r,o.config=function(){i.set.apply(i,arguments)},o.get=function(){return i.get.apply(i,arguments)},o.set=function(e,t){i.set.apply(i,arguments)},o.commit=function(){i.commit.apply(i,arguments),"undefined"!=typeof module&&"undefined"!=typeof exports?e.pushUpdateOfConfig(i.configMap):e.netMessage.sendMessage(i.configMap,"config_push",function(e){},function(){})},this[t]=o,o}};r.call(e,"defineConfig"),e.config=e.defineConfig}(e)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),function(e){e.addSubPackage("transition");var t="__viewBlock__",n=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},r=function(e){return document.getElementById(e)},i=function(e){return document.createElement(e)},o=function(e,t){var t=a(e,t);if(0!==t.length){var r=n(e.className).replace(/\s+/g," ").split(" ");r=r.concat(t),e.className=r.join(" ")}},a=function(e,t){"string"==typeof t&&(t=[t]);var n=[];return Array.prototype.forEach.call(t,function(t){var r=new RegExp("( |^)"+t+"( |$)",["i"]);e.className.match(r)||n.push(t)}),n},s=function(e,t){var r=n(e.className).replace(/\s+/g," ").split(" ");if(t instanceof Array)for(var i=0,o=r.length;o>i;i++)t.indexOf(r[i])>-1&&r.splice(i,1);else if(0===t.search("^"))for(var a=new RegExp(t,""),i=0,o=r.length;o>i;i++)r[i]&&r[i].match(a)&&r.splice(i,1);else for(var i=0,o=r.length;o>i;i++)r[i]===t&&r.splice(i,1);e.className=r.join(" ")},u=function(e,t,r){var i=n(e.className).replace(/\s+/g," ").split(" ");if(r instanceof Array)for(var o=0,a=i.length;a>o;o++)r.indexOf(i[o])>-1&&i.splice(o,1);else for(var o=0,a=i.length;a>o;o++)i[o]===r&&i.splice(o,1);i=i.concat(t),e.className=i.join(" ")},l=function(e,t,r){var i=n(e.className).replace(/\s+/g," ").split(" "),o=i.indexOf(t),a=r?i.indexOf(r):-1;o>=0?(i.splice(o,1),r&&i.push(r)):(i.push(t),a>=0&&i.splice(a,1)),e.className=i.join(" ")},c=function(e){e.style.width="100%"},d={push:[1,1,1,1],rotate:[0,1,0,1],fade:[0,0,0,0,2],shake:[0,1,0,1],none:[0,0,0,0,2]},f={show:"_g_{$}_sw",standby:"_g_{$}_sb",hide:"_g_{$}_hd"},p=["top","right","bottom","left",""],h={push:{up:"Up",down:"Down",left:"Left",right:"Right"},bounce:{"":"",up:"Up",down:"Down",left:"Left",right:"Right"},fade:{"":"",up:"Up",down:"Down",left:"Left",right:"Right"},rotate:{"":"",up:"UpLeft",down:"DownRight",left:"DownLeft",right:"UpRight"},flip:{x:"X",y:"Y"},expand:{x:"X",y:"Y","":""},none:{none:""},1:1},g={push:["_fw_pushIn","_fw_pushOut"],bounce:["_fw_bounceIn","_fw_bounceOut"],fade:["_fw_fadeIn","_fw_fadeOut"],rotate:["_fw_rotateIn","_fw_rotateOut"],flip:["_fw_flipIn","_fw_flipOut"],expand:["_fw_expand","_fw_collapse"],none:["_fw_none","_fw_hide"],1:1},_=null,m=function(e,t){t instanceof Array&&t.length>1||(t=["push",1]);var n=t[0]+(p[t[1]].length>0?"_"+p[t[1]]:"");return f[e].replace("{$}",n)},v={showScene:{type:null,dom:null,anim:null,classname:null},hideScene:{type:null,dom:null,anim:null,classname:null}},b=!0,y=function(){(_=document.getElementById("_smr_runtime_wrapper"))||(_=document.createElement("div"),_.className="_smr_runtime_wrapper",_.id="_smr_runtime_wrapper",document.body.appendChild(_)),b=!1},S=function(e,t){var n=i("div"),r=i("div"),o=i("div"),a=i("div");return n.style.webkitPerspective=1e3,r.className="animated _g_flip_card",o.className="_g_flip_front",a.className="_g_flip_back",o.appendChild(e),a.appendChild(t),r.appendChild(a),r.appendChild(o),n.appendChild(r),n},w=function(e){var t={up:0,right:1,down:2,left:3,z:4,none:4};d[e.anim[0]][t[e.anim[1]]]<=0&&(e.anim=["push",1]),e.transitionOut&&d[e.transitionOut[0]][t[e.transitionOut[1]]]<=0&&(e.transitionOut=["push",1]),e.type||(e.type="common"),e.anim&&"undefined"!=typeof e.anim[1]&&"undefined"!=typeof t[e.anim[1]]&&(e.anim=[e.anim[0],t[e.anim[1]]]),(!e.anim||"undefined"==typeof d[e.anim[0]]||"undefined"==typeof d[e.anim[0]][e.anim[1]]||d[e.anim[0]][e.anim[1]]<=0)&&(e.anim=["push",1]),e.transitionOut&&("object"!=typeof e.transitionOut?e.anim[1]=(e.anim[1]+2)%4:(e.transitionOut[1]=(e.transitionOut[1]+2)%4,e.anim=e.transitionOut))},E=function(e){b&&y(),w(e);var n=v.showScene,r=v.hideScene,i=n&&n.anim?n.anim[0]!=e.anim[0]||n.anim[1]!=e.anim[1]:!0;switch(e.type){case"common":if(e.dom instanceof Array&&(e.dom_front=e.dom[0],e.dom_back=e.dom[1]),e.cloneDom)n.dom.parentNode.appendChild(e.cloneDom),n.dom.addEventListener("webkitTransitionEnd",function(){e.cloneDom&&e.cloneDom.parentNode&&(e.cloneDom.parentNode.removeChild(e.cloneDom),delete e.cloneDom)},!1),n.dom=e.cloneDom;else{if(n.dom==e.dom)return!1;delete e.cloneDom}if(e.dom instanceof Array&&(n.dom==e.dom_front||n.dom==e.dom_back)||("undefined"!=typeof n.dom_front?n.dom_front==e.dom_front||n.dom_front==e.dom_back||n.dom_front==e.dom:!1)||("undefined"!=typeof n.dom_back?n.dom_back==e.dom_front||n.dom_back==e.dom_back||n.dom_back==e.dom:!1))return!1;if(e.dom instanceof Array&&(e.dom=S(e.dom[0],e.dom[1])),r&&r.dom)if(r.dom_front){var a=0;r.dom_front!=e.dom&&r.dom_front!=e.dom_front&&r.dom_front!=e.dom_back&&(r.dom_front.className=r.front_classname?"hide "+r.front_classname:"hide",_.appendChild(r.dom_front),a++),r.dom_back!=e.dom&&r.dom_back!=e.dom_front&&r.dom_back!=e.dom_back&&(r.dom_back.className=r.back_classname?"hide "+r.back_classname:"hide",_.appendChild(r.dom_back),a++),_.removeChild(r.dom)}else r.dom!=e.dom&&r.dom!=e.dom_front&&r.dom!=e.dom_back&&(r.dom.className=r.classname?"hide "+r.classname:"hide");e.dom_front?(e.front_classname=e.dom_front.className.replace(/(_g_[\S]*)|(transi)|(hide)|(animated)/g,"").replace(new RegExp(t,"g"),"").replace(/(^\s*)|(\s*$)/g,"")+t,e.dom_front.className=e.front_classname,e.back_classname=e.dom_back.className.replace(/(_g_[\S]*)|(transi)|(hide)|(animated)/g,"").replace(new RegExp(t,"g"),"").replace(/(^\s*)|(\s*$)/g,"")+t,e.dom_back.className=e.back_classname):(e.classname=e.dom.className.replace(/(_g_[\S]*)|(transi)|(hide)|(animated)/g,"").replace(new RegExp(t,"g"),"").replace(/(^\s*)|(\s*$)/g,"")+t,e.dom.className=e.classname?"hide "+e.classname:"hide");var c=e.dom,f=r.dom?r.dom:!1,p=n.dom?n.dom:!1;i&&p&&(p.className=n.classname?t+" "+n.classname:t,o(p,m("show",e.anim))),o(c,[m("standby",e.anim),t]),_!=c.parentElement&&_.appendChild(c),s(c,"hide");var h=i?10:1;setTimeout(function(){1==d[e.anim[0]][e.anim[1]]&&(p&&o(p,"transi"),o(c,"transi")),p&&u(p,m("hide",e.anim),m("show",e.anim)),u(c,m("show",e.anim),m("standby",e.anim)),2==d[e.anim[0]][e.anim[1]]&&(p&&o(p,"animated"),o(c,"animated"))},h),v.showScene.anim&&(v.showScene.anim=e.anim),v.hideScene=v.showScene,v.showScene=e,v.hideScene.callback&&v.hideScene.callback.hide&&v.hideScene.callback.hide(),e.callback&&e.callback.load&&e.callback.load();break;case"flipleft":s(n.dom.firstChild,["_g_flip_card_right","_g_flip_card_right_def"]),l(n.dom.firstChild,"_g_flip_card_left","_g_flip_card_left_def");break;case"flipright":s(n.dom.firstChild,["_g_flip_card_left","_g_flip_card_left_def"]),l(n.dom.firstChild,"_g_flip_card_right","_g_flip_card_right_def")}return!0},T=function(e,t){var n=e.dom;e.anim||(e.anim=["push","down"]),t?(h[e.anim[0]]&&"undefined"!=typeof h[e.anim[0]][e.anim[1]]&&(s(n,"^_fw_"),o(n,g[e.anim[0]][1]+h[e.anim[0]][e.anim[1]])),n.style.display="",n.addEventListener("webkitAnimationEnd",I,!1)):(o(n,"animated"),h[e.anim[0]]&&"undefined"!=typeof h[e.anim[0]][e.anim[1]]&&(s(n,"^_fw_"),o(n,g[e.anim[0]][0]+h[e.anim[0]][e.anim[1]])),n.style.display="block",n.removeEventListener("webkitAnimationEnd",I,!1))},I=function(){this.style.display="none"};e.transition.__reg("_init",y,"private"),e.transition.__reg("_run",E,"private"),e.transition.__reg("_serverRun",function(){},"private"),e.transition.__reg("_subrun",T,"private")}(sumeru);var runnable=function(e,t){e.addSubPackage("pubsub");var n={},r={a:1},i=[],o=function(){},a=Array.prototype.pop,s=Array.prototype.slice;o.prototype={subscribe:function(t,o){var u=r[t.replace(/@@_sumeru_@@_page_([\d]+)/,"")],l=u.modelname,c=u.plainstruct;if("undefined"==typeof l)throw"publish "+t+" NOT FOUND";l="Model."+l;var d=null;"object"==typeof this&&"undefined"!=typeof this.isWaiting&&(d=this,d.wait());var f=e.collection.create({modelName:l});f.pubName=t;var p=a.call(arguments),h=s.call(arguments,1),g=f.getVersion(),_=this.__UK;n[t]||(i.push(t),n[t]={modelName:l,plainStruct:c,args:h,topPriority:!1,stub:[]});for(var m=0,v=n[t].stub.length;v>m;m++)n[t].stub[m].id===_&&d&&d.wait();var b=Function.toString.call(p),y=this.subscribe.caller;n[t].stub=n[t].stub.filter(function(e){return e.id==_&&e.sourceCustomClosure==y&&e.callbackStr==b?!1:!0});var S=function(){try{p.apply(void 0,arguments)}catch(e){console.warn("error when pubsub callback on line 84 ",e)}d&&d.start()};n[t].stub.push({id:_,sourceCustomClosure:y,collection:f,callback:S,callbackStr:b,env:this});var w={name:t,args:h,uk:_,version:g};return d&&d.clientId&&(w.clientId=d.clientId),e.netMessage.sendMessage(w,"subscribe",function(e){sumeru.log("error : subscribe "+e)},function(){sumeru.dev("send subscribe "+t,g||"no version")}),f},subscribeByPage:function(e,t,n){var r={pagesize:10,page:1,uniqueField:"time"};t=Library.objUtils.extend(r,t);var i=arguments;i[0]=e+"@@_sumeru_@@_page_"+t.page;var o=this.subscribe.apply(this,i);return o},prioritySubscribe:function(e,t){var r=arguments,i=this.subscribe.apply(this,r);return n[e].topPriority=!0,i}};var u=function(){l(c)},l=function(t){cbHandler=Library.asyncCallbackHandler.create(function(){t(),e.pubsub.__reg("_priorityAsyncHandler",void 0,!0)}),e.pubsub.__reg("_priorityAsyncHandler",cbHandler,!0),cbHandler.add();for(var r=0,o=i.length;o>r;r++){var a=i[r];if("auth-init"!=a&&a in n&&n[a].topPriority!==!1){cbHandler.add();var s=n[a].stub[0].collection.getVersion();e.netMessage.sendMessage({name:a,args:n[a].args,version:s},"subscribe",function(t){e.log("error : redoPrioritySubscribe",t)},function(){e.dev("sending redo priority subscribe "+a,s||"no version(redo)")})}}cbHandler.enableCallback(),cbHandler.decrease()},c=function(){for(var t=0,r=i.length;r>t;t++){var o=i[t];if("auth-init"!=o&&o in n&&n[o].topPriority!==!0){var a=n[o].stub[0].collection.getVersion();e.netMessage.sendMessage({name:o,args:n[o].args,version:a},"subscribe",function(t){e.log("Err : redoNormalSubscribe",t)},function(){e.dev("sending redo priority subscribe "+o,a||"no version(redo)")})}}};e.pubsub.__reg("clearClient",function(e){for(var t in n)n[t].stub=n[t].stub.filter(function(t){return t.id!=e&&t.id?!0:!1}),0==n[t].stub.length&&delete n[t]}),e.pubsub.__reg("clear",function(){var t;for(var r in n){t=n[r].stub||{};for(var o=t.length-1;o>=0;o--)t[o].env.isDestroy&&(t[o].collection=null,t[o].callback=null,t[o].env=null,t.splice(o,1));0==t.length&&(e.netMessage.sendMessage({name:r},"unsubscribe",function(e){},function(){e.dev("unsubscribing",r)}),delete n[r],i=i.filter(function(e){return e==r?!1:!0}))}},!0),e.pubsub.__reg("_pubsubObject",o,!0),e.pubsub.__reg("_subscribeMgr",n,!0),e.pubsub.__reg("_publishModelMap",r,!0),e.pubsub.__reg("_redoAllSubscribe",u,!0),e.pubsub.__reg("_postponeQueue",[],"private");var d=e.pubsub._postponeQueue,f=function(e){0!==d.length&&d.forEach(function(t,n){t.collection==e&&(t.runner(),d.splice(n,1))})};e.pubsub.__reg("_releaseHold",f,"private"),"undefined"!=typeof t&&function(e){for(var t in e)r[t]={modelname:e[t].modelName,plainstruct:e[t].plainStruct}}(t)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(fw){var _controller=fw.addSubPackage("controller"),activeController=[],activeControllerId,cloneDom=null,transitionOut=!1,globalIsforce=null,_bindingMap={},_bindingData=function(e,t){var n=this.__UK+"_"+e;_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}});var r=_controller.__load("_tapped_blocks");"undefined"!=typeof r&&r.push({widgetId:n});for(var i in t)t.hasOwnProperty(i)&&(_bindingMap[n].view_data[i]=t[i])},_bindingDataByPage=function(e,t){var n=this.__UK+"_"+e;if(_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}}),"undefined"==typeof t.page)throw"subscribeByPage always need a page parameter";_bindingMap[n].isByPage=!0;var r=_bindingMap[n].view_data[t.page]={},i=_controller.__load("_tapped_blocks");"undefined"!=typeof i&&i.push({widgetId:n,page:t.page,options:t.options||{}});for(var o in t)t.hasOwnProperty(o)&&(r[o]=t[o])},_cloneDom=function(e){cloneDom=e.getDom().cloneNode(!0),cloneDom.style.zIndex="0",cloneDom.removeAttribute("id");for(var t=cloneDom.querySelectorAll("[tpl-id]"),n=0,r=t.length;r>n;n++)t[n].removeAttribute("tpl-id")},_bindingEvent=function(e,t){var n=this.__UK+"_"+e;_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}}),_bindingMap[n].eventMap.__default_key__=t,_bindingMap[n].eventMap.__default_key__()},queryElementsByTplId=function(e,t){return(t||document).querySelectorAll('block[tpl-id="'+e+'"]')||[]},doRenderByRelation=function(e,t){for(var n in e)t(n,e[n]),doRenderByRelation(e[n],t)},findAndDestroy=_controller.__reg("findAndDestroy",function(e,t){var n=activeController.filter(function(n){var r=n.__getID();if(r===t);else if(-1!==e.indexOf(r))return!0;return!1});n.forEach(function(e){e.destroy()})},!0),_Environment=function(){this.isWaiting=0,this.isWaitingChecker=null,this.callbackFunc=null,this.isDestroy=!1,this.withEnyo=!1},_pubSubObject=new fw.pubsub._pubsubObject;_Environment.prototype={__destroy:function(){fw.utils.cleanObj(this),this.isDestroy=!0,fw.pubsub.clear()},setClockChecker:function(){var e=8e3;this.isWaitingChecker=setTimeout(function(){if(this.isWaiting>0)throw"NOT call env.start after "+e/1e3+" seconds, did you forget it?"},e)},clearClockChecker:function(){clearTimeout(this.isWaitingChecker)},setCallback:function(e){this.callbackFunc=e},fireCallback:function(){this.isWaiting<=0&&this.callbackFunc&&this.callbackFunc()},redirect:function(e,t,n){var r=e;t&&(r+="!"+fw.utils.mapToUriParam(t)),fw.router.redirect(r,n)},refresh:function(){return this.__getControllerInstance().__refresh()},callSub:function(e){this.__getControllerInstance().__callSubController(e)},wait:function(){this.isWaiting++,this.setClockChecker()},start:function(){this.clearClockChecker(),--this.isWaiting<=0&&(this.isWaiting=0,this.fireCallback())},onload:function(){return[]},onrender:function(){throw"Didn't specify a onrender event handler"},onready:function(){},onsleep:function(){},onresume:function(){},ondestroy:function(){},onerror:function(e){sumeru.log(e)},subscribe:_pubSubObject.subscribe,subscribeByPage:_pubSubObject.subscribeByPage,prioritySubscribe:_pubSubObject.prioritySubscribe};var controllerBase={__init:function(){var e=null,t=[];if(this.__isInited===!1){e=this.getEnvironment(),session=this.getSession();var n=this;activeController.push(this),fw.controller.__reg("_tapped_blocks",t,!0);var r=e.onload(),i=function(t){return t>=r.length?(e.setCallback(null),void 0):(e.setCallback(function(){i(++t)}),fw.sense.runSenseContext(function(e){return function(){fw.controller.__reg("_tapped_blocks",[],!0),e.call({}),n.__render(fw.controller._tapped_blocks)}}(r[t])),e.fireCallback(),void 0)};i(0),this.__render(),this.__isInited=!0}},__render:function(e,t){var n=this,r=e.widgetId,i=this.getEnvironment();if(i.withEnyo)return this.__renderEnyo(e),!0;if("undefined"==typeof _bindingMap[r]||void 0==n.__templateBlocks[r])return!1;var o=_bindingMap[r];if(o.isByPage){for(var a=queryElementsByTplId(r),s=e.page,u=_bindingMap[r].view_data[s],l,c=0,d=a.length;d>c;c++){var f=a[c];if(e.options.cleanExist)for(var p=f.querySelectorAll("[__page-unit-rendered-page]"),h,g=0,_=p.length;_>g;g++)h=p[g],h.parentNode.removeChild(h),h.innerHTML="";if(0==f.querySelectorAll("[__page-unit-rendered-page]").length){var m=n.__templateBlocks[r](u);m=m.replace(/tpl-role[\s]*=[\s]*['"]page_unit['"]/,'__page-unit-rendered-page="'+s+'"'),f.innerHTML=m}else{var v=document.createElement("div");v.innerHTML=n.__templateBlocks[r](u);var b,y=v.querySelector('[tpl-role="page_unit"]');b=null==y?v:y,b.removeAttribute("tpl-role"),b.setAttribute("__page-unit-rendered-page",s);var S;if(S=f.querySelector('[__page-unit-rendered-page="'+s+'"]'))S.innerHTML=b.innerHTML;else{b.innerHTML=b.innerHTML.replace(/tpl-role[\s]*=[\s]*['"]page_unit['"]/,'__page-unit-rendered-page="'+s+'"');var w=f.querySelectorAll("[__page-unit-rendered-page]");S=w[w.length-1],S.parentNode.insertBefore(b,S.nextSibling)}f.innerHTML=f.innerHTML+" "}}var E=_bindingMap[r].eventMap;for(var c in E)E[c]()}else{for(var u=_bindingMap[r].view_data,a=queryElementsByTplId(r),c=0,d=a.length;d>c;c++){var f=a[c];t&&"undefined"==typeof nodomdiff?(f.innerHTML=f.innerHTML,fw.domdiff.convert(n.__templateBlocks[r](u),f)):f.innerHTML=n.__templateBlocks[r](u)}var E=_bindingMap[r].eventMap;for(var c in E)E[c]();var T=null;doRenderByRelation(n.__templateRelation,function(e,t){e==r&&(T=t)}),doRenderByRelation(T,function(e){if(_bindingMap[e]){for(var r=_bindingMap[e].view_data,i=queryElementsByTplId(e),o=0,a=i.length;a>o;o++){var s=i[o];t&&"undefined"==typeof nodomdiff?(s.innerHTML=s.innerHTML,fw.domdiff.convert(n.__templateBlocks[e](r),s)):s.innerHTML=n.__templateBlocks[e](r)
}var u=_bindingMap[e].eventMap||{};for(var l in u)u[l]()}})}return!0},__renderEnyo:function(e){var t=session.get("enyoapp");if(!t)return sumeru.log("__renderEnyo -> no enyoapp detacted!"),!1;if(!e){var n=document.getElementById("view/blank@@content");return t.renderInto(n),void 0}var r=e.widgetId,i=r.split(".").pop(),o=_bindingMap[r].eventMap;t.$[i].destroyClientControls(),t.$[i].fwdata=_bindingMap[r].view_data.fwdata,t.$[i].fwdataChanged(),t.$[i].render();for(var a in o)o[a]()},__refresh:function(){var e=this.__getID(),t,n,r=e.split("!");1===r.length&&r.push(""),t=findController(r[0]),t!==!1&&(this.destroy(!0,!0),n=new MainController(e,fw.utils.uriParamToMap(r[1]),t),n.__init())},rewriteUri:function(e){if("undefined"!=typeof e){var t=function(e){"a"==e.target.nodeName.toLowerCase()&&-1!=e.target.href.indexOf(location.origin)&&(e.defaultPrevented||(sumeru.router.redirect(e.target.href.substr(location.origin.length)),e.preventDefault()))};e.getAttribute("link-ajax")||e.getAttribute("data-rel")||(e.addEventListener("click",t),e.addEventListener("touchstart",t),e.setAttribute("link-ajax",!0))}},destroy:function(e,t){var n=this.__getID(),r=this.__UK,i=this.getSession(),o=this.getEnvironment();!cloneDom&&"undefined"!=typeof this.getDom&&t&&_cloneDom(this);try{o.ondestroy()}catch(a){}if(fw.render.clearTplContent(i),e!==!0?fw.session.destroy(i):i.cleanObserver(),o.__destroy(),fw.render.delTpl(this.tplName),this.__subControllerList)for(var s in this.__subControllerList)this.__subControllerList[s].destroy();for(var s in _bindingMap)0===s.indexOf(r)&&(fw.utils.cleanObj(_bindingMap[s].view_data),fw.utils.cleanObj(_bindingMap[s].eventMap),fw.utils.cleanObj(_bindingMap[s]),delete _bindingMap[s]);this.getSession=null,this.getEnvironment=null,this.__getIdentifier=null,delete this.getSession,delete this.getEnvironment,delete this.__getIdentifier;var u=activeController;activeController=u.filter(function(e){return e.__getID()!==n}),u.length=0,fw.dev('destory ["'+n+'"]')}},SubControler=function(e,t,n,r){var i=this,o,a;o=new _Environment,a=fw.session.create(e),a.bind=_bindingData,a.event=_bindingEvent,a.eventMap=fw.event.mapEvent,a.__isSubController=!0,a.getMain=function(){return n.session},o.isReady=function(){return!1},o.show=function(){throw"this controller not ready"},o.hide=function(){throw"this controller not ready"},o.destroy=function(){i.destroy()},o.__UK=a.__UK=this.__UK="T"+fw.utils.randomStr(10),this.getSession=function(){return a},this.getEnvironment=function(){return o},this.__getID=function(){return e},this.__isFirstRender=!0,this.__isInited=!1,this.__templateBlocks=!1,this.__templateRelation=!1,r(o,a,t,n),o.__getControllerInstance=function(){return i},fw.dev("create new : "+e)};SubControler.prototype=fw.utils.extendFrom(controllerBase,{__render:function(e){var t=this,n=t.getEnvironment(),r=t.getSession(),i=null;n.onrender(function(o,a,s){r.__currentTplName=o;var u,l={position:"absolute",top:0,left:0,width:"100%",height:70,display:"none"};i="undefined"!=typeof s?s:null;var c=function(){if("undefined"==typeof e){var o=fw.render.buildRender(r);t.__templateBlocks=o.renderBlock,t.__templateRelation=o.blocksRelation,u=fw.render.getTplContent(r),fw.utils.setStyles(u,fw.utils.cpp(l,a)),doRenderByRelation(t.__templateRelation,function(e){for(var n=queryElementsByTplId(e),r=0,i=n.length;i>r;r++){var o=n[r];o.innerHTML=t.__templateBlocks[e]({})}}),n.show=function(e){fw.transition._subrun({dom:u,anim:e||i},!1),!i&&e&&(i=e),t.rewriteUri(u)},n.hide=function(e){fw.transition._subrun({dom:u,anim:e||i},!0)},n.setPosition=function(e){fw.utils.setStyles(u,e)},n.isReady=function(){return!0},r.toBeCommited.length=0,n.onready(u),t.__isFirstRender=!1}else{if(!e.length)return;if(t.__isFirstRender)return setTimeout(function(){t.__render(e)},50),void 0;for(var s=0,c=e.length;c>s;s++)controllerBase.__render.call(t,e[s])}};fw.render.getTpl(o,r,function(e){t.tplName=o,c()})})}});var MainController=function(e,t,n){var r=this,i,o;i=new _Environment;var a=0==activeController.length;o=fw.session.create(e),o.bind=_bindingData,o.bindByPage=_bindingDataByPage,o.event=_bindingEvent,o.eventMap=fw.event.mapEvent,i.callSubController=function(e,t,n){return r.__callSubController(e,t,n)},i.__UK=o.__UK=this.__UK="T"+fw.utils.randomStr(10),o.__isSubController=!1,this.getSession=function(){return o},this.getEnvironment=function(){return i},this.__getID=function(){return e},this.__isFirstRender=!0,this.__isInited=!1,this.__templateBlocks=!1,this.__subControllerList={},n(i,o,o.getContainer()),i.__getControllerInstance=function(){return r},fw.dev("create new : "+e)};MainController.prototype=fw.utils.extendFrom(controllerBase,{__render:function(e){var t=this,n=t.getEnvironment(),r=t.getSession();n.onrender(function(i,o){r.__currentTplName=i;var a,s=function(){if("undefined"==typeof e){var s=fw.render.buildRender(r);t.__templateBlocks=s.renderBlock,t.__templateRelation=s.blocksRelation,a=fw.render.getTplContent(r),doRenderByRelation(t.__templateRelation,function(e){for(var n=queryElementsByTplId(e),r=0,i=n.length;i>r;r++){var o=n[r];o.innerHTML||(o.innerHTML=t.__templateBlocks[e]({}))}}),t.__transition(i,o,function(){r.toBeCommited.length=0,n.onready(a)}),t.rewriteUri(a),n.withEnyo&&t.__isFirstRender&&controllerBase.__renderEnyo(),t.__isFirstRender=!1}else{if(!e.length)return;if(t.__isFirstRender)return setTimeout(function(){t.__render(e)},50),void 0;for(var u=0,l=e.length;l>u;u++)controllerBase.__render.call(t,e[u],!0)}};fw.render.getTpl(i,r,function(e){s()})})},__callSubController:function(e,t,n){var r=findController(e),i=this.__lastTransitionIn;if(r!==!1){var o=this.getEnvironment(),a,s="__subFrom/"+this.__getID()+"/"+e,u,l={session:this.getSession(),env:fw.utils.getProxy(o,["redirect","refresh"]),tplContent:i};if(!r)throw"can not find a sub controller";return u=this.__subControllerList[s],u&&"undefined"!=typeof n&&n&&u.destroy(),(u=this.__subControllerList[s])||(u=new SubControler(s,t,l,r),this.__subControllerList[s]=u,a=u.getEnvironment(),a.onready=function(e,t){return function(){e.apply(this,arguments),t&&t.apply({},arguments)}}(a.onready,t.oncreated),a.ondestroy=function(e,t,n,r){return function(){try{e.apply(this,arguments),t&&t()}catch(i){console.error(i)}finally{n.__subControllerList[r]=null,delete n.__subControllerList[r]}}}(a.ondestroy,t.ondestroy,this,s),a.onerror=function(e,t){return function(){e.apply(this,arguments),t&&t.apply({},arguments)}}(a.onerror)),u.__init(),fw.utils.getProxy(u.getEnvironment(),["show","hide","setPosition","isReady","destroy"])}},__transition:function(e,t,n){var r,i,o,a=this;this.urlToTplHistory=this.urlToTplHistory||{};var s=this.__getID(),u=this.getSession(),l=u.__hashKey.sort(),c={};if(l.forEach(function(e){c[e]=u.get(e)},l),s+=JSON.stringify(c),e||""===e)this.urlToTplHistory[s]=e,r=fw.render.getTplContent(u);else if(e=this.urlToTplHistory[s],r=e||""==e?fw.render.getTplContent(u):this.__lastTransitionIn,!r)return!1;var d=t||this.__lastTransitionType;return a._isFirstPage&&fw.config.get("runServerRender")!==!1&&(a._isFirstPage=!1,d=["none","none"]),o=fw.historyCache.hitUrl([s,t||this.__lastTransitionType],globalIsforce),i=fw.transition._run({dom:r,cloneDom:cloneDom,transitionOut:transitionOut,anim:d,callback:{load:n||function(){}}}),transitionOut=!1,cloneDom=null,i||(n||function(){})(),this.__lastTransitionType=t||this.__lastTransitionType,this.__lastTransitionIn=r,!0},getDom:function(){return fw.render.getTplContent(this.getSession())},setFirstPage:function(e){this._isFirstPage=e}});var _bindingServerEvent=function(e,t){var n=this.__UK+"_"+e;_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}}),_bindingMap[n].eventMap.__default_key__=function(){}},serverController=function(e,t,n){var r=this,i,o;i=new _Environment,i.clientId=t;var a="T"+fw.utils.randomStr(10);o=fw.session.create(a),o.bind=_bindingData,o.bindByPage=_bindingDataByPage,o.event=_bindingServerEvent,o.eventMap=fw.event.mapEvent,i.callSubController=function(e,t,n){return r.__callSubController(e,t,n)},i.__UK=o.__UK=this.__UK=a,o.__isSubController=!1,this.getSession=function(){return o},this.getEnvironment=function(){return i},this.__getID=function(){return e},this.__isFirstRender=!0,this.__isInited=!1,this.__templateBlocks=!1,this.__subControllerList={},n(i,o,o.getContainer()),i.__getControllerInstance=function(){return r},fw.dev("create new : "+e)};serverController.prototype=fw.utils.extendFrom(controllerBase,{__render:function(e){var t=this;if(!t.getEnvironment)return console.warn("render... error...   @controller on line 1179"),void 0;var n=t.getEnvironment(),r=t.getSession();n.onrender(function(i,o){r.__currentTplName=i;var a=function(i){var o=t.__UK;try{if(t.__isFirstRender){var a=fw.render.buildRender(r,i);t.tplContent=a.tplContent,t.domId=a.domId,t.__templateBlocks=a.renderBlock,t.__templateRelation=a.blocksRelation,t.__isFirstRender=!1}if("undefined"!=typeof e){if(!e.length)return;for(var s=0,u=e.length;u>s;s++)t.__renderData.call(t,e[s]);return}var l='<div class="_smr_runtime_wrapper" id="_smr_runtime_wrapper"><section id="'+t.domId+'" class="__viewBlock__">'+t.tplContent+"</section></div>";n.__onFinish&&n.__onFinish(l),t.server_destroy()}catch(c){console.warn("controller do render error on line 1226 "+o),n.__onFinish&&n.__onFinish(),t&&t.server_destroy()}};fw.render.getTpl(i,r,function(e){a(e)})})},server_destroy:function(){if(!this||!this.__UK)return console.warn("server destroy already... on line 1242 controller.js"),void 0;var e=this.__getID(),t=this.__UK,n=this.getSession(),r=this.getEnvironment();fw.session.destroy(n),fw.utils.cleanObj(r),r.isDestroy=!0,fw.pubsub.clearClient(t);for(var i in _bindingMap)0===i.indexOf(t)&&(fw.utils.cleanObj(_bindingMap[i].view_data),fw.utils.cleanObj(_bindingMap[i].eventMap),fw.utils.cleanObj(_bindingMap[i]),delete _bindingMap[i]);fw.utils.cleanObj(this),fw.dev('destory ["'+e+'"]'+t)},__renderData:function(e){var t=this;if("undefined"==typeof t)return console.warn("error ,no controller"),void 0;var n=e.widgetId,r=this.getEnvironment();if("undefined"==typeof _bindingMap[n]||void 0==t.__templateBlocks[n])return!1;var i,o=_bindingMap[n];i=o.isByPage?_bindingMap[n].view_data[e.page]:_bindingMap[n].view_data;var a=new RegExp("("+n+"[^>]*>)[\\s\\S]*?(</block>)");t.tplContent=t.tplContent.replace(a,"$1"+t.__templateBlocks[n](i)+"$2")},__init:function(){var e=null,t=[];if(this.__isInited===!1||this.pathChange){this.__isInited="waiting",this.pathChange=!1,e=this.getEnvironment(),session=this.getSession();var n=this;fw.controller.__reg("_tapped_blocks",t,!0);var r=e.onload(),i=function(t){n.__render(),n.__isInited=!0,e.isWaiting=0},o=0,a=function(t,o){return o&&o(),t>=r.length?(e.setCallback(null),i&&i(),void 0):(e.setCallback(function(){a(++t,function(){n.__render(fw.controller._tapped_blocks)})}),fw.controller.__reg("_tapped_blocks",[],!0),r[t].call({}),e.fireCallback(),void 0)};a(0)}else"waiting"===this.__isInited?this.__render():(this.__render(fw.controller._tapped_blocks),this.__render())},setPath:function(e){this.path!=e&&(this.path=e,this.pathChange=!0)}}),_controller.__reg("serverController",serverController),_controller.__reg("getServerInstance",function(e,t,n,r,i){var o=new fw.controller.serverController(e,t.clientId,r);fw.session.setResumeNew(t.session,o.__UK);var a=o.getEnvironment();a.__onFinish=i,a.arguments=t.contr_argu,o.setPath(n),o.__init()}),_controller.__reg("create",function(e){return e});var findController=_controller.__reg("findController",function(path){for(var routeMap=fw.router.getAll(),pattern,find,i=routeMap.length-1;i>=0;i--)if(pattern=new RegExp("^"+routeMap[i].path+"$"),""==routeMap[i].path&&""==path||""!==routeMap[i].path&&pattern.test(path)===!0){if(find=eval(routeMap[i].action))return find;throw"found a router record for controller ["+path+"], but the controller is undefined."}for(var externalProcessors=sumeru.router.externalProcessor.getAll(),processor,i=0,l=externalProcessors.length;l>i;i++)if(processor=externalProcessors[i],!0===processor(path))return!1;if("undefined"!=typeof SUMERU_DEFAULT_CONTROLLER)return eval(SUMERU_DEFAULT_CONTROLLER);throw"Can NOT find a controller ["+path+"]"},fw.SUMERU_APP_FW_DEBUG?!1:!0),_testReusing=function(e,t){var n=e.__getID();return 0==n.indexOf(t+"!")},dispatch=_controller.__reg("dispatch",function(e,t,n){var r=e+"!"+("string"!=typeof t?"":t),i,o=null,a=!1;i=findController(e);var s=0==activeController.length;if(i!==!1){fw.dev("dispatch "+r),globalIsforce=n;var u=null;for(var l in activeController){if(a=activeController[l],u=a.__getID(),u==r){o=a,(!o.__transition()||n)&&(o.destroy(!0,!1),a=!1),fw.dev("ROUTER FULL QUERY PATH : "+r);break}_testReusing(o=a,e)?activeControllerId===e?(o.destroy(!1,!0),a=!1,fw.dev("ROUTER SAME QUERY PATH: "+r)):(!o.__transition()||n)&&(o.destroy(),a=!1,fw.dev("ROUTER FULL QUERY PATH: "+r)):(a=!1,fw.dev("ROUTER NOT MATCH : "+r))}a||(o=new MainController(r,t,i),o.setFirstPage(s));var c=o.getEnvironment();c.arguments=t,activeControllerId=e,o.__init()}},fw.SUMERU_APP_FW_DEBUG?!1:!0);_controller.__reg("reactiveRender",function(e){activeController.forEach(function(t){t.__render(e)})})};"undefined"!=typeof module&&module.exports?module.exports=function(e){runnable(e)}:runnable(sumeru),Library="undefined"==typeof Library?{}:Library;var runnable=function(fw){fw.addSubPackage("Library");var createLibrary=function(e){var t={};return e.call(this,t),t},loadLibrary=function(name){var library=eval(name);if("undefined"==typeof library)throw"Error finding the library "+name};fw.Library.__reg("create",createLibrary),fw.Library.__reg("load",loadLibrary)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){Library.objUtils=e.Library.create(function(e){var t=e.isPlainObject=function(e){if(!e||"object"!==r(e)||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e,"constructor")&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var n;for(n in e);return void 0===n||Object.prototype.hasOwnProperty.call(e,n)},n={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){n["[object "+e+"]"]=e.toLowerCase()});var r=function(e){return null==e?"null":n[Object.prototype.toString.call(e)]||"object"},i=e.isObject=function(e){return"object"===r(e)},o=e.isEmpty=function(e){var t=!0,n;for(n in e){t=!1;break}return t},a=e.isArray=function(e){return"array"===r(e)},s=e.isFunction=function(e){return"function"===r(e)},u=e.isString=function(e){return"string"===r(e)},l=e.isBoolean=function(e){return"bollean"===r(e)},c=e.isNumber=function(e){return"number"===r(e)},d=e.isDate=function(e){return"date"===r(e)},f=e.isRegExp=function(e){return"regexp"===r(e)},p=e.extend=function(){var e,n,r,i,o,u,l=arguments[0]||{},c=1,d=arguments.length,f=!1;if("boolean"==typeof l&&(f=l,l=arguments[1]||{},c=2),"object"==typeof l||s(l)||(l={}),d===c)return l;for(;d>c;c++)if(null!=(e=arguments[c]))for(n in e)r=l[n],i=e[n],l!==i&&(f&&i&&(t(i)||(o=a(i)))?(o?(o=!1,u=r&&a(r)?r:[]):u=r&&t(r)?r:{},l[n]=p(f,u,i)):void 0!==i&&(l[n]=i));return l};return e})};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var Handlebars={};Handlebars.VERSION="1.0.beta.6",Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(e,t,n){n&&(t.not=n),this.helpers[e]=t},Handlebars.registerPartial=function(e,t){this.partials[e]=t},Handlebars.registerHelper("helperMissing",function(e){if(2===arguments.length)return void 0;throw new Error("Could not find property '"+e+"'")});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(e,t){var n=t.inverse||function(){},r=t.fn,i="",o=toString.call(e);if(o===functionType&&(e=e.call(this)),e===!0)return r(this);if(e===!1||null==e)return n(this);if("[object Array]"===o){if(e.length>0)for(var a=0,s=e.length;s>a;a++)i+=r(e[a]);else i=n(this);return i}return r(e)}),Handlebars.registerHelper("each",function(e,t){var n=t.fn,r=t.inverse,i="";if(e&&e.length>0)for(var o=0,a=e.length;a>o;o++)i+=n(e[o]);else i=r(this);return i}),Handlebars.registerHelper("if",function(e,t){var n=toString.call(e);return n===functionType&&(e=e.call(this)),!e||Handlebars.Utils.isEmpty(e)?t.inverse(this):t.fn(this)}),Handlebars.registerHelper("unless",function(e,t){var n=t.fn,r=t.inverse;return t.fn=r,t.inverse=n,Handlebars.helpers["if"].call(this,e,t)}),Handlebars.registerHelper("with",function(e,t){return t.fn(e)}),Handlebars.registerHelper("log",function(e){Handlebars.log(e)});var handlebars=function(){var e={trace:function n(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function r(e,t,n,r,i,o,a){var s=o.length-1;switch(i){case 1:return o[s-1];case 2:this.$=new r.ProgramNode(o[s-2],o[s]);break;case 3:this.$=new r.ProgramNode(o[s]);break;case 4:this.$=new r.ProgramNode([]);break;case 5:this.$=[o[s]];break;case 6:o[s-1].push(o[s]),this.$=o[s-1];break;case 7:this.$=new r.InverseNode(o[s-2],o[s-1],o[s]);break;case 8:this.$=new r.BlockNode(o[s-2],o[s-1],o[s]);break;case 9:this.$=o[s];break;case 10:this.$=o[s];break;case 11:this.$=new r.ContentNode(o[s]);break;case 12:this.$=new r.NativeNode(o[s]);break;case 13:this.$=new r.MustacheNode(o[s-1][0],o[s-1][1]);break;case 14:this.$=new r.MustacheNode(o[s-1][0],o[s-1][1]);break;case 15:this.$=o[s-1];break;case 16:this.$=new r.MustacheNode(o[s-1][0],o[s-1][1]);break;case 17:this.$=new r.MustacheNode(o[s-1][0],o[s-1][1],!0);break;case 18:this.$=new r.PartialNode(o[s-1]);break;case 19:this.$=new r.PartialNode(o[s-2],o[s-1]);break;case 20:break;case 21:this.$=[[o[s-2]].concat(o[s-1]),o[s]];break;case 22:this.$=[[o[s-1]].concat(o[s]),null];break;case 23:this.$=[[o[s-1]],o[s]];break;case 24:this.$=[[o[s]],null];break;case 25:o[s-1].push(o[s]),this.$=o[s-1];break;case 26:this.$=[o[s]];break;case 27:this.$=o[s];break;case 28:this.$=new r.StringNode(o[s]);break;case 29:this.$=new r.IntegerNode(o[s]);break;case 30:this.$=new r.BooleanNode(o[s]);break;case 31:this.$=new r.HashNode(o[s]);break;case 32:o[s-1].push(o[s]),this.$=o[s-1];break;case 33:this.$=[o[s]];break;case 34:this.$=[o[s-2],o[s]];break;case 35:this.$=[o[s-2],new r.StringNode(o[s])];break;case 36:this.$=[o[s-2],new r.IntegerNode(o[s])];break;case 37:this.$=[o[s-2],new r.BooleanNode(o[s])];break;case 38:this.$=new r.IdNode(o[s]);break;case 39:o[s-2].push(o[s]),this.$=o[s-2];break;case 40:this.$=[o[s]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function i(e,t){throw new Error(e)},parse:function o(e){function t(e){i.length=i.length-2*e,o.length=o.length-e,a.length=a.length-e}function n(){var e;return e=r.lexer.lex()||1,"number"!=typeof e&&(e=r.symbols_[e]||e),e}var r=this,i=[0],o=[null],a=[],s=this.table,u="",l=0,c=0,d=0,f=2,p=1;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var h=this.lexer.yylloc;a.push(h),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var g,_,m,v,b,y,S={},w,E,T,I;;){if(m=i[i.length-1],this.defaultActions[m]?v=this.defaultActions[m]:(null==g&&(g=n()),v=s[m]&&s[m][g]),!("undefined"!=typeof v&&v.length&&v[0]||d)){I=[];for(w in s[m])this.terminals_[w]&&w>2&&I.push("'"+this.terminals_[w]+"'");var M="";M=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+I.join(", ")+", got '"+this.terminals_[g]+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==g?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(M,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:h,expected:I})}if(v[0]instanceof Array&&v.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+g);switch(v[0]){case 1:i.push(g),o.push(this.lexer.yytext),a.push(this.lexer.yylloc),i.push(v[1]),g=null,_?(g=_,_=null):(c=this.lexer.yyleng,u=this.lexer.yytext,l=this.lexer.yylineno,h=this.lexer.yylloc,d>0&&d--);break;case 2:if(E=this.productions_[v[1]][1],S.$=o[o.length-E],S._$={first_line:a[a.length-(E||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(E||1)].first_column,last_column:a[a.length-1].last_column},y=this.performAction.call(S,u,c,l,this.yy,v[1],o,a),"undefined"!=typeof y)return y;E&&(i=i.slice(0,2*-1*E),o=o.slice(0,-1*E),a=a.slice(0,-1*E)),i.push(this.productions_[v[1]][0]),o.push(S.$),a.push(S._$),T=s[i[i.length-2]][i[i.length-1]],i.push(T);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function t(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e;var t=e.match(/\n/);return t&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r;this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),o=0;o<i.length;o++)if(t=this._input.match(this.rules[i[o]]))return r=t[0].match(/\n.*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-1:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,i[o],this.conditionStack[this.conditionStack.length-1]),e?e:void 0;return""===this._input?this.EOF:(this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno}),void 0)},lex:function n(){var e=this.next();return"undefined"!=typeof e?e:this.lex()},begin:function r(e){this.conditionStack.push(e)},popState:function i(){return this.conditionStack.pop()},_currentRules:function o(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function a(e){this.begin(e)}};return e.performAction=function s(e,t,n,r){var i=r;switch(n){case 0:if("\\"!==t.yytext.slice(-1)&&this.begin("mu"),"\\"===t.yytext.slice(-1)&&(t.yytext=t.yytext.substr(0,t.yyleng-1),this.begin("emu")),t.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return t.yytext=t.yytext.substr(3,t.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 34;case 13:return 33;case 14:return 33;case 15:return 36;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\"/g,'"'),28;case 20:return 30;case 21:return 30;case 22:return 29;case 23:return 33;case 24:return t.yytext=t.yytext.substr(1,t.yyleng-2),33;case 25:return"INVALID";case 26:return 5}},e.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{\$[\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/],e.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,26],inclusive:!0}},e}();return e.lexer=t,e}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=handlebars,exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)},exports.main=function e(e){if(!e[1])throw new Error("Usage: "+e[0]+" FILE");if("undefined"!=typeof process)var t=require("fs").readFileSync(require("path").join(process.cwd(),e[1]),"utf8");else var n=require("file").path(require("file").cwd()),t=n.join(e[1]).read({charset:"utf-8"});return exports.parser.parse(t)},"undefined"!=typeof module&&require.main===module&&exports.main("undefined"!=typeof process?process.argv.slice(1):require("system").args)),Handlebars.Parser=handlebars,Handlebars.parse=function(e){return Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(e)},Handlebars.print=function(e){return(new Handlebars.PrintVisitor).accept(e)},Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){}},Handlebars.log=function(e,t){Handlebars.logger.log(e,t)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(e,t){this.type="program",this.statements=e,t&&(this.inverse=new Handlebars.AST.ProgramNode(t))},Handlebars.AST.MustacheNode=function(e,t,n){this.type="mustache",this.id=e[0],this.params=e.slice(1),this.hash=t,this.escaped=!n},Handlebars.AST.PartialNode=function(e,t){this.type="partial",this.id=e,this.context=t};var e=function(e,t){if(e.original!==t.original)throw new Handlebars.Exception(e.original+" doesn't match "+t.original)};Handlebars.AST.BlockNode=function(t,n,r){e(t.id,r),this.type="block",this.mustache=t,this.program=n},Handlebars.AST.InverseNode=function(t,n,r){e(t.id,r),this.type="inverse",this.mustache=t,this.program=n},Handlebars.AST.ContentNode=function(e){this.type="content",this.string=e},Handlebars.AST.HashNode=function(e){this.type="hash",this.pairs=e},Handlebars.AST.IdNode=function(e){this.type="ID",this.original=e.join(".");for(var t=[],n=0,r=0,i=e.length;i>r;r++){var o=e[r];".."===o?n++:"."===o||"this"===o?this.isScoped=!0:t.push(o)}this.parts=t,this.string=t.join("."),this.depth=n,this.isSimple=1===t.length&&0===n},Handlebars.AST.StringNode=function(e){this.type="STRING",this.string=e},Handlebars.AST.IntegerNode=function(e){this.type="INTEGER",this.integer=e},Handlebars.AST.BooleanNode=function(e){this.type="BOOLEAN",this.bool=e},Handlebars.AST.CommentNode=function(e){this.type="comment",this.comment=e},Handlebars.AST.NativeNode=function(e){this.type="nativerun",this.code=e}}(),Handlebars.Exception=function(e){var t=Error.prototype.constructor.apply(this,arguments);for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);this.message=t.message},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(e){this.string=e},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},t=/&(?!\w+;)|[<>"'`]/g,n=/[&<>"'`]/,r=function(t){return e[t]||"&amp;"};Handlebars.Utils={escapeExpression:function(e){return e instanceof Handlebars.SafeString?e.toString():null==e||e===!1?"":n.test(e)?e.replace(t,r):e},isEmpty:function(e){if("undefined"==typeof e)return!0;if(null===e)return!0;if(e===!1)return!0;if("[object Array]"===Object.prototype.toString.call(e)&&0===e.length)return!0;
if("object"==typeof e){for(var t in e)return!1;return!0}return!1}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(e,t){e.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16,nativerun:17},e.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1,nativerun:1},e.DISASSEMBLE_MAP={};for(var n in e.OPCODE_MAP){var r=e.OPCODE_MAP[n];e.DISASSEMBLE_MAP[r]=n}e.multiParamSize=function(t){return e.MULTI_PARAM_OPCODES[e.DISASSEMBLE_MAP[t]]},e.prototype={compiler:e,disassemble:function(){for(var t=this.opcodes,n,r,i=[],o,a,s,u=0,l=t.length;l>u;u++)if(n=t[u],"DECLARE"===n)a=t[++u],s=t[++u],i.push("DECLARE "+a+" = "+s);else{o=e.DISASSEMBLE_MAP[n];for(var c=e.multiParamSize(n),d=[],f=0;c>f;f++)r=t[++u],"string"==typeof r&&(r='"'+r.replace("\n","\\n")+'"'),d.push(r);o=o+" "+d.join(" "),i.push(o)}return i.join("\n")},guid:0,compile:function(e,t){this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},n)for(var r in n)this.options.knownHelpers[r]=n[r];return this.program(e)},accept:function(e){return this[e.type](e)},program:function(e){var t=e.statements,n;this.opcodes=[];for(var r=0,i=t.length;i>r;r++)n=t[r],this[n.type](n);return this.isSimple=1===i,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++;this.usePartial=this.usePartial||t.usePartial,this.children[n]=t;for(var r=0,i=t.depths.list.length;i>r;r++)depth=t.depths.list[r],2>depth||this.addDepth(depth-1);return n},block:function(e){var t=e.mustache,n,r,i,o,a=this.setupStackForMustache(t),s=this.compileProgram(e.program);e.program.inverse&&(o=this.compileProgram(e.program.inverse),this.declare("inverse",o)),this.opcode("invokeProgram",s,a.length,!!t.hash),this.declare("inverse",null),this.opcode("append")},inverse:function(e){var t=this.setupStackForMustache(e.mustache),n=this.compileProgram(e.program);this.declare("inverse",n),this.opcode("invokeProgram",null,t.length,!!e.mustache.hash),this.declare("inverse",null),this.opcode("append")},hash:function(e){var t=e.pairs,n,r;this.opcode("push","{}");for(var i=0,o=t.length;o>i;i++)n=t[i],r=n[1],this.accept(r),this.opcode("assignToHash",n[0])},partial:function(e){var t=e.id;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.original),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.setupStackForMustache(e);this.opcode("invokeMustache",t.length,e.id.original,!!e.hash),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth),this.opcode("lookupWithHelpers",e.parts[0]||null,e.isScoped||!1);for(var t=1,n=e.parts.length;n>t;t++)this.opcode("lookup",e.parts[t])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("push",e.integer)},BOOLEAN:function(e){this.opcode("push",e.bool)},comment:function(){},nativerun:function(e){this.opcode("nativerun",e.code)},pushParams:function(e){for(var t=e.length,n;t--;)n=e[t],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.string)):this[n.type](n)},opcode:function(t,n,r,i){this.opcodes.push(e.OPCODE_MAP[t]),void 0!==n&&this.opcodes.push(n),void 0!==r&&this.opcodes.push(r),void 0!==i&&this.opcodes.push(i)},declare:function(e,t){this.opcodes.push("DECLARE"),this.opcodes.push(e),this.opcodes.push(t)},addDepth:function(e){0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},setupStackForMustache:function(e){var t=e.params;return this.pushParams(t),e.hash&&this.hash(e.hash),this.ID(e.id),t}},t.prototype={nameLookup:function(e,n,r){return/^[0-9]+$/.test(n)?e+"["+n+"]":t.isValidJavaScriptVariableName(n)?e+"."+n:e+"['"+n+"']"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":"buffer += "+e+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,r){this.environment=e,this.options=t||{},this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],aliases:{self:"this"},registers:{list:[]}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.compileChildren(e,t);var i=e.opcodes,o;for(this.i=0,s=i.length;this.i<s;this.i++)o=this.nextOpcode(0),"DECLARE"===o[0]?(this.i=this.i+2,this[o[1]]=o[2]):(this.i=this.i+o[1].length,this[o[0]].apply(this,o[1]));return this.createFunctionContext(r)},nextOpcode:function(t){var n=this.environment.opcodes,r=n[this.i+t],i,o,a,s;if("DECLARE"===r)return i=n[this.i+1],o=n[this.i+2],["DECLARE",i,o];i=e.DISASSEMBLE_MAP[r],a=e.multiParamSize(r),s=[];for(var u=0;a>u;u++)s.push(n[this.i+u+1+t]);return[i,s]},eat:function(e){this.i=this.i+e.length},preamble:function(){var e=[];if(this.useRegister("foundHelper"),this.isChild)e.push("");else{var t=this.namespace,n="helpers = helpers || "+t+".helpers;";this.environment.usePartial&&(n=n+" partials = partials || "+t+".partials;"),e.push(n)}this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars;if(this.isChild||(t=t.concat(this.context.registers.list)),t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", ")),!this.isChild){var n=[];for(var r in this.context.aliases)this.source[1]=this.source[1]+", "+r+"="+this.context.aliases[r]}this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var i=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],o=0,a=this.environment.depths.list.length;a>o;o++)i.push("depth"+this.environment.depths.list[o]);if(e)return i.push(this.source.join("\n  ")),Function.apply(this,i);var s="function "+(this.name||"")+"("+i.join(",")+") {\n  "+this.source.join("\n  ")+"}";return Handlebars.log(Handlebars.logger.DEBUG,s+"\n\n"),s},appendContent:function(e){this.source.push(this.appendToBuffer(this.quotedString(e)))},append:function(){var e=this.popStack();this.source.push("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var e=this.nextOpcode(1),t="";this.context.aliases.escapeExpression="this.escapeExpression","appendContent"===e[0]&&(t=" + "+this.quotedString(e[1][0]),this.eat(e)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+t))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupWithHelpers:function(e,t){if(e){var n=this.nextStack();this.usingKnownHelper=!1;var r;!t&&this.options.knownHelpers[e]?(r=n+" = "+this.nameLookup("helpers",e,"helper"),this.usingKnownHelper=!0):t||this.options.knownHelpersOnly?r=n+" = "+this.nameLookup("depth"+this.lastContext,e,"context"):(this.register("foundHelper",this.nameLookup("helpers",e,"helper")),r=n+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,e,"context")),r+=";",this.source.push(r)}else this.pushStack("depth"+this.lastContext)},lookup:function(e){var t=this.topStack();this.source.push(t+" = ("+t+" === null || "+t+" === undefined || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")+");")},nativerun:function(e){e.match(/this/)&&(e=e.replace(/this/g,"depth0")),this.source.push("if(!Handlebars.Utils.isEmpty(depth0)){with(depth0){"+this.appendToBuffer(e)+"}}")},pushStringParam:function(e){this.pushStack("depth"+this.lastContext),this.pushString(e)},pushString:function(e){this.pushStack(this.quotedString(e))},push:function(e){this.pushStack(e)},invokeMustache:function(e,t,n){this.populateParams(e,this.quotedString(t),"{}",null,n,function(e,t,n){this.usingKnownHelper||(this.context.aliases.helperMissing="helpers.helperMissing",this.context.aliases.undef="void 0",this.source.push("else if("+n+"=== undef) { "+e+" = helperMissing.call("+t+"); }"),e!==n&&this.source.push("else { "+e+" = "+n+"; }"))})},invokeProgram:function(e,t,n){var r=this.programExpression(this.inverse),i=this.programExpression(e);this.populateParams(t,null,i,r,n,function(e,t,n){this.usingKnownHelper||(this.context.aliases.blockHelperMissing="helpers.blockHelperMissing",this.source.push("else { "+e+" = blockHelperMissing.call("+t+"); }"))})},populateParams:function(e,t,n,r,i,o){var a=i||this.options.stringParams||r||this.options.data,s=this.popStack(),u,l=[],c,d,f;if(a?(this.register("tmp1",n),f="tmp1"):f="{ hash: {} }",a){var p=i?this.popStack():"{}";this.source.push("tmp1.hash = "+p+";")}this.options.stringParams&&this.source.push("tmp1.contexts = [];");for(var h=0;e>h;h++)c=this.popStack(),l.push(c),this.options.stringParams&&this.source.push("tmp1.contexts.push("+this.popStack()+");");r&&(this.source.push("tmp1.fn = tmp1;"),this.source.push("tmp1.inverse = "+r+";")),this.options.data&&this.source.push("tmp1.data = data;"),l.push(f),this.populateCall(l,s,t||s,o,"{}"!==n)},populateCall:function(e,t,n,r,i){var o=["depth0"].concat(e).join(", "),a=["depth0"].concat(n).concat(e).join(", "),s=this.nextStack();if(this.usingKnownHelper)this.source.push(s+" = "+t+".call("+o+");");else{this.context.aliases.functionType='"function"';var u=i?"foundHelper && ":"";this.source.push("if("+u+"typeof "+t+" === functionType) { "+s+" = "+t+".call("+o+"); }")}r.call(this,s,a,t),this.usingKnownHelper=!1},invokePartial:function(e){params=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"],this.options.data&&params.push("data"),this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(e){var t=this.popStack(),n=this.topStack();this.source.push(n+"['"+e+"'] = "+t+";")},compiler:t,compileChildren:function(e,t){for(var n=e.children,r,i,o=0,a=n.length;a>o;o++){r=n[o],i=new this.compiler,this.context.programs.push("");var s=this.context.programs.length;r.index=s,r.name="program"+s,this.context.programs[s]=i.compile(r,t,this.context)}},programExpression:function(e){if(null==e)return"self.noop";for(var t=this.environment.children[e],n=t.depths.list,r=[t.index,t.name,"data"],i=0,o=n.length;o>i;i++)depth=n[i],1===depth?r.push("depth0"):r.push("depth"+(depth-1));return 0===n.length?"self.program("+r.join(", ")+")":(r.shift(),"self.programWithDepth("+r.join(", ")+")")},register:function(e,t){this.useRegister(e),this.source.push(e+" = "+t+";")},useRegister:function(e){this.context.registers[e]||(this.context.registers[e]=!0,this.context.registers.list.push(e))},pushStack:function(e){return this.source.push(this.nextStack()+" = "+e+";"),"stack"+this.stackSlot},nextStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};for(var i="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),o=t.RESERVED_WORDS={},a=0,s=i.length;s>a;a++)o[i[a]]=!0;t.isValidJavaScriptVariableName=function(e){return!t.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1}}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.precompile=function(e,t){t=t||{};var n=Handlebars.parse(e),r=(new Handlebars.Compiler).compile(n,t);return(new Handlebars.JavaScriptCompiler).compile(r,t)},Handlebars.compile=function(e,t){function n(){var n=Handlebars.parse(e),r=(new Handlebars.Compiler).compile(n,t),i=(new Handlebars.JavaScriptCompiler).compile(r,t,void 0,!0);return Handlebars.template(i)}t=t||{};var r;return function(e,t){return r||(r=n()),r.call(this,e,t)}},Handlebars.VM={template:function(e){var t={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(e,t,n){var r=this.programs[e];return n?Handlebars.VM.program(t,n):r?r:r=this.programs[e]=Handlebars.VM.program(t)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(n,r){return r=r||{},e.call(t,Handlebars,n,r.helpers,r.partials,r.data)}},programWithDepth:function(e,t,n){var r=Array.prototype.slice.call(arguments,2);return function(n,i){return i=i||{},e.apply(this,[n,i.data||t].concat(r))}},program:function(e,t){return function(n,r){return r=r||{},e(n,r.data||t)}},noop:function(){return""},invokePartial:function(e,t,n,r,i,o){if(options={helpers:r,partials:i,data:o},void 0===e)throw new Handlebars.Exception("The partial "+t+" could not be found");if(e instanceof Function)return e(n,options);if(Handlebars.compile)return i[t]=Handlebars.compile(e),i[t](n,options);throw new Handlebars.Exception("The partial "+t+" could not be compiled when running in runtime-only mode")}},Handlebars.template=Handlebars.VM.template,"undefined"!=typeof module&&module.exports&&(module.exports=Handlebars);var runnable=function(e){e.registerHelper("foreach",function(e,t){var n="",r;if(e){if(e instanceof Array)for(var i=0,o=e.length;o>i;i++)n+=t.fn({key:i,index:i,value:e[i]});else if("object"==typeof e)for(r in e)e.hasOwnProperty(r)&&(n+=t.fn({key:r,value:e[r]}))}else n=t.inverse(this);return n}),e.registerHelper("compare",function(e,t,n,r){var i,o;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");if(void 0===r&&(r=n,n=t,t="==="),i={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return t>e},">":function(e,t){return e>t},"<=":function(e,t){return t>=e},">=":function(e,t){return e>=t},"typeof":function(e,t){return typeof e==t}},!i[t])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+t);return o=i[t](e,n),o?r.fn(this):r.inverse(this)})};if("undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(Handlebars),Library.net=sumeru.Library.create(function(e){return e.get=function(e){var t=new window.XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState){var n,r=!1;t.status>=200&&t.status<300||0==t.status&&"file:"==location.protocol?(n=t.responseText,e.callback(n)):e.callback(t.responseText)}},t.open("GET",e.url,!0),t.send(e.query||"")},e}),SockJS=function(){var e=document,t=window,n={},r=function(){};r.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var r=this._listeners[e];-1===n.arrIndexOf(r,t)&&r.push(t)},r.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var r=this._listeners[e],i=n.arrIndexOf(r,t);return-1!==i?(r.length>1?this._listeners[e]=r.slice(0,i).concat(r.slice(i+1)):delete this._listeners[e],void 0):void 0}},r.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,n),this._listeners&&t in this._listeners)for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].apply(this,n)};var i=function(e,t){if(this.type=e,"undefined"!=typeof t)for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])};i.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var n=this[t];"function"==typeof n&&(n="[function]"),e.push(t+"="+n)}return"SimpleEvent("+e.join(", ")+")"};var o=function(e){this.events=e||[]};o.prototype.emit=function(e){var t=this,r=Array.prototype.slice.call(arguments,1);!t.nuked&&t["on"+e]&&t["on"+e].apply(t,r),-1===n.arrIndexOf(t.events,e)&&n.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t.events)+" in "+t)},o.prototype.nuke=function(e){var t=this;t.nuked=!0;for(var n=0;n<t.events.length;n++)delete t[t.events[n]]};var a="abcdefghijklmnopqrstuvwxyz0123456789_";n.random_string=function(e,t){t=t||a.length;var n,r=[];for(n=0;e>n;n++)r.push(a.substr(Math.floor(Math.random()*t),1));return r.join("")},n.random_number=function(e){return Math.floor(Math.random()*e)},n.random_number_string=function(e){var t=(""+(e-1)).length,r=Array(t+1).join("0");return(r+n.random_number(e)).slice(-t)},n.getOrigin=function(e){e+="/";var t=e.split("/").slice(0,3);return t.join("/")},n.isSameOriginUrl=function(e,n){return n||(n=t.location.href),e.split("/").slice(0,3).join("/")===n.split("/").slice(0,3).join("/")},n.getParentDomain=function(e){if(/^[0-9.]*$/.test(e))return e;if(/^\[/.test(e))return e;if(!/[.]/.test(e))return e;var t=e.split(".").slice(1);return t.join(".")},n.objectExtend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e};var s="_jp";n.polluteGlobalNamespace=function(){s in t||(t[s]={})},n.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},n.userSetCode=function(e){return 1e3===e||e>=3e3&&4999>=e},n.countRTO=function(e){var t;return t=e>100?3*e:e+200},n.log=function(){t.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},n.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},n.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},n.amendUrl=function(t){var r=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!n.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=r.protocol+t),0===t.indexOf("/")&&(t=r.protocol+"//"+r.host+t),t=t.replace(/[/]+$/,"")},n.arrIndexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},n.arrSkip=function(e,t){var r=n.arrIndexOf(e,t);if(-1===r)return e.slice();var i=e.slice(0,r);return i.concat(e.slice(r+1))},n.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},n.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var u=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","﻿":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},c=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,d,f=JSON&&JSON.stringify||function(e){return u.lastIndex=0,u.test(e)&&(e=e.replace(u,function(e){return l[e]})),'"'+e+'"'},p=function(e){var t,n={},r=[];for(t=0;65536>t;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n};n.quote=function(e){var t=f(e);return c.lastIndex=0,c.test(t)?(d||(d=p(c)),t.replace(c,function(e){return d[e]})):t};var h=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];n.probeProtocols=function(){for(var e={},t=0;t<h.length;t++){var n=h[t];e[n]=T[n]&&T[n].enabled()}return e},n.detectProtocols=function(e,t,n){var r={},i=[];t||(t=h);for(var o=0;o<t.length;o++){var a=t[o];r[a]=e[a]}var s=function(e){var t=e.shift();r[t]?i.push(t):e.length>0&&s(e)};return n.websocket!==!1&&s(["websocket"]),r["xhr-streaming"]&&!n.null_origin?i.push("xhr-streaming"):!r["xdr-streaming"]||n.cookie_needed||n.null_origin?s(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),r["xhr-polling"]&&!n.null_origin?i.push("xhr-polling"):!r["xdr-polling"]||n.cookie_needed||n.null_origin?s(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";n.createHook=function(){var e="a"+n.random_string(8);if(!(g in t)){var r={};t[g]=function(e){return e in r||(r[e]={id:e,del:function(){delete r[e]}}),r[e]}}return t[g](e)},n.attachMessage=function(e){n.attachEvent("message",e)},n.attachEvent=function(n,r){"undefined"!=typeof t.addEventListener?t.addEventListener(n,r,!1):(e.attachEvent("on"+n,r),t.attachEvent("on"+n,r))},n.detachMessage=function(e){n.detachEvent("message",e)},n.detachEvent=function(n,r){"undefined"!=typeof t.addEventListener?t.removeEventListener(n,r,!1):(e.detachEvent("on"+n,r),t.detachEvent("on"+n,r))};var _={},m=!1,v=function(){for(var e in _)_[e](),delete _[e]},b=function(){m||(m=!0,v())};n.attachEvent("beforeunload",b),n.attachEvent("unload",b),n.unload_add=function(e){var t=n.random_string(8);return _[t]=e,m&&n.delay(v),t},n.unload_del=function(e){e in _&&delete _[e]},n.createIframe=function(t,r){var i=e.createElement("iframe"),o,a,s=function(){clearTimeout(o);try{i.onload=null}catch(e){}i.onerror=null},u=function(){i&&(s(),setTimeout(function(){i&&i.parentNode.removeChild(i),i=null},0),n.unload_del(a))},l=function(e){i&&(u(),r(e))},c=function(e,t){try{i&&i.contentWindow&&i.contentWindow.postMessage(e,t)}catch(n){}};return i.src=t,i.style.display="none",i.style.position="absolute",i.onerror=function(){l("onerror")},i.onload=function(){clearTimeout(o),o=setTimeout(function(){l("onload timeout")},2e3)},e.body.appendChild(i),o=setTimeout(function(){l("timeout")},15e3),a=n.unload_add(u),{post:c,cleanup:u,loaded:s}},n.createHtmlfile=function(e,r){var i=new ActiveXObject("htmlfile"),o,a,u,l=function(){clearTimeout(o)},c=function(){i&&(l(),n.unload_del(a),u.parentNode.removeChild(u),u=i=null,CollectGarbage())},d=function(e){i&&(c(),r(e))},f=function(e,t){try{u&&u.contentWindow&&u.contentWindow.postMessage(e,t)}catch(n){}};i.open(),i.write('<html><script>document.domain="'+document.domain+'";'+"</s"+"cript></html>"),i.close(),i.parentWindow[s]=t[s];var p=i.createElement("div");return i.body.appendChild(p),u=i.createElement("iframe"),p.appendChild(u),u.src=e,o=setTimeout(function(){d("timeout")},15e3),a=n.unload_add(c),{post:f,cleanup:c,loaded:l}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(e,r,i,o){var a=this;try{a.xhr=new XMLHttpRequest}catch(s){}if(!a.xhr)try{a.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(s){}(t.ActiveXObject||t.XDomainRequest)&&(r+=(-1===r.indexOf("?")?"?":"&")+"t="+ +new Date),a.unload_ref=n.unload_add(function(){a._cleanup(!0)});try{a.xhr.open(e,r,!0)}catch(u){return a.emit("finish",0,""),a._cleanup(),void 0}if(o&&o.no_credentials||(a.xhr.withCredentials="true"),o&&o.headers)for(var l in o.headers)a.xhr.setRequestHeader(l,o.headers[l]);a.xhr.onreadystatechange=function(){if(a.xhr){var e=a.xhr;switch(e.readyState){case 3:try{var t=e.status,n=e.responseText}catch(e){}n&&n.length>0&&a.emit("chunk",t,n);break;case 4:a.emit("finish",e.status,e.responseText),a._cleanup(!1)}}},a.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(n.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(r){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var S=n.XHRCorsObject=function(){var e=this,t=arguments;n.delay(function(){e._start.apply(e,t)})};S.prototype=new y;var w=n.XHRLocalObject=function(e,t,r){var i=this;n.delay(function(){i._start(e,t,r,{no_credentials:!0})})};w.prototype=new y;var E=n.XDRObject=function(e,t,r){var i=this;n.delay(function(){i._start(e,t,r)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,r){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var a=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=n.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(r)}catch(s){a()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(n.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(r){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},n.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:L.enabled()?3:4};var T=function(e,t,r){var i=this,o;i._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},r&&n.objectExtend(i._options,r),i._base_url=n.amendUrl(e),i._server=i._options.server||n.random_number_string(1e3),i._options.protocols_whitelist&&i._options.protocols_whitelist.length?o=i._options.protocols_whitelist:(o="string"==typeof t&&t.length>0?[t]:n.isArray(t)?t:null,o&&i._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),i._protocols=[],i.protocol=null,i.readyState=T.CONNECTING,i._ir=$(i._base_url),i._ir.onfinish=function(e,t){i._ir=null,e?(i._options.info&&(e=n.objectExtend(e,i._options.info)),i._options.rtt&&(t=i._options.rtt),i._applyInfo(e,t,o),i._didClose()):i._didClose(1002,"Can't connect to server",!0)}};T.prototype=new r,T.version="0.3.1",T.CONNECTING=0,T.OPEN=1,T.CLOSING=2,T.CLOSED=3,T.prototype._debug=function(){this._options.debug&&n.log.apply(n,arguments)},T.prototype._dispatchOpen=function(){var e=this;e.readyState===T.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=T.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},T.prototype._dispatchMessage=function(e){var t=this;t.readyState===T.OPEN&&t.dispatchEvent(new i("message",{data:e}))},T.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===T.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},T.prototype._didClose=function(e,t,r){var o=this;if(o.readyState!==T.CONNECTING&&o.readyState!==T.OPEN&&o.readyState!==T.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var a=new i("close",{code:e,reason:t,wasClean:n.userSetCode(e)});if(!n.userSetCode(e)&&o.readyState===T.CONNECTING&&!r){if(o._try_next_protocol(a))return;a=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:a})}o.readyState=T.CLOSED,n.delay(function(){o.dispatchEvent(a)})},T.prototype._didMessage=function(e){var t=this,n=e.slice(0,1);switch(n){case"o":t._dispatchOpen();break;case"a":for(var r=JSON.parse(e.slice(1)||"[]"),i=0;i<r.length;i++)t._dispatchMessage(r[i]);break;case"m":var r=JSON.parse(e.slice(1)||"null");t._dispatchMessage(r);break;case"c":var r=JSON.parse(e.slice(1)||"[]");t._didClose(r[0],r[1]);break;case"h":t._dispatchHeartbeat()}},T.prototype._try_next_protocol=function(t){var r=this;for(r.protocol&&(r._debug("Closed transport:",r.protocol,""+t),r.protocol=null),r._transport_tref&&(clearTimeout(r._transport_tref),r._transport_tref=null);;){var i=r.protocol=r._protocols.shift();if(!i)return!1;if(T[i]&&T[i].need_body===!0&&(!e.body||"undefined"!=typeof e.readyState&&"complete"!==e.readyState))return r._protocols.unshift(i),r.protocol="waiting-for-load",n.attachEvent("load",function(){r._try_next_protocol()}),!0;if(T[i]&&T[i].enabled(r._options)){var o=T[i].roundTrips||1,a=(r._options.rto||0)*o||5e3;r._transport_tref=n.delay(a,function(){r.readyState===T.CONNECTING&&r._didClose(2007,"Transport timeouted")});var s=n.random_string(8),u=r._base_url+"/"+r._server+"/"+s;return r._debug("Opening transport:",i," url:"+u," RTO:"+r._options.rto),r._transport=new T[i](r,u,r._base_url),!0}r._debug("Skipping transport:",i)}},T.prototype.close=function(e,t){var r=this;if(e&&!n.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return r.readyState!==T.CONNECTING&&r.readyState!==T.OPEN?!1:(r.readyState=T.CLOSING,r._didClose(e||1e3,t||"Normal closure"),!0)},T.prototype.send=function(e){var t=this;if(t.readyState===T.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===T.OPEN&&t._transport.doSend(n.quote(""+e)),!0},T.prototype._applyInfo=function(t,r,i){var o=this;o._options.info=t,o._options.rtt=r,o._options.rto=n.countRTO(r),o._options.info.null_origin=!e.domain;var a=n.probeProtocols();o._protocols=n.detectProtocols(a,i,t)};var I=T.websocket=function(e,r){var i=this,o=r+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=e,i.url=o;var a=t.WebSocket||t.MozWebSocket;i.ws=new a(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=n.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(n.closeFrame(1006,"WebSocket connection broken"))}};I.prototype.doSend=function(e){this.ws.send("["+e+"]")},I.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),n.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},I.enabled=function(){return!!t.WebSocket||!!t.MozWebSocket},I.roundTrips=2;var M=function(){};M.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},M.prototype.doSend=function(e){var t=this;
t.send_buffer.push(e),t.send_stop||t.send_schedule()},M.prototype.send_schedule_wait=function(){var e=this,t;e.send_stop=function(){e.send_stop=null,clearTimeout(t)},t=n.delay(25,function(){e.send_stop=null,e.send_schedule()})},M.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(){e.send_stop=null,e.send_schedule_wait()}),e.send_buffer=[]}},M.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var C=function(t,r,i){var o=this;if(!("_send_form"in o)){var a=o._send_form=e.createElement("form"),s=o._send_area=e.createElement("textarea");s.name="d",a.style.display="none",a.style.position="absolute",a.method="POST",a.enctype="application/x-www-form-urlencoded",a.acceptCharset="UTF-8",a.appendChild(s),e.body.appendChild(a)}var a=o._send_form,s=o._send_area,u="a"+n.random_string(8);a.target=u,a.action=t+"/jsonp_send?i="+u;var l;try{l=e.createElement('<iframe name="'+u+'">')}catch(c){l=e.createElement("iframe"),l.name=u}l.id=u,a.appendChild(l),l.style.display="none";try{s.value=r}catch(d){n.log("Your browser is seriously broken. Go home! "+d.message)}a.submit();var f=function(e){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,n.delay(500,function(){l.parentNode.removeChild(l),l=null}),s.value="",i())};return l.onerror=l.onload=f,l.onreadystatechange=function(e){"complete"==l.readyState&&f()},f},x=function(e){return function(t,n,r){var i=new e("POST",t+"/xhr_send",n);return i.onfinish=function(e,t){r(e)},function(e){r(0,e)}}},k=function(t,r){var i,o=e.createElement("script"),a,s=function(e){a&&(a.parentNode.removeChild(a),a=null),o&&(clearTimeout(i),o.parentNode.removeChild(o),o.onreadystatechange=o.onerror=o.onload=o.onclick=null,o=null,r(e),r=null)},u=!1,l=null;if(o.id="a"+n.random_string(8),o.src=t,o.type="text/javascript",o.charset="UTF-8",o.onerror=function(e){l||(l=setTimeout(function(){u||s(n.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},o.onload=function(e){s(n.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},o.onreadystatechange=function(e){if(/loaded|closed/.test(o.readyState)){if(o&&o.htmlFor&&o.onclick){u=!0;try{o.onclick()}catch(t){}}o&&s(n.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof o.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))a=e.createElement("script"),a.text="try{var a = document.getElementById('"+o.id+"'); if(a)a.onerror();}catch(x){};",o.async=a.async=!1;else{try{o.htmlFor=o.id,o.event="onclick"}catch(c){}o.async=!0}"undefined"!=typeof o.async&&(o.async=!0),i=setTimeout(function(){s(n.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var d=e.getElementsByTagName("head")[0];return d.insertBefore(o,d.firstChild),a&&d.insertBefore(a,d.firstChild),s},O=T["jsonp-polling"]=function(e,t){n.polluteGlobalNamespace();var r=this;r.ri=e,r.trans_url=t,r.send_constructor(C),r._schedule_recv()};O.prototype=new M,O.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=N(e.trans_url+"/jsonp",k,t)},O.enabled=function(){return!0},O.need_body=!0,O.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var N=function(e,r,i){var o="a"+n.random_string(6),a=e+"?c="+escape(s+"."+o),u=function(e){delete t[s][o],i(e)},l=r(a,u);t[s][o]=l;var c=function(){t[s][o]&&t[s][o](n.closeFrame(1e3,"JSONP user aborted read"))};return c},A=function(){};A.prototype=new M,A.prototype.run=function(e,t,n,r,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(x(i)),o.poll=new Y(e,r,t+n,i)},A.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var P=T["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",rt,n.XHRCorsObject)};P.prototype=new A,P.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},P.roundTrips=2,P.need_body=!0;var R=T["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",rt,n.XDRObject)};R.prototype=new A,R.enabled=function(){return!!t.XDomainRequest},R.roundTrips=2;var D=T["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XHRCorsObject)};D.prototype=new A,D.enabled=P.enabled,D.roundTrips=2;var B=T["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XDRObject)};B.prototype=new A,B.enabled=R.enabled,B.roundTrips=2;var L=function(){};L.prototype.i_constructor=function(e,t,r){var i=this;i.ri=e,i.origin=n.getOrigin(r),i.base_url=r,i.trans_url=t;var o=r+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=n.random_string(8),o+="#"+i.window_id,i.iframeObj=n.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=n.bind(i.onmessage,i),n.attachMessage(i.onmessage_cb)},L.prototype.doCleanup=function(){var e=this;if(e.iframeObj){n.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},L.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var n=e.data.slice(0,8),r=e.data.slice(8,9),i=e.data.slice(9);if(n===t.window_id)switch(r){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([T.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},L.prototype.postMessage=function(e,t){var n=this;n.iframeObj.post(n.window_id+e+(t||""),n.origin)},L.prototype.doSend=function(e){this.postMessage("m",e)},L.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var H,U=function(e,r){parent!==t?parent.postMessage(H+e+(r||""),"*"):n.log("Can't postMessage, no parent window.",e,r)},j=function(){};j.prototype._didClose=function(e,t){U("t",n.closeFrame(e,t))},j.prototype._didMessage=function(e){U("t",e)},j.prototype._doSend=function(e){this._transport.doSend(e)},j.prototype._doCleanup=function(){this._transport.doCleanup()},n.parent_origin=void 0,T.bootstrap_iframe=function(){var r;H=e.location.hash.slice(1);var i=function(e){if(e.source===parent&&("undefined"==typeof n.parent_origin&&(n.parent_origin=e.origin),e.origin===n.parent_origin)){var i=e.data.slice(0,8),o=e.data.slice(8,9),a=e.data.slice(9);if(i===H)switch(o){case"s":var s=JSON.parse(a),u=s[0],l=s[1],c=s[2],d=s[3];if(u!==T.version&&n.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe:'+' "'+T.version+'".'),!n.flatUrl(c)||!n.flatUrl(d))return n.log("Only basic urls are supported in SockJS"),void 0;if(!n.isSameOriginUrl(c)||!n.isSameOriginUrl(d))return n.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,c,d])+")"),void 0;r=new j,r._transport=new j[l](r,c,d);break;case"m":r._doSend(a);break;case"c":r&&r._doCleanup(),r=null}}};n.attachMessage(i),U("s")};var F=function(e,t){var r=this;n.delay(function(){r.doXhr(e,t)})};F.prototype=new o(["finish"]),F.prototype.doXhr=function(e,t){var r=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),a=n.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(a),a=null,200===e){var n=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),r.emit("finish",o,n)}else r.emit("finish")},o.ontimeout=function(){o.close(),r.emit("finish")}};var q=function(t){var r=this,i=function(){var e=new L;e.protocol="w-iframe-info-receiver";var n=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var n=JSON.parse(t.substr(1)),i=n[0],o=n[1];r.emit("finish",i,o)}else r.emit("finish");e.doCleanup(),e=null},i={_options:{},_didClose:n,_didMessage:n};e.i_constructor(i,t,t)};e.body?i():n.attachEvent("load",i)};q.prototype=new o(["finish"]);var V=function(){var e=this;n.delay(function(){e.emit("finish",{},2e3)})};V.prototype=new o(["finish"]);var $=function(e){if(n.isSameOriginUrl(e))return new F(e,n.XHRLocalObject);switch(n.isXHRCorsCapable()){case 1:return new F(e,n.XHRCorsObject);case 2:return new F(e,n.XDRObject);case 3:return new q(e);default:return new V}},G=j["w-iframe-info-receiver"]=function(e,t,r){var i=new F(r,n.XHRLocalObject);i.onfinish=function(t,n){e._didMessage("m"+JSON.stringify([t,n])),e._didClose()}};G.prototype.doCleanup=function(){};var W=T["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};W.prototype=new L,W.enabled=function(){return"EventSource"in t&&L.enabled()},W.need_body=!0,W.roundTrips=3;var J=j["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,n.XHRLocalObject)};J.prototype=new A;var z=T["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};z.prototype=new L,z.enabled=function(){return t.XMLHttpRequest&&L.enabled()},z.need_body=!0,z.roundTrips=3;var K=j["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XHRLocalObject)};K.prototype=new A;var X=T["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};X.prototype=new L,X.enabled=function(){return L.enabled()},X.need_body=!0,X.roundTrips=3;var Q=j["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",nt,n.XHRLocalObject)};Q.prototype=new A;var Y=function(e,t,n,r){var i=this;i.ri=e,i.Receiver=t,i.recv_url=n,i.AjaxObject=r,i._scheduleRecv()};Y.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),n=0;t.onmessage=function(t){n+=1,e.ri._didMessage(t.data)},t.onclose=function(n){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===n.reason?e.ri._didClose(1006,"Polling error ("+n.reason+")"):e._scheduleRecv())}},Y.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,r=new EventSource(e);r.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=r.onerror=function(e,o){var a=o?"user":2!==r.readyState?"network":"permanent";t.es_close=r.onmessage=r.onerror=null,r.close(),r=null,n.delay(200,function(){t.dispatchEvent(new i("close",{reason:a}))})}};Z.prototype=new r,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var et,tt=function(){if(void 0===et)if("ActiveXObject"in t)try{et=!!new ActiveXObject("htmlfile")}catch(e){}else et=!1;return et},nt=function(e){var r=this;n.polluteGlobalNamespace(),r.id="a"+n.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape(s+"."+r.id);var o=tt()?n.createHtmlfile:n.createIframe,a;t[s][r.id]={start:function(){a.loaded()},message:function(e){r.dispatchEvent(new i("message",{data:e}))},stop:function(){r.iframe_close({},"network")}},r.iframe_close=function(e,n){a.cleanup(),r.iframe_close=a=null,delete t[s][r.id],r.dispatchEvent(new i("close",{reason:n}))},a=o(e,function(e){r.iframe_close({},"permanent")})};nt.prototype=new r,nt.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var rt=function(e,t){var n=this,r=0;n.xo=new t("POST",e,null),n.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(r),a=o.indexOf("\n");if(-1===a)break;r+=a+1;var s=o.slice(0,a);n.dispatchEvent(new i("message",{data:s}))}},n.xo.onfinish=function(e,t){n.xo.onchunk(e,t),n.xo=null;var r=200===e?"network":"permanent";n.dispatchEvent(new i("close",{reason:r}))}};return rt.prototype=new r,rt.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},T.getUtils=function(){return n},T.getIframeTransport=function(){return L},T}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),Library.string=sumeru.Library.create(function(e){return e.trim=function(e){return e.replace(/^\s|\s$/g,"")},e.escapeRegex=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},e}),Library.screenUtils=sumeru.Library.create(function(e){var t=e.fullScreen=function(){function e(){var e=document.documentElement,t=window.innerHeight,n=window.outerHeight,r=window.devicePixelRatio;e.style.height="100%",n>scrollHeight&&(e.style.height=n/window.devicePixelRatio+"px"),setTimeout(function(){window.scrollTo(0,1)},0)}window.addEventListener("load",function(){e()}),window.addEventListener("orientationchange",function(){document.documentElement.style.height="auto",e(),setTimeout(function(){e()},800)})};return e}),"undefined"!=typeof module&&module.exports){var runnable=function(e){Library.cookie=e.Library.create(function(e){var t="",n={},r=e.addCookie=function(e,t,r){n[e]=t},i=e.getCookie=function(e){return n[e]||t},o=e.deleteCookie=function(e){delete n[e]},a=e.parseCookie=function(e,t){if("string"!=typeof e)return"";for(var n=e.split("; "),r=0;r<n.length;r++){var i=n[r].split("=");if(i[0]==t)return i[1]}return""};return e})};module.exports=runnable}else Library.cookie=sumeru.Library.create(function(e){var t="",n=e.addCookie=function(e,t,n){var r=e+"="+escape(t);if(n>0){var i=new Date;i.setTime(i.getTime()+1e3*3600*n),r=r+"; path=/; expires="+i.toGMTString()}else r+="; path=/";document.cookie=r},r=e.getCookie=function(e){for(var n=document.cookie,r=n.split("; "),i=0;i<r.length;i++){var o=r[i].split("=");if(o[0]==e)return o[1]}return t},i=e.deleteCookie=function(e){n(e,t)};return e});var touch=Library.touch=sumeru.Library.create(function(e){function t(e,t){var n=_.get(e,"_touchEv");n||(n=new b(e),_.set(e,"_touchEv",n)),n["on"+t]=function(n){m.trigger(e,t,n)}}function n(e){var t=_.get(e,"_touchEv");t&&(_.set(e,"_touchEv",null),t.tearDown())}var r=function(e){if(!e||"object"!==o(e)||e.nodeType||e===e.window)return!1;var t=Object.prototype.hasOwnProperty;if(e.constructor&&!t.call(e,"constructor")&&!t.call(e.constructor.prototype,"isPrototypeOf"))return!1;var n;for(n in e);return void 0===n||t.call(e,n)},i={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){i["[object "+e+"]"]=e.toLowerCase()});var o=function(e){return null==e?"null":i[Object.prototype.toString.call(e)]||"object"},a=function(e){return"object"===o(e)},s=function(e){return"array"===o(e)},u=function(e){return"function"===o(e)},l=function(e){return"string"===o(e)},c=function(e){return"bollean"===o(e)},d=function(e){return"number"===o(e)},f=function(e){return"date"===o(e)},p=function(e){return"regexp"===o(e)},h=function(){var e,t,n,i,o,a,l=arguments[0]||{},c=1,d=arguments.length,f=!1;if("boolean"==typeof l&&(f=l,l=arguments[1]||{},c=2),"object"==typeof l||u(l)||(l={}),d===c)return l;for(;d>c;c++)if(null!=(e=arguments[c]))for(t in e)n=l[t],i=e[t],l!==i&&(f&&i&&(r(i)||(o=s(i)))?(o?(o=!1,a=n&&s(n)?n:[]):a=n&&r(n)?n:{},l[t]=h(f,a,i)):void 0!==i&&(l[t]=i));return l},g=function(){var e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ",t=e.length-1;return{query:function(e){return document.querySelectorAll(e)},randomStr:function(n){var r="";n="undefined"==typeof n?8:n;for(var i=0;n>i;i++)r+=e[Math.floor(Math.random()*(t+1))];return r},getElUID:function(e){var t=e.getAttribute("data-uid");return t||(t=this.randomStr(18),e.setAttribute("data-uid",t)),t},addEvents:function(e,t,n){t=t?t.split(" "):[];for(var r=0,i=t.length;i>r;r++)e.addEventListener&&n&&e.addEventListener(t[r],n,!1)},removeEvents:function(e,t,n){t=t?t.split(" "):[];for(var r=0,i=t.length;i>r;r++)e.removeEventListener&&e.removeEventListener(t[r],n,!1)},deepCopy:function(e,t){return t||(t=e,e={}),h(!0,e,t),e}}}(),_=function(){var e={};return{get:function(t,n){var r=g.getElUID(t);return e[r]=e[r]||{},1===arguments.length?e[r]:e[r][n]},set:function(t,n,r){var i=g.getElUID(t);e[i]=e[i]||{},e[i][n]=r}}}(),m=function(){var e={},t={};return{trigger:function(n,r,i){for(var o=g.getElUID(n),a=e[o][r].handler,s=x,u=[s.SWIPE_START,s.SWIPING,s.SWIPE_END,s.SWIPE_LEFT,s.SWIPE_RIGHT,s.SWIPE_UP,s.SWIPE_DOWN,s.SWIPE],l=function(e,n,r,i){r&&r.interval?(t[e]=t[e]||{},t[e].list=t[e].list||[],t[e].list.push(function(e,t,n){return function(){e.call(t,n)}}(e,n,i)),t[e].interval||(t[e].interval=setInterval(function(e){return function(){var n=t[e].list.shift();n?n():(clearInterval(t[e].interval),t[e].interval=null)}}(e),r.interval))):e.call(n,i)},c=0,d=a.length;d>c;c++){var f=a[c].options;if(-1!=u.indexOf(r)&&f&&f.swipeFactor){var p=i.duration/1e3;i.factor=10*(10-f.swipeFactor)*p*p}if(f&&f.__binding_live){var h=i.originEvent.target;h&&3===h.nodeType&&(h=h.parentNode);var _=g.query(f.__binding_live);_&&_.length>0&&(_=Array.prototype.slice.apply(_,[0]),_.forEach(function(e){e.contains(h)&&l(a[c],e,f,i)}))}else l(a[c],n,f,i)}},off:function(){if("undefined"!=typeof arguments[0]){var t=g.getElUID(arguments[0]);if("string"==typeof arguments[3]){var n=[];try{n=e[t][arguments[1]].handler}catch(r){n=[]}if(arguments[2]){var i=n.indexOf(arguments[2]);if(i>-1){var o=n.splice(i,1);delete o.options}}else for(var a=0;a<n.length;a++){var s=n[a].options;if(s&&s.__binding_live&&s.__binding_live===arguments[3]){var o=n.splice(a,1);delete o.options,a--}}return!1}if(1==arguments.length)e[t]=null;else if(2===arguments.length)e[t]&&(e[t][arguments[1]]=null);else if(e[t]&&e[t][arguments[1]]&&e[t][arguments[1]].handler){var n=e[t][arguments[1]].handler,i=n.indexOf(arguments[2]);if(i>-1){var o=n.splice(i,1);delete o.options}}}},add:function(t,n,r,i){var o=g.getElUID(t);e[o]=e[o]||{},e[o][n]=e[o][n]||{},e[o][n].handler=e[o][n].handler||[],!i||(r.options=i),"function"==typeof r?e[o][n].handler.push(r):null},hasHandler:function(t,n){try{var r=g.getElUID(t),i=e[r][n].handler;return i&&i.length>0?!0:!1}catch(o){return!1}},isEmpty:function(t){var n=g.getElUID(t),r=e[n];for(var i in r)if(r[i]&&r[i].handler&&0!==r[i].handler.length)return!1;return!0}}}(),v={tap:!0,doubleTap:!0,tapMaxDistance:10,hold:!0,holdTime:650,maxDoubleTapInterval:300,swipe:!0,swipeTime:300,swipeMinDistance:18,swipeFactor:5,drag:!0,pinch:!0,minScaleRate:0,minRotationAngle:0},b=function(){function e(e){if(l){for(var t=[],n=null,r=0,i=e.touches.length;i>r;r++)n=e.touches[r],t.push({x:n.pageX,y:n.pageY});return t}return[{x:e.pageX,y:e.pageY}]}function t(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function n(e){return e.touches?e.touches.length:1}function r(e,n){if(e.length>=2&&n.length>=2){var r=t(e[1],e[0]),i=t(n[1],n[0]);return i/r}return 1}function i(e,t){return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI}function o(e,t){var n=Math.atan(-1*(t.y-e.y)/(t.x-e.x))*(180/Math.PI);return 0>n?n+180:n}function a(e){var t={up:-45>e&&e>-135,down:e>=45&&135>e,left:e>=135||-135>=e,right:e>=-45&&45>=e};for(var n in t)if(t[n])return n;return null}function s(e){e.preventDefault(),e.stopPropagation()}function u(e){for(var t=0,n=0;e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:t,top:n}}var l="ontouchstart"in window;return function(s){function c(e,t){"function"==typeof b["on"+e]&&b["on"+e](t)}function d(){E=T=I=null,P=N=M=C=!1,k=!1,y={},B=!1}function f(e){return"touchstart"===e.type||"mousedown"===e.type}function p(e){return"touchmove"===e.type||"mousemove"===e.type}function h(e){return"touchend"===e.type||"mouseup"===e.type||"touchcancel"===e.type}function _(e,t,n,r){m.hasHandler(e,t)&&(r="undefind"==typeof r?!0:r,r&&(n=g.deepCopy(n)),n.type=t,n.startRotate=function(){b.startRotate()},c(t,n))}var b=this,y={start:null,move:null,end:null},S=0,w=0,E=null,T=null,I=null,M=!1,C=!1,k=!1,O={},N=!1,A=null,P=!1,R=null,D=1,B=!1,L=[],H=0,U=0,j=0,F=null,q={_getAngleDiff:function(e){for(var t=parseInt(H-o(e[0],e[1]),10),n=0;Math.abs(t-U)>90&&n++<50;)0>U?t-=180:t+=180;return U=parseInt(t,10)},pinch:function(e){if(v.pinch){if(!N)return;if(n(e)<2&&!h(e))return;var t=m,i=r(y.start,y.move),o=this._getAngleDiff(y.move),a={type:"",originEvent:e,scale:i,rotation:o,direction:o>0?"right":"left",fingersCount:n(e),startRotate:function(){b.startRotate()}};if(C?p(e)?a.fingerStatus="move":h(e)&&(a.fingerStatus="end",_(s,x.PINCH_END,a)):(C=!0,a.fingerStatus="start",_(s,x.PINCH_START,a)),_(s,x.PINCH,a),Math.abs(1-i)>v.minScaleRate){var u=g.deepCopy(a),l=1e-11;i>D?(D=i-l,_(s,x.PINCH_OUT,u,!1)):D>i&&(D=i+l,_(s,x.PINCH_IN,u,!1)),h(e)&&(D=1)}if(Math.abs(o)>v.minRotationAngle){var c=g.deepCopy(a),d;d=o>0?x.ROTATION_RIGHT:x.ROTATION_LEFT,_(s,d,c,!1),_(s,x.ROTATION,a)}}},rotateSingleFinger:function(e){if(B&&n(e)<2){if(!y.move)return;if(L.length<2){var t=u(s);L=[{x:t.left+s.offsetWidth/2,y:t.top+s.offsetHeight/2},y.move[0]],H=parseInt(o(L[0],L[1]),10)}var r=[L[0],y.move[0]],i=this._getAngleDiff(r),a={type:"",originEvent:e,rotation:i,direction:i>0?"right":"left",fingersCount:n(e)};p(e)?a.fingerStatus="move":(h(e)||"mouseout"===e.type)&&(a.fingerStatus="end",_(s,x.PINCH_END,a)),eventType=i>0?x.ROTATION_RIGHT:x.ROTATION_LEFT,_(s,eventType,a),_(s,x.ROTATION,a)}},swipe:function(e){if(N&&y.move&&!(n(e)>1)){var r=m,o=Date.now(),u=o-S,l=t(y.start[0],y.move[0]),c={x:y.move[0].x-O.left,y:y.move[0].y-O.top},d=i(y.start[0],y.move[0]),f=a(d),g=u/1e3,b=10*(10-v.swipeFactor)*g*g,w={type:x.SWIPE,originEvent:e,position:c,direction:f,distance:l,distanceX:y.move[0].x-y.start[0].x,distanceY:y.move[0].y-y.start[0].y,angle:d,duration:u,fingersCount:n(e),factor:b};if(v.swipe){var E=function(){var e=x;switch(f){case"up":_(s,e.SWIPE_UP,w);break;case"down":_(s,e.SWIPE_DOWN,w);break;case"left":_(s,e.SWIPE_LEFT,w);break;case"right":_(s,e.SWIPE_RIGHT,w)}};M?p(e)?(w.fingerStatus=w.swipe="move",_(s,x.SWIPING,w),u>v.swipeTime&&u<v.swipeTime+50&&l>v.swipeMinDistance&&(E(),_(s,x.SWIPE,w,!1))):(h(e)||"mouseout"===e.type)&&(w.fingerStatus=w.swipe="end",_(s,x.SWIPE_END,w),v.swipeTime>u&&l>v.swipeMinDistance&&(E(),_(s,x.SWIPE,w,!1))):(w.fingerStatus=w.swipe="start",M=!0,_(s,x.SWIPE_START,w))}v.drag&&(k?p(e)?w.fingerStatus=w.swipe="move":h(e)&&(w.fingerStatus=w.swipe="end"):(w.fingerStatus=w.swipe="start",k=!0),_(s,x.DRAG,w))}},tap:function(e){if(v.tap){var r=m,i=Date.now(),o=i-S,a=t(y.start[0],y.move?y.move[0]:y.start[0]);clearTimeout(A);var u=function(){if(F&&v.doubleTap&&S-j<v.maxDoubleTapInterval){var e=t(F,y.start[0]);if(16>e)return!0}return!1}();if(u)return c(x.DOUBLE_TAP,{type:x.DOUBLE_TAP,originEvent:e,position:y.start[0]}),void 0;if(v.tapMaxDistance<a)return;v.holdTime>o&&n(e)<=1&&(P=!0,j=i,F=y.start[0],r.hasHandler(s,x.TAP)&&c(x.TAP,{type:x.TAP,originEvent:e,fingersCount:n(e),position:y.start[0]}),r.hasHandler(s,x.CLICK)&&c(x.CLICK,{type:x.CLICK,originEvent:e,fingersCount:n(e),position:y.start[0]}))}},hold:function(e){v.hold&&(clearTimeout(A),A=setTimeout(function(){if(y.start){var r=t(y.start[0],y.move?y.move[0]:y.start[0]);v.tapMaxDistance<r||P||c("hold",{type:"hold",originEvent:e,fingersCount:n(e),position:y.start[0]})}},v.holdTime))}},V=function(t){switch(t.type){case"touchstart":case"mousedown":B=!1,L=[],_(s,t.type,{originEvent:t}),N=!0,(!y.start||y.start.length<2)&&(y.start=e(t)),n(t)>=2&&(H=parseInt(o(y.start[0],y.start[1]),10)),S=Date.now(),E=t,O={};var r=s.getBoundingClientRect(),i=document.documentElement;O={top:r.top+(window.pageYOffset||i.scrollTop)-(i.clientTop||0),left:r.left+(window.pageXOffset||i.scrollLeft)-(i.clientLeft||0)},q.hold(t);break;case"touchmove":case"mousemove":if(_(s,t.type,{originEvent:t}),!N||!y.start)return;y.move=e(t),n(t)>=2?q.pinch(t):B?q.rotateSingleFinger(t):q.swipe(t);break;case"touchend":case"touchcancel":case"mouseup":case"mouseout":if(_(s,t.type,{originEvent:t}),!N)return;I=t,C?q.pinch(t):B?q.rotateSingleFinger(t):M&&q.swipe(t),q.tap(t),d(),H=0,U=0,t.touches&&1===t.touches.length&&(N=!0,B=!0)}},$=l?"touchstart touchmove touchend touchcancel":"mouseup mousedown mousemove mouseout";g.addEvents(s,$,V),this.tearDown=function(){g.removeEvents(s,$,V)},this.startRotate=function(){B=!0}}}(),y=function(){if(typeof arguments.length<3)throw"Please specify complete argments";var e="string"==typeof arguments[0]?g.query(arguments[0]):[arguments[0]],t=arguments[1].split(" "),n=arguments[arguments.length-1],r=arguments.length>3?arguments[arguments.length-2]:void 0;e=Array.prototype.slice.apply(e,[0]),e.forEach(function(e){for(var i=0;i<t.length;i++){var o=I(t[i]);k.special[o]?(m.add(e,o,n,r),k.special[o].setUp.apply(this,[e,o])):g.addEvents(e,o,n)}})},S=function(){if(arguments.length<3)throw new Error("wrong argument");if("string"!=typeof arguments[0])return y.apply(e,arguments),void 0;var t=arguments.length>3?arguments[arguments.length-2]:{},n=arguments[1],r=arguments[arguments.length-1];t.__binding_live=arguments[0],y.apply(e,[document.body,n,t,r])},w=function(e,t,n,r){if("undefined"==typeof e)throw"Please specify the selector.";e="string"==typeof e?g.query(e):[e],e=Array.prototype.slice.apply(e,[0]),t?(t=t.split(" "),e.forEach(function(e){t.forEach(function(t,i){var o=[e,I(t)];n?o.push(n):null,r?o.push(r):null,k.special[t]?(m.off.apply(m,o),m.isEmpty(e,t)&&k.special[t].tearDown(e)):g.removeEvents.apply(this,o)})})):(m.off(e),g.removeEvents(e))},E=function(e,t,n){w(document.body,t,n,e)},T={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"},I=function(e){return"ontouchstart"in window||!T[e]?e:T[e]},M=function(e){"object"==typeof e&&(v=h(v,e))},C={setUp:t,tearDown:n},x={TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",CLICK:"click",PINCH_START:"pinchstart",PINCH_END:"pinchend",PINCH:"pinch",PINCH_IN:"pinchin",PINCH_OUT:"pinchout",ROTATION_LEFT:"rotateleft",ROTATION_RIGHT:"rotateright",ROTATION:"rotate",SWIPE_START:"swipestart",SWIPING:"swiping",SWIPE_END:"swipeend",SWIPE_LEFT:"swipeleft",SWIPE_RIGHT:"swiperight",SWIPE_UP:"swipeup",SWIPE_DOWN:"swipedown",SWIPE:"swipe",DRAG:"drag",HOLD:"hold",TAP:"tap",DOUBLE_TAP:"doubletap"},k={};return k.special={},Object.keys(x).forEach(function(e){k.special[x[e]]=C}),e.live=S,e.die=E,e.on=y,e.off=w,e.config=M,e});!function(){Library.domUtils=sumeru.Library.create(function(e){e.on=function(e,t,n){e&&t&&n&&(0==t.indexOf("on")&&(t=t.substr(2)),e.addEventListener(t,n))},e.hasClass=function(e,t){if(""==e.className)return!1;if(e.classList&&e.classList.contains)return e.classList.contains(t);var n=e.className.split(" ");return-1!==n.indexOf(t)}})}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,o,a=gap,s,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(o=u.length,n=0;o>n;n+=1)s[n]=str(n,u)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],i=str(r,u),i&&s.push(quote(r)+(gap?": ":":")+i));else for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(i=str(r,u),i&&s.push(quote(r)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var n=e.History=e.History||{};if("undefined"!=typeof n.Adapter)throw new Error("History.js Adapter has already been loaded...");n.Adapter={handlers:{},_uid:1,uid:function(e){return e._uid||(e._uid=n.Adapter._uid++)},bind:function(e,t,r){var i=n.Adapter.uid(e);n.Adapter.handlers[i]=n.Adapter.handlers[i]||{},n.Adapter.handlers[i][t]=n.Adapter.handlers[i][t]||[],n.Adapter.handlers[i][t].push(r),e["on"+t]=function(e,t){return function(r){n.Adapter.trigger(e,t,r)}}(e,t)},trigger:function(e,t,r){r=r||{};var i=n.Adapter.uid(e),o,a;for(n.Adapter.handlers[i]=n.Adapter.handlers[i]||{},n.Adapter.handlers[i][t]=n.Adapter.handlers[i][t]||[],o=0,a=n.Adapter.handlers[i][t].length;a>o;++o)n.Adapter.handlers[i][t][o].apply(this,[r])},extractEventData:function(e,n){var r=n&&n[e]||t;return r},onDomLoad:function(t){var n=e.setTimeout(function(){t()},2e3);e.onload=function(){clearTimeout(n),t()}}},"undefined"!=typeof n.init&&n.init()}(window),function(e,t){"use strict";var n=e.document,r=e.setTimeout||r,i=e.clearTimeout||i,o=e.setInterval||o,a=e.History=e.History||{};if("undefined"!=typeof a.initHtml4)throw new Error("History.js HTML4 Support has already been loaded...");a.initHtml4=function(){return"undefined"!=typeof a.initHtml4.initialized?!1:(a.initHtml4.initialized=!0,a.enabled=!0,a.savedHashes=[],a.isLastHash=function(e){var t=a.getHashByIndex(),n;return n=e===t},a.isHashEqual=function(e,t){return e=encodeURIComponent(e).replace(/%25/g,"%"),t=encodeURIComponent(t).replace(/%25/g,"%"),e===t},a.saveHash=function(e){return a.isLastHash(e)?!1:(a.savedHashes.push(e),!0)},a.getHashByIndex=function(e){var t=null;return t="undefined"==typeof e?a.savedHashes[a.savedHashes.length-1]:0>e?a.savedHashes[a.savedHashes.length+e]:a.savedHashes[e]},a.discardedHashes={},a.discardedStates={},a.discardState=function(e,t,n){var r=a.getHashByState(e),i;return i={discardedState:e,backState:n,forwardState:t},a.discardedStates[r]=i,!0},a.discardHash=function(e,t,n){var r={discardedHash:e,backState:n,forwardState:t};return a.discardedHashes[e]=r,!0},a.discardedState=function(e){var t=a.getHashByState(e),n;return n=a.discardedStates[t]||!1},a.discardedHash=function(e){var t=a.discardedHashes[e]||!1;return t},a.recycleState=function(e){var t=a.getHashByState(e);return a.discardedState(e)&&delete a.discardedStates[t],!0},a.emulated.hashChange&&(a.hashChangeInit=function(){a.checkerFunction=null;var t="",r,i,s,u,l=Boolean(a.getHash());return a.isInternetExplorer()?(r="historyjs-iframe",i=n.createElement("iframe"),i.setAttribute("id",r),i.setAttribute("src","#"),i.style.display="none",n.body.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.close(),s="",u=!1,a.checkerFunction=function(){if(u)return!1;u=!0;var n=a.getHash(),r=a.getHash(i.contentWindow.document);return n!==t?(t=n,r!==n&&(s=r=n,i.contentWindow.document.open(),i.contentWindow.document.close(),i.contentWindow.document.location.hash=a.escapeHash(n)),a.Adapter.trigger(e,"hashchange")):r!==s&&(s=r,l&&""===r?a.back():a.setHash(r,!1)),u=!1,!0
}):a.checkerFunction=function(){var n=a.getHash()||"";return n!==t&&(t=n,a.Adapter.trigger(e,"hashchange")),!0},a.intervalList.push(o(a.checkerFunction,a.options.hashChangeInterval)),!0},a.Adapter.onDomLoad(a.hashChangeInit)),a.emulated.pushState&&(a.onHashChange=function(t){var n=t&&t.newURL||a.getLocationHref(),r=a.getHashByUrl(n),i=null,o=null,s=null,u;return a.isLastHash(r)?(a.busy(!1),!1):(a.doubleCheckComplete(),a.saveHash(r),r&&a.isTraditionalAnchor(r)?(a.Adapter.trigger(e,"anchorchange"),a.busy(!1),!1):(i=a.extractState(a.getFullUrl(r||a.getLocationHref()),!0),a.isLastSavedState(i)?(a.busy(!1),!1):(o=a.getHashByState(i),u=a.discardedState(i),u?(a.getHashByIndex(-2)===a.getHashByState(u.forwardState)?a.back(!1):a.forward(!1),!1):(a.pushState(i.data,i.title,encodeURI(i.url),!1),!0))))},a.Adapter.bind(e,"hashchange",a.onHashChange),a.pushState=function(t,n,r,i){if(r=encodeURI(r).replace(/%25/g,"%"),a.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(i!==!1&&a.busy())return a.pushQueue({scope:a,callback:a.pushState,args:arguments,queue:i}),!1;a.busy(!0);var o=a.createStateObject(t,n,r),s=a.getHashByState(o),u=a.getState(!1),l=a.getHashByState(u),c=a.getHash(),d=a.expectedStateId==o.id;return a.storeState(o),a.expectedStateId=o.id,a.recycleState(o),a.setTitle(o),s===l?(a.busy(!1),!1):(a.saveState(o),d||a.Adapter.trigger(e,"statechange"),!a.isHashEqual(s,c)&&!a.isHashEqual(s,a.getShortUrl(a.getLocationHref()))&&a.setHash(s,!1),a.busy(!1),!0)},a.replaceState=function(t,n,r,i){if(r=encodeURI(r).replace(/%25/g,"%"),a.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(i!==!1&&a.busy())return a.pushQueue({scope:a,callback:a.replaceState,args:arguments,queue:i}),!1;a.busy(!0);var o=a.createStateObject(t,n,r),s=a.getHashByState(o),u=a.getState(!1),l=a.getHashByState(u),c=a.getStateByIndex(-2);return a.discardState(u,o,c),s===l?(a.storeState(o),a.expectedStateId=o.id,a.recycleState(o),a.setTitle(o),a.saveState(o),a.Adapter.trigger(e,"statechange"),a.busy(!1)):a.pushState(o.data,o.title,o.url,!1),!0}),a.emulated.pushState&&a.getHash()&&!a.emulated.hashChange&&a.Adapter.onDomLoad(function(){a.Adapter.trigger(e,"hashchange")}),void 0)},"undefined"!=typeof a.init&&a.init()}(window),function(e,t){"use strict";var n=e.console||t,r=e.document,i=e.navigator,o=e.sessionStorage||!1,a=e.setTimeout,s=e.clearTimeout,u=e.setInterval,l=e.clearInterval,c=e.JSON,d=e.alert,f=e.History=e.History||{},p=e.history;try{o.setItem("TEST","1"),o.removeItem("TEST")}catch(h){o=!1}if(c.stringify=c.stringify||c.encode,c.parse=c.parse||c.decode,"undefined"!=typeof f.init)throw new Error("History.js Core has already been loaded...");f.init=function(e){return"undefined"==typeof f.Adapter?!1:("undefined"!=typeof f.initCore&&f.initCore(),"undefined"!=typeof f.initHtml4&&f.initHtml4(),!0)},f.initCore=function(h){if("undefined"!=typeof f.initCore.initialized)return!1;if(f.initCore.initialized=!0,f.options=f.options||{},f.options.hashChangeInterval=f.options.hashChangeInterval||100,f.options.safariPollInterval=f.options.safariPollInterval||500,f.options.doubleCheckInterval=f.options.doubleCheckInterval||500,f.options.disableSuid=f.options.disableSuid||!1,f.options.storeInterval=f.options.storeInterval||1e3,f.options.busyDelay=f.options.busyDelay||250,f.options.debug=f.options.debug||!1,f.options.initialTitle=f.options.initialTitle||r.title,f.options.html4Mode=f.options.html4Mode||!1,f.options.delayInit=f.options.delayInit||!1,f.intervalList=[],f.clearAllIntervals=function(){var e,t=f.intervalList;if("undefined"!=typeof t&&null!==t){for(e=0;e<t.length;e++)l(t[e]);f.intervalList=null}},f.debug=function(){(f.options.debug||!1)&&f.log.apply(f,arguments)},f.log=function(){var e="undefined"!=typeof n&&"undefined"!=typeof n.log&&"undefined"!=typeof n.log.apply,t=r.getElementById("log"),i,o,a,s,u;for(e?(s=Array.prototype.slice.call(arguments),i=s.shift(),"undefined"!=typeof n.debug?n.debug.apply(n,[i,s]):n.log.apply(n,[i,s])):i="\n"+arguments[0]+"\n",o=1,a=arguments.length;a>o;++o){if(u=arguments[o],"object"==typeof u&&"undefined"!=typeof c)try{u=c.stringify(u)}catch(l){}i+="\n"+u+"\n"}return t?(t.value+=i+"\n-----\n",t.scrollTop=t.scrollHeight-t.clientHeight):e||d(i),!0},f.getInternetExplorerMajorVersion=function(){var e=f.getInternetExplorerMajorVersion.cached="undefined"!=typeof f.getInternetExplorerMajorVersion.cached?f.getInternetExplorerMajorVersion.cached:function(){for(var e=3,t=r.createElement("div"),n=t.getElementsByTagName("i");(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0];);return e>4?e:!1}();return e},f.isInternetExplorer=function(){var e=f.isInternetExplorer.cached="undefined"!=typeof f.isInternetExplorer.cached?f.isInternetExplorer.cached:Boolean(f.getInternetExplorerMajorVersion());return e},f.emulated=f.options.html4Mode?{pushState:!0,hashChange:!0}:{pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in r)||f.isInternetExplorer()&&f.getInternetExplorerMajorVersion()<8)},f.enabled=!f.emulated.pushState,f.bugs={setHash:Boolean(!f.emulated.pushState&&"Apple Computer, Inc."===i.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!f.emulated.pushState&&"Apple Computer, Inc."===i.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(f.isInternetExplorer()&&f.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(f.isInternetExplorer()&&f.getInternetExplorerMajorVersion()<7)},f.isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},f.cloneObject=function(e){var t,n;return e?(t=c.stringify(e),n=c.parse(t)):n={},n},f.getRootUrl=function(){var e=r.location.protocol+"//"+(r.location.hostname||r.location.host);return r.location.port&&(e+=":"+r.location.port),e+="/"},f.getBaseHref=function(){var e=r.getElementsByTagName("base"),t=null,n="";return 1===e.length&&(t=e[0],n=t.href.replace(/[^\/]+$/,"")),n=n.replace(/\/+$/,""),n&&(n+="/"),n},f.getBaseUrl=function(){var e=f.getBaseHref()||f.getBasePageUrl()||f.getRootUrl();return e},f.getPageUrl=function(){var e=f.getState(!1,!1),t=(e||{}).url||f.getLocationHref(),n;return n=t.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"})},f.getBasePageUrl=function(){var e=f.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e},f.getFullUrl=function(e,t){var n=e,r=e.substring(0,1);return t="undefined"==typeof t?!0:t,/[a-z]+\:\/\//.test(e)||(n="/"===r?f.getRootUrl()+e.replace(/^\/+/,""):"#"===r?f.getPageUrl().replace(/#.*/,"")+e:"?"===r?f.getPageUrl().replace(/[\?#].*/,"")+e:t?f.getBaseUrl()+e.replace(/^(\.\/)+/,""):f.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),n.replace(/\#$/,"")},f.getShortUrl=function(e){var t=e,n=f.getBaseUrl(),r=f.getRootUrl();return f.emulated.pushState&&(t=t.replace(n,"")),t=t.replace(r,"/"),f.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},f.getLocationHref=function(e){return e=e||r,e.URL===e.location.href?e.location.href:e.location.href===decodeURIComponent(e.URL)?e.URL:e.location.hash&&decodeURIComponent(e.location.href.replace(/^[^#]+/,""))===e.location.hash?e.location.href:-1==e.URL.indexOf("#")&&-1!=e.location.href.indexOf("#")?e.location.href:e.URL||e.location.href},f.store={},f.idToState=f.idToState||{},f.stateToId=f.stateToId||{},f.urlToId=f.urlToId||{},f.storedStates=f.storedStates||[],f.savedStates=f.savedStates||[],f.normalizeStore=function(){f.store.idToState=f.store.idToState||{},f.store.urlToId=f.store.urlToId||{},f.store.stateToId=f.store.stateToId||{}},f.getState=function(e,t){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!0);var n=f.getLastSavedState();return!n&&t&&(n=f.createStateObject()),e&&(n=f.cloneObject(n),n.url=n.cleanUrl||n.url),n},f.getIdByState=function(e){var t=f.extractId(e.url),n;if(!t)if(n=f.getStateString(e),"undefined"!=typeof f.stateToId[n])t=f.stateToId[n];else if("undefined"!=typeof f.store.stateToId[n])t=f.store.stateToId[n];else{for(;t=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"!=typeof f.idToState[t]||"undefined"!=typeof f.store.idToState[t];);f.stateToId[n]=t,f.idToState[t]=e}return t},f.normalizeState=function(e){var t,n;return e&&"object"==typeof e||(e={}),"undefined"!=typeof e.normalized?e:(e.data&&"object"==typeof e.data||(e.data={}),t={},t.normalized=!0,t.title=e.title||"",t.url=f.getFullUrl(e.url?e.url:f.getLocationHref()),t.hash=f.getShortUrl(t.url),t.data=f.cloneObject(e.data),t.id=f.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,n=!f.isEmptyObject(t.data),(t.title||n)&&f.options.disableSuid!==!0&&(t.hash=f.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=f.getFullUrl(t.hash),(f.emulated.pushState||f.bugs.safariPoll)&&f.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t)},f.createStateObject=function(e,t,n){var r={data:e,title:t,url:n};return r=f.normalizeState(r)},f.getStateById=function(e){e=String(e);var n=f.idToState[e]||f.store.idToState[e]||t;return n},f.getStateString=function(e){var t,n,r;return t=f.normalizeState(e),n={data:t.data,title:e.title,url:e.url},r=c.stringify(n)},f.getStateId=function(e){var t,n;return t=f.normalizeState(e),n=t.id},f.getHashByState=function(e){var t,n;return t=f.normalizeState(e),n=t.hash},f.extractId=function(e){var t,n,r,i;return i=-1!=e.indexOf("#")?e.split("#")[0]:e,n=/(.*)\&_suid=([0-9]+)$/.exec(i),r=n?n[1]||e:e,t=n?String(n[2]||""):"",t||!1},f.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},f.extractState=function(e,t){var n=null,r,i;return t=t||!1,r=f.extractId(e),r&&(n=f.getStateById(r)),n||(i=f.getFullUrl(e),r=f.getIdByUrl(i)||!1,r&&(n=f.getStateById(r)),!n&&t&&!f.isTraditionalAnchor(e)&&(n=f.createStateObject(null,null,i))),n},f.getIdByUrl=function(e){var n=f.urlToId[e]||f.store.urlToId[e]||t;return n},f.getLastSavedState=function(){return f.savedStates[f.savedStates.length-1]||t},f.getLastStoredState=function(){return f.storedStates[f.storedStates.length-1]||t},f.hasUrlDuplicate=function(e){var t=!1,n;return n=f.extractState(e.url),t=n&&n.id!==e.id},f.storeState=function(e){return f.urlToId[e.url]=e.id,f.storedStates.push(f.cloneObject(e)),e},f.isLastSavedState=function(e){var t=!1,n,r,i;return f.savedStates.length&&(n=e.id,r=f.getLastSavedState(),i=r.id,t=n===i),t},f.saveState=function(e){return f.isLastSavedState(e)?!1:(f.savedStates.push(f.cloneObject(e)),!0)},f.getStateByIndex=function(e){var t=null;return t="undefined"==typeof e?f.savedStates[f.savedStates.length-1]:0>e?f.savedStates[f.savedStates.length+e]:f.savedStates[e]},f.getCurrentIndex=function(){var e=null;return e=f.savedStates.length<1?0:f.savedStates.length-1},f.getHash=function(e){var t=f.getLocationHref(e),n;return n=f.getHashByUrl(t)},f.unescapeHash=function(e){var t=f.normalizeHash(e);return t=decodeURIComponent(t)},f.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t},f.setHash=function(e,t){var n,i;return t!==!1&&f.busy()?(f.pushQueue({scope:f,callback:f.setHash,args:arguments,queue:t}),!1):(f.busy(!0),n=f.extractState(e,!0),n&&!f.emulated.pushState?f.pushState(n.data,n.title,n.url,!1):f.getHash()!==e&&(f.bugs.setHash?(i=f.getPageUrl(),f.pushState(null,null,i+"#"+e,!1)):r.location.hash=e),f)},f.escapeHash=function(t){var n=f.normalizeHash(t);return n=e.encodeURIComponent(n),f.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),n},f.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=f.unescapeHash(t)},f.setTitle=function(e){var t=e.title,n;t||(n=f.getStateByIndex(0),n&&n.url===e.url&&(t=n.title||f.options.initialTitle));try{r.getElementsByTagName("title")[0].innerHTML=t.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(i){}return r.title=t,f},f.queues=[],f.busy=function(e){if("undefined"!=typeof e?f.busy.flag=e:"undefined"==typeof f.busy.flag&&(f.busy.flag=!1),!f.busy.flag){s(f.busy.timeout);var t=function(){var e,n,r;if(!f.busy.flag)for(e=f.queues.length-1;e>=0;--e)n=f.queues[e],0!==n.length&&(r=n.shift(),f.fireQueueItem(r),f.busy.timeout=a(t,f.options.busyDelay))};f.busy.timeout=a(t,f.options.busyDelay)}return f.busy.flag},f.busy.flag=!1,f.fireQueueItem=function(e){return e.callback.apply(e.scope||f,e.args||[])},f.pushQueue=function(e){return f.queues[e.queue||0]=f.queues[e.queue||0]||[],f.queues[e.queue||0].push(e),f},f.queue=function(e,t){return"function"==typeof e&&(e={callback:e}),"undefined"!=typeof t&&(e.queue=t),f.busy()?f.pushQueue(e):f.fireQueueItem(e),f},f.clearQueue=function(){return f.busy.flag=!1,f.queues=[],f},f.stateChanged=!1,f.doubleChecker=!1,f.doubleCheckComplete=function(){return f.stateChanged=!0,f.doubleCheckClear(),f},f.doubleCheckClear=function(){return f.doubleChecker&&(s(f.doubleChecker),f.doubleChecker=!1),f},f.doubleCheck=function(e){return f.stateChanged=!1,f.doubleCheckClear(),f.bugs.ieDoubleCheck&&(f.doubleChecker=a(function(){return f.doubleCheckClear(),f.stateChanged||e(),!0},f.options.doubleCheckInterval)),f},f.safariStatePoll=function(){var t=f.extractState(f.getLocationHref()),n;return f.isLastSavedState(t)?void 0:(n=t,n||(n=f.createStateObject()),f.Adapter.trigger(e,"popstate"),f)},f.back=function(e){return e!==!1&&f.busy()?(f.pushQueue({scope:f,callback:f.back,args:arguments,queue:e}),!1):(f.busy(!0),f.doubleCheck(function(){f.back(!1)}),p.go(-1),!0)},f.forward=function(e){return e!==!1&&f.busy()?(f.pushQueue({scope:f,callback:f.forward,args:arguments,queue:e}),!1):(f.busy(!0),f.doubleCheck(function(){f.forward(!1)}),p.go(1),!0)},f.go=function(e,t){var n;if(e>0)for(n=1;e>=n;++n)f.forward(t);else{if(!(0>e))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)f.back(t)}return f},f.emulated.pushState){var g=function(){};f.pushState=f.pushState||g,f.replaceState=f.replaceState||g}else f.onPopState=function(t,n){var r=!1,i=!1,o,a;return f.doubleCheckComplete(),o=f.getHash(),o?(a=f.extractState(o||f.getLocationHref(),!0),a?f.replaceState(a.data,a.title,a.url,!1):(f.Adapter.trigger(e,"anchorchange"),f.busy(!1)),f.expectedStateId=!1,!1):(r=f.Adapter.extractEventData("state",t,n)||!1,i=r?f.getStateById(r):f.expectedStateId?f.getStateById(f.expectedStateId):f.extractState(f.getLocationHref()),i||(i=f.createStateObject(null,null,f.getLocationHref())),f.expectedStateId=!1,f.isLastSavedState(i)?(f.busy(!1),!1):(f.storeState(i),f.saveState(i),f.setTitle(i),f.Adapter.trigger(e,"statechange"),f.busy(!1),!0))},f.Adapter.bind(e,"popstate",f.onPopState),f.pushState=function(t,n,r,i){if(f.getHashByUrl(r)&&f.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&f.busy())return f.pushQueue({scope:f,callback:f.pushState,args:arguments,queue:i}),!1;f.busy(!0);var o=f.createStateObject(t,n,r);return f.isLastSavedState(o)?f.busy(!1):(f.storeState(o),f.expectedStateId=o.id,p.pushState(o.id,o.title,o.url),f.Adapter.trigger(e,"popstate")),!0},f.replaceState=function(t,n,r,i){if(f.getHashByUrl(r)&&f.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&f.busy())return f.pushQueue({scope:f,callback:f.replaceState,args:arguments,queue:i}),!1;f.busy(!0);var o=f.createStateObject(t,n,r);return f.isLastSavedState(o)?f.busy(!1):(f.storeState(o),f.expectedStateId=o.id,p.replaceState(o.id,o.title,o.url),f.Adapter.trigger(e,"popstate")),!0};if(o){try{f.store=c.parse(o.getItem("History.store"))||{}}catch(_){f.store={}}f.normalizeStore()}else f.store={},f.normalizeStore();f.Adapter.bind(e,"unload",f.clearAllIntervals),f.saveState(f.storeState(f.extractState(f.getLocationHref(),!0))),o&&(f.onUnload=function(){var e,t,n;try{e=c.parse(o.getItem("History.store"))||{}}catch(r){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in f.idToState)f.idToState.hasOwnProperty(t)&&(e.idToState[t]=f.idToState[t]);for(t in f.urlToId)f.urlToId.hasOwnProperty(t)&&(e.urlToId[t]=f.urlToId[t]);for(t in f.stateToId)f.stateToId.hasOwnProperty(t)&&(e.stateToId[t]=f.stateToId[t]);f.store=e,f.normalizeStore(),n=c.stringify(e);try{o.setItem("History.store",n)}catch(i){if(i.code!==DOMException.QUOTA_EXCEEDED_ERR)throw i;o.length&&(o.removeItem("History.store"),o.setItem("History.store",n))}},f.intervalList.push(u(f.onUnload,f.options.storeInterval)),f.Adapter.bind(e,"beforeunload",f.onUnload),f.Adapter.bind(e,"unload",f.onUnload)),f.emulated.pushState||(f.bugs.safariPoll&&f.intervalList.push(u(f.safariStatePoll,f.options.safariPollInterval)),("Apple Computer, Inc."===i.vendor||"Mozilla"===(i.appCodeName||""))&&(f.Adapter.bind(e,"hashchange",function(){f.Adapter.trigger(e,"popstate")}),f.getHash()&&f.Adapter.onDomLoad(function(){f.Adapter.trigger(e,"hashchange")})))},(!f.options||!f.options.delayInit)&&f.init()}(window);var runnable=function(e){Library.asyncCallbackHandler=e.Library.create(function(e){var t=function(e,t){this.counter=0,this.callbacked=!1,this.callback=function(){this.callbacked||(e(),this.callbacked=!0)},this._enableCallback=!1,t&&(this.timeout=t),this.timeoutFunc=null};return t.prototype={add:function(){this.counter++},decrease:function(){this.counter--,this._enableCallback&&0===this.counter&&this.callback()},enableCallback:function(){this._enableCallback=!0,this.timeout&&(this.timeoutFunc=setTimeout(function(e){e.callback()}(this),this.timeout)),this._enableCallback&&0===this.counter&&this.callback()}},e.create=function(e,n){return new t(e,n)},e})};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){e.addSubPackage("oquery");var t={};t.OPERATORS=[["=",">=",">","<=","<","!=","LIKE","IN","FUNC"],["AND"],["OR"]],t.OPENOPERATORS=["=",">=",">","<=","<","!=","LIKE","IN"],t.isUnitOp=function(e){return t.OPERATORS[0].indexOf(e)>=0},t.query=function(e,n){var r=!1,i;for(op in n)if(t.isUnitOp(op))if("FUNC"==op){var o=n[op];o instanceof Function?r=t.unitOp(op,o,e):(r=!1,console.error("value is not a function."))}else r=t.unitOp(op,e.get(n[op].key),n[op].value);else if(i=n[op],"AND"==op){r=!0;for(var a=0,s=i.length;s>a&&(r=t.query(e,i[a])&&r,r);a++);}else if("OR"==op)for(var a=0,s=i.length;s>a&&!(r=t.query(e,i[a])||r);a++);return r},t.unitOp=function(e,t,n){var r=!1;switch(e){case"=":t===n&&(r=!0);break;case">=":t>=n&&(r=!0);break;case">":t>n&&(r=!0);break;case"<=":n>=t&&(r=!0);break;case"<":n>t&&(r=!0);break;case"!=":t!=n&&(r=!0);break;case"LIKE":(t+"").indexOf(n)>=0&&(r=!0);break;case"IN":n.indexOf(t)>=0&&(r=!0);break;case"FUNC":r=!!t.call(this,n);break;default:r=!1,console.error("unit operator not support.")}return r},e.oquery.__reg("_query",t.query,"private"),e.oquery.__reg("_queryop",t.OPENOPERATORS,"private")};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){e.addSubPackage("validation");var t=t||{};t.copyArgs=function(e){for(var t=[],n=0,r=e.length;r>n;n++)t.push(e[n]);return t},t.validations={},t.getErrorMsg=function(e,n,r){var i="";if(t.validations[r]&&t.validations[r].msg){i=Library.objUtils.isNumber(e)&&e>=0?t.validations[r].msg[e]:t.validations[r].msg,i=i.replace("$1",n);for(var o=2,a=arguments.length;a>o;o++)i=i.replace("$"+(o-1),arguments[o])}return i},t.unitValidation=function(e,n,r,i,o,a,s){var u=!0,l="";if(Library.objUtils.isFunction(o))u=o.call(this,i);else if(Library.objUtils.isRegExp(o))u=o.test(i);else if(Library.objUtils.isString(o)){var c=t.validations[o];if(c){if(c.runat.indexOf(e)<0&&"both"!=c.runat)return!1;if(c.regexp)u=new RegExp(c.regexp).test(i);else if(c.func){var d=t.copyArgs(arguments);d.splice(0,5,i),u=c.func.apply(this,d)}else if(c.asyncFunc)return c.asyncFunc.call(this,a,r,i,s),"asyn"}}if(!u||Library.objUtils.isNumber(u)&&u>=0){var d=t.copyArgs(arguments);d.splice(0,5,u,n,o),l=t.getErrorMsg.apply(this,d),u={value:u,msg:l}}else u=!1;return u},t.clientValidation=function(e,n,r,i){var o=t.copyArgs(arguments);return o.unshift("client"),t.unitValidation.apply(this,o)},t.serverValidation=function(e,n,r,i){var o=t.copyArgs(arguments);return o.unshift("server"),t.unitValidation.apply(this,o)},t.isAsynVali=function(e){return"undefined"!=typeof t.validations[e]&&"undefined"!=typeof t.validations[e].asyncFunc},t.addRule=function(e,n){t.validations[e]=n},e.validation.__reg("addrule",t.addRule,"publish"),e.validation.__reg("_svalidation",t.serverValidation,"private"),e.validation.__reg("_cvalidation",t.clientValidation,"private"),e.validation.__reg("_getvalidationmsg",t.getErrorMsg,"private"),e.validation.__reg("_isasynvali",t.isAsynVali,"private")};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){e.validation.addrule("length",{runat:"both",func:function(e,t,n){var e=e+""||"",r=e.length;return r>parseInt(n)?r<parseInt(t)?0:1:r<parseInt(t)?2:-1},msg:["$1长度不能大于$3，且不能小于$2。","$1长度不能大于$3。","$1长度不能小于$2。"]}),e.validation.addrule("minlength",{runat:"both",func:function(e,t){var e=e+""||"",n=e.length;return n>parseInt(t)},msg:"$1长度不能小于$2。"}),e.validation.addrule("maxlength",{runat:"both",func:function(e,t){var e=e+""||"",n=e.length;return n<parseInt(t)},msg:"$1长度不能大于$2。"}),e.validation.addrule("required",{runat:"both",func:function(e){var e="undefined"!=typeof e?e+"":"",t=e.length;return t>0},msg:"$1为必填项。"}),e.validation.addrule("number",{runat:"both",regexp:"^[0-9]+$",msg:"$1必须为数字。"}),e.validation.addrule("telephone",{runat:"both",regexp:"^(0[0-9]{2,3}-)?([2-9][0-9]{6,7})+(-[0-9]{1,4})?$",msg:"$1必须为电话号码格式。"}),e.validation.addrule("mobilephone",{runat:"both",regexp:"(^0?[1][358][0-9]{9}$)",msg:"$1必须为手机号码格式。"}),e.validation.addrule("email",{runat:"both",regexp:"^[a-zA-Z0-9_.+-]+@([a-zA-Z0-9-]+.)+[a-zA-Z0-9]{2,4}$",msg:"$1必须为email格式。"}),e.validation.addrule("onlyletter",{runat:"both",regexp:"^[a-zA-Z]+$",msg:"$只能是字母。"}),e.validation.addrule("nospecialchars",{runat:"both",regexp:"^[0-9a-zA-Z]+$",msg:"$1不能包含特殊字符。"}),e.validation.addrule("date",{runat:"both",regexp:"^[0-9]{2,4}[/-]{1}[0,1]{0,1}[0-9]{1}[/-]{1}[0,3]{0,1}[0-9]{1}$",msg:"$1格式不正确。"}),e.validation.addrule("chinese",{runat:"both",regexp:"/^[一-龥]+$/",msg:"$1必须为中文。"}),e.validation.addrule("url",{runat:"both",regexp:"/^[a-zA-z]:\\/\\/[^s]$/",msg:"$1必须为URL。"}),e.validation.addrule("unique",{runat:"server",asyncFunc:function(e,t,n,r){var i={};i[t]=n,this.find(i).toArray(function(t,n){var r=!0;t?e.call(this,t):(n.length>0&&(r=!1),e.call(this,t,r))})},msg:"$1不能重复。"})};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),Model="undefined"==typeof Model?{}:Model;var runnable=function(fw){cmodel.__reg("models",[]);var modelTools={defineProperty:function(e){Object.defineProperty(this,e,{get:function(){return this.__smr__.dataMap[e]},set:function(t){t!=this.__smr__.dataMap[e]&&(this.__smr__.dataMap[e]=t,this._setDirty())}})},setDefineProperties:function(e,t,n,r,i){var n=n||!1,r=r||!1,i=i||!1;if("undefined"!=typeof Object.defineProperty)for(var o in t)Object.defineProperty(e,o,{value:t[o],configueable:n,writable:r,enumerable:i});else for(var o in t)e[o]=t[o]}},modelBaseProto={_isModel:!0,_idField:"smr_id",_clientIdField:"__clientId",_isClean:function(){return!this.__smr__.isDirty&&!this.__smr__.isPhantom},_isDeleted:function(){return this.__smr__.isDeleted},_setDirty:function(e){e="undefined"==typeof e?!0:e,this.__smr__.isDirty=!!e},_setDeleted:function(e){e="undefined"==typeof e?!0:e,this.__smr__.isDeleted=!!e},_setPhantom:function(e){e="undefined"==typeof e?!0:e,this.__smr__.isPhantom=e,this.set(this._idField,0),this.set(this._clientIdField,fw.__random())},_setModelChain:function(e,t){this.__smr__.modelchain=e.slice(0),this.__smr__.modelchain.push(t)},_getModelChain:function(){return this.__smr__.modelchain},_delete:function(e){this.__smr__.dataMap[e]=void 0},_clean:function(){this.__smr__.isDirty=!1,this.__smr__.isDeleted=!1,this.__smr__.isPhantom=!1;var e;for(e in this._fieldsMap){var t=this._fieldsMap[e],n=t.type;"model"===n&&this[e]._clean()}},_getModelName:function(){return this._modelName},_baseSet:function(e,t){this.__smr__.dataMap[e]=t},_set:function(e,t,n){if(e in this._fieldsMap){var r=this._fieldsMap[e],i=r.type;if("model"===i){var o=r.model,a=r.relation;if("many"===a)if(t._isCollection)t._getModelName()===o?this._baseSet(e,t):fw.log("model.set arguments format error");else{this[e]._isCollection?this[e].truncate():this._baseSet(e,fw.collection.create({modelName:o}));for(var s,u=0,l=t.length;l>u;u++)s=t[u]._isModel?t[u]:cmodel.create(o,t[u]),this[e].add(s)}else t._isModel?t._getModelName()===o?this._baseSet(e,t):fw.log("model.set arguments format error"):this._baseSet(e,cmodel.create(o,t))}else{if(this[e]===t)return this;this[e]=t,e==this._idField&&0!=t&&(this.__smr__.isPhantom=!1)}this._setDirty(n)}return this},_setData:function(e,t){var e=e||{};for(var n in e)this._set(n,e[n],t);this._setDirty(t)},set:function(e,t){var n=arguments.length,r;if(1==n){if(r=arguments[0],Library.objUtils.isObject(r))for(var i in r)this._set(i,r[i],!0)}else 2==n&&this._set(e,t,!0)},_setPilotId:function(e){this.__smr__.pilotid=e},_getPilotId:function(){return"undefined"==typeof this.__smr__.pilotid?!1:this.__smr__.pilotid},_setStorable:function(){fw.msgpilot.setPilot(this)},toJSON:function(){var e={};for(key in this.__smr__.dataMap)e[key]=this._fieldsMap[key]&&"model"==this._fieldsMap[key].type?this.__smr__.dataMap[key].toJSON():this.__smr__.dataMap[key];return e},_takeSnapshot:function(){this.__smr__.dataMapSnapshot=cmodel._extend({},this.__smr__.dataMap)},_getSnapshot:function(){return this.__smr__.dataMapSnapshot},get:function(e){return this.__smr__.dataMap[e]},getId:function(){return this.__smr__.dataMap[this._idField]},getData:function(){return this.toJSON()},destroy:function(){this.__smr__.isDeleted=!0,this._setDirty()},validation:function(e){if(!fw.config.get("clientValidation"))return!0;var t=[],n,r,i,o,a,s,u,l,c=function(e,t,n){var r={};return r.key=e,r.value=t,r.msg=n.msg,r},d=function(e,t,n){var r={};return r.key=e+"."+n.key,r.value=n.value[0],r.msg=n.msg,r},f=function(e){var n=e.label||e.name,r=e.validation,o=e.validationMsg,a=e.type,s=this[e.name],u=e.name;if(r){i=Library.objUtils.isString(r)?r.split("|"):[r];for(var f=0,p=i.length;p>f;f++){var h=new RegExp("([min,max]*length)\\[([0-9]+)[\\,]*([0-9]*)\\]").exec(i[f]);if(h){if(h.length>=3){h.shift(),h.unshift(s),h.unshift(u),h.unshift(n);var g=fw.validation.__load("_cvalidation").apply(this,h);g&&t.push(c(u,s,g))}}else{var g=fw.validation.__load("_cvalidation").call(this,n,u,s,i[f]);g&&t.push(c(u,s,g))}}}else if("model"==a)for(var _=s.validation(),m=0,v=_.length;v>m;m++)l=d(u,s,_[m]),t.push(l)};if("undefined"!=typeof e)f.call(this,this._fieldsMap[e]);else for(var p in this._fieldsMap)n=this._fieldsMap[p],f.call(this,n);var h=!1;return 0===t.length&&(h=!0),this.onValidation&&this.onValidation.call(this,h,"client",t),t},_save:function(e,t,n,r){var n=n||this._getPilotId();if(t||n||(this._setStorable(),n=this._getPilotId()),!r){var i=this.validation();if(i.length>0)return i}e=e||function(){};var o,a;r?(a=this,o=a.__smr_assist__.__sourcePointer[0]):(o=this,a=cmodel._extend(createModel(this._getModelName()),o),a.__smr_assist__.__extendPointer=o,a.__smr_assist__.__pkgId=fw.__random());var s=!1,u=a.__smr__.dataMap,l=!1,c=function(e){for(var r in u)if(u[r]&&u[r]._isCollection){for(var i=0,o=u[r].length;o>i;i++)if(u[r].get(i)&&u[r].get(i)._isModel){if(u[r].get(i)._isClean())continue;if(u[r].get(i).getData().isReference)continue;return}}else if(u[r]&&u[r]._isModel&&!u[r]._isClean()&&!u[r].getData().isReference)return;if(!l){l=!0;var s=function(t){e.call(a,t)};a._proxy.save(a,s,t,n,a._getModelChain().join("."))}},d=function(r){var r=r;return r._isClean()?(r.__smr__.dataMap={isReference:!0,val:"::referenceID::"+r._getModelName()+"::"+r.getId()},void 0):(s=!0,r._save(function(t){return function(n){var r=n.cnt.smr_id;t.__smr_assist__.__sourcePointer[0].set(t._idField,r),t.__smr_assist__.__sourcePointer[0]._setDirty(!1),t.__smr__.dataMap={isReference:!0,val:"::referenceID::"+t._getModelName()+"::"+r},c(e)}}(r),t,n,!0),void 0)};for(var f in u)if(u[f]&&u[f]._isCollection){for(var p=0,h=u[f].length;h>p;p++)u[f].get(p)._isModel&&(u[f].get(p)._setModelChain(a._getModelChain(),f),d(u[f].get(p)));0===u[f].length}else u[f]&&u[f]._isModel&&(u[f]._setModelChain(a._getModelChain(),f),d(u[f]));return s||this._isClean()||c(e),!0},save:function(e,t,n){this._save(e,t,n,!1)},onValidation:function(e,t,n){}},modelBase=function(){this._modelName="",this._dal={type:"live"},this._proxy={},this._fieldsMap={},this._fieldsMap[this._idField]={name:this._idField,type:"int"},this._fieldsMap[this._clientIdField]={name:this._clientIdField,type:"string"}};modelTools.setDefineProperties(modelBase.prototype,modelBaseProto,!1,!1,!0);var model=function(){this.__smr__={dataMap:{},dataMapSnapshot:{},isDirty:!1,isPhantom:!0,isDeleted:!1,modelchain:[]},this.__smr_assist__={__sourcePointer:null,__extendPointer:null}},getModelTemp=function(e){if("undefined"==typeof cmodel.models[e]){var t={},n=cmodel._getModelDef(e);n.call(this,t),n=t;var r=new modelBase;if(r._modelName=e,"undefined"!=typeof n.config){for(var i=n.config.fields||[],o,a=0,s=i.length;s>a;a++)o=i[a],r._fieldsMap[o.name]=o;var u=n.config.layer||r._dal;r._proxy=fw.__DAL.make(u)}for(var l in n)n.hasOwnProperty(l)&&"config"!=l&&(r[l]=n[l]);cmodel.models[e]=r}return cmodel.models[e]},createModel=function(modelName,dataMap){var modelTemp=getModelTemp(modelName),newModel=new model;newModel.__proto__=modelTemp;var _fieldsMap=modelTemp._fieldsMap,oneField;for(var p in _fieldsMap)if(oneField=_fieldsMap[p],modelTools.defineProperty.call(newModel,oneField.name),"model"===oneField.type&&"undefined"!=typeof oneField.model)if("undefined"!=typeof oneField.relation&&"many"==oneField.relation){var subCollection=fw.collection.create({modelName:oneField.model});newModel[oneField.name]=subCollection}else{var subModel=cmodel.create(oneField.model);newModel[oneField.name]=subModel}else newModel[oneField.name]="datetime"==oneField.type&&"now()"==oneField.defaultValue?fw.utils.getTimeStamp():"array"==oneField.type?eval(oneField.defaultValue)||[]:"object"==oneField.type?fw.utils.parseJSON(oneField.defaultValue)||[]:oneField.defaultValue||void 0;return newModel._setPhantom(),dataMap&&newModel._setData(dataMap,!1),newModel},extendModel=function(){var e=Library.objUtils,t,n,r,i,o,a,s,u,l=arguments[0]||{},c=1,d=arguments.length;if("object"==typeof l||e.isFunction(l)||(l={}),d===c)return l;for(;d>c;c++)if(null!=(t=arguments[c]))for(n in t)t.hasOwnProperty(n)&&"__smr_assist__"!=n&&(r=l[n],i=t[n],l!==i&&(i&&(e.isPlainObject(i)||(a=i._isCollection)||(s=i._isModel)||(o=e.isArray(i)))?(o?(o=!1,u=r&&e.isArray(r)?r:[]):a?(a=!1,u=r&&r._isCollection?r:fw.collection.create({modelName:i._getModelName()})):s?(s=!1,u=r&&r._isModel?r:cmodel.create(i._getModelName()),u.__smr_assist__.__sourcePointer=i.__smr_assist__.__sourcePointer||[],u.__smr_assist__.__sourcePointer.push(i)):u=r&&e.isPlainObject(r)?r:{},l[n]=extendModel(u,i)):void 0!==i&&(l[n]=i)));return l};cmodel.__reg("create",createModel),cmodel.__reg("_extend",extendModel),cmodel.__reg("_getModelTemp",getModelTemp)},cmodel;"undefined"!=typeof module&&module.exports?module.exports=function(e){fw=e,cmodel=fw.addSubPackage("model"),cmodel.__reg("_getModelDef",function(e){return-1!=e.search("Model.")&&(e=e.substr(6)),Model[e]}),"undefined"==typeof fw.__DAL&&(fw.__DAL={},fw.__DAL.make=function(){},fw.__DAL.make.save=function(){}),runnable(fw)}:(cmodel=sumeru.addSubPackage("model"),cmodel.__reg("_getModelDef",function(modelName){return eval(modelName)
}),runnable(sumeru));var runnable=function(e){function t(e){this.modelName=e,this.dataMap={}}function n(e){return u[e]||(u[e]=new t(e)),u[e]}function r(e,t){if(!s)return a.create(e,t);var r=n(e),i;return r.get(t.smr_id)?(i=r.get(t.smr_id),i._setData(t)):(i=a.create(e,t),t.smr_id&&r.add(i)),i}function i(e,t){if(s)if(e&&t){var r=n(e);r.destroy(t)}else console.error("Please specify correct arugments.")}function o(e,t){if(s){var r=n(e);r.add(t)}}e.addSubPackage("modelPoll");var a=e.model,s=!0,u={};t.prototype={add:function(e){this.dataMap[e.smr_id]=e},destroy:function(t){this.dataMap[t.smr_id]?delete this.dataMap[t.smr_id]:e.log("Model",t,"had been already destroyed earlier.")},get:function(e){return this.dataMap[e]}},e.modelPoll.__reg("data",u),e.modelPoll.__reg("getModel",r),e.modelPoll.__reg("addModel",o),e.modelPoll.__reg("destroyModel",i)};"undefined"!=typeof module&&module.exports?module.exports=function(e){runnable(e)}:runnable(sumeru);var runnable=function(e){e.addSubPackage("collection");var t={defineProperty:function(e){Object.defineProperty(this,e,{get:function(){return this.length>0?this[0][e]:void 0},set:function(t){for(var n=0,r=this.length;r>n;n++)this[n][e]=t}})}};collectionPrototype={_isCollection:!0,_setSynced:function(e){e="undefined"==typeof e?!1:e,this.__smr__.isSynced=!!e},_isSynced:function(e){return this.__smr__.isSynced},_setNeedSort:function(e){e="undefined"==typeof e?!0:e,this.__smr__.isNeedSort=!!e},_takeSnapshot:function(){var e=this.find();e.forEach(function(e){e._takeSnapshot()})},_getModelName:function(){return this.__smr__.modelName},_setPilotId:function(e){this.__smr__.pilotid=e},_getPilotId:function(){return"undefined"==typeof this.__smr__.pilotid?!1:this.__smr__.pilotid},_setStorable:function(){e.msgpilot.setPilot(this)},setVersion:function(e){this.__smr__.version=e},getVersion:function(){return this.__smr__.version},_clean:function(){var e=this.find();e.forEach(function(e){e._clean()})},validation:function(){if(!e.config.get("clientValidation"))return!0;if(0==arguments.length){for(var t=[],n,r,i=0,o=this.length;o>i;i++){r=this[i];var a=r.validation();a!==!0&&(t=t.concat(a))}var s=!1;return 0===t.length&&(s=!0),this.onValidation&&this.onValidation.call(this,s,"client",t),s||t}},add:function(t){var n,r=this._getModelName();return t._isModel?t._getModelName()==r?n=t:sumeru.log("collection.add arguments format error."):n=e.modelPoll.getModel(r,t),this.push(n),this._setSynced(!1),this._setNeedSort(),!0},update:function(e,t){var n=this.find.call(this,t);if(Library.objUtils.isObject(e)){for(var r=0,i=n.length;i>r;r++)n[r]._setData(e,!0);this._setSynced(!1),this._setNeedSort()}},remove:function(e){if(e._isModel)for(var t=0,n=this.length;n>t;t++)this[t]==e&&(this.splice(t,1),t--,n--,this._setNeedSort());else for(var r=this.find.apply(this,arguments),i=0,o=r.length;o>i;i++)for(var t=0,n=this.length;n>t;t++)this[t]==r[i]&&(this.splice(t,1),t--,n--,this._setNeedSort())},destroy:function(t){for(var n=this.find.apply(this,arguments),r=0,i=n.length;i>r;r++)for(var o=0,a=this.length;a>o;o++)if(this[o]==n[r]){var s=this.splice(o,1);o--,a--,s[0].destroy(),this._setSynced(!1),this._setNeedSort(),e.modelPoll.destroyModel(this._getModelName(),s[0]),s[0].save(function(){},this.pubName,s[0]._getPilotId())}},setData:function(e){this.length=0;for(var t=0,n=e.length;n>t;t++)this.add(e[t]);this._setSynced(!1),this._setNeedSort()},_formatQuery:function(e){var e=e||[],t={};if(Library.objUtils.isArray(e)){t={AND:[]};for(var n=0,r=e.length;r>n;n++)t.AND.push(e[n])}else Library.objUtils.isObject(e)&&(t=this._formatUnitQuery(e));return t},_formatUnitQuery:function(t,n){if(Library.objUtils.isFunction(t))return{FUNC:t};if(Library.objUtils.isObject(t)){var r=[];for(var i in t){var o={},a,s=new RegExp("["+e.oquery.__load("_queryop").join(",")+"]+$"),u=i.replace(/^\s+|\s+$/g,""),l=s.exec(i);l&&l.length>0&&(u=u.replace(l[0]," "+l[0]),u=u.replace(/\s+/," "));var c=u.split(" ");a=2==c.length?c[1]:"=",o[a]={},o[a].key=c[0],o[a].value=t[i],r.push(o)}if(r.length>1){var n=n||"AND",d=r;r={},r[n]=d}else r=r[0];return r}},_addCondition:function(e,t,n){if("undefined"!=typeof t)if(2==t.length){var r={};r[t[0]]=t[1],e.push(this._formatUnitQuery(r,n))}else(Library.objUtils.isObject(t[0])||Library.objUtils.isFunction(t[0]))&&e.push(this._formatUnitQuery(t[0],n))},where:function(){return this._addCondition(this.__smr__.wheres,arguments,"AND"),this},orWhere:function(){return this._addCondition(this.__smr__.wheres,arguments,"OR"),this},_clearWheres:function(){this.__smr__.wheres.length=0},find:function(){var t=[];if(this.sortIt(),arguments.length>0&&this._addCondition(this.__smr__.wheres,arguments,"AND"),0==this.__smr__.wheres.length)return this;for(var n,r,i,o=0,a=this.length;a>o;o++)n=this[o],n._isDeleted()!==!0?(r=e.oquery.__load("_query")(n,this._formatQuery(this.__smr__.wheres)),1==r&&t.push(n)):(this.splice(o,1),o--,a--);return this._clearWheres(),t},pluck:function(e){if(!e)return[];for(var t=[],n=this.find(),r=0,i=n.length;i>r;r++)"undefined"!=typeof n[r][e]&&t.push(n[r][e]);return t},_oSort:function(e){var t=function(e,t,n){var r=0,i="undefined"!=typeof e.localeCompare,o="undefined"!=typeof t.localeCompare;switch(n){case"ASC":r=i?e.localeCompare(t):e-t;break;case"DESC":r=o?t.localeCompare(e):t-e;break;default:"function"==typeof n&&(r=n.call(this,e,t))}return r},n=function(e,r,i){var o=0,a,s,u,l;if(i.length>0)if("function"==typeof i[0])o=t.call(this,e,r,i[0]);else{u=i[0].key,l=i[0].value;var a=e.get(u),s=r.get(u);o=t.call(this,a,s,l),i.length>1&&0==o&&(i.shift(),o=n.call(this,e,r,i))}return o};return function(t,r){return n(t,r,e)}},_formatSorter:function(){var e="ASC",t=[];if(0!=arguments.length){if(1==arguments.length){var n=arguments[0];if(Library.objUtils.isFunction(n))t.push(n);else if(Library.objUtils.isObject(n))for(var r in n)(/^ASC|DESC$/.test(n[r])||Library.objUtils.isFunction(n))&&(e=n[r]),t.push({key:r,value:e});else t.push({key:n,value:e})}else/^ASC|DESC$/.test(arguments[1])&&(e=arguments[1]),t.push({key:arguments[0],value:e});return t}},addSorters:function(){this.__smr__.sorters=this.__smr__.sorters.concat(this._formatSorter.apply(this,arguments)),this._setNeedSort()},clearSorters:function(){this.__smr__.sorters.length=0,this._setNeedSort()},sortIt:function(){arguments.length>0&&this.addSorters.apply(this,arguments),0!=this.__smr__.sorters.length&&this.__smr__.isNeedSort&&(this.sort(this._oSort(this.__smr__.sorters)),this._setNeedSort(!1))},get:function(e){if(e=e||0,e>=this.length||0>e)return void 0;this.sortIt();var t,n,r;for(Library.objUtils.isNumber(e)||(n=e,e=0),t=this[e];t._isDeleted()===!0;)this.splice(e,1),t=this[e];return n?this[n]:t},set:function(e,t){this[e]=t},stringify:function(){return JSON.stringify(this)},toJSON:function(){var e=[];return this.find().forEach(function(t){e.push(t.getData())}),e},getData:function(){return this.toJSON()},save:function(t,n){if(this.__smr__.saveType=n?"ensure":"none",!t){var r=this.validation();if(r.length>0)return r;this.pubName||this._setStorable()}for(var i=0,o=this.length;o>i;i++)this[i].save(function(t){if("insert"===t.type){var n=this;n.set("smr_id",t.cnt.smr_id);var r="Model."+t.modelName;e.modelPoll.addModel(r,n)}},this.pubName,this._getPilotId(),!0);return n||this.render(),!0},ensureSave:function(){this.save(!1,!0)},rollback:function(){for(var e=0,t=this.length;t>e;e++){var n=this[e],r=n._getSnapshot();r.smr_id?n._setData(r):(this.remove(n),t--)}this._clean()},render:function(){"undefined"!=typeof this.pubName&&e.netMessage.sendLocalMessage({pubname:this.pubName,data:""},"data_write_latency")},truncate:function(){this.length=0},hold:function(){this.__smr__.isHolding=!0},releaseHold:function(){e.pubsub._releaseHold(this),this.__smr__.isHolding=!1},isEnsureSave:function(){return"ensure"===this.__smr__.saveType},onValidation:function(e,t,n){}};var n=function(){var e=[];for(p in collectionPrototype)e[p]=collectionPrototype[p];return e},r=function(){return this.__smr__={sorters:[],isNeedSort:!1,wheres:[],isHolding:!1,modelName:"",dal:{type:"live"},isSynced:!1,saveType:"none",version:""},this};r.prototype=new n;var i=function(n,i){if("undefined"==typeof n.modelName)return!1;var o=new r,a=e.model._getModelTemp(n.modelName),s=a._fieldsMap;for(var u in s)t.defineProperty.call(o,s[u].name);o.__smr__.modelName=n.modelName,n.sorters&&(o.__smr__.sorters=n.sorters);var l=n.layer||o.__smr__.dal;return o.__smr__.proxy=e.__DAL.make(l),i&&o.setData(i),o};e.collection.__reg("create",function(e,t){var n=i(e,t);return n._setStorable(),n}),e.collection.__reg("_create",function(e,t){return i(e,t)})};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),function(e){function t(e,t){var n=[];if(1===e.nodeType&&1===t.nodeType&&e.nodeName!==t.nodeName&&n.push(["nodeName",e.nodeName,t.nodeName]),e.attributes&&t.attributes){var r=e.attributes,i=r.length,o,a,s,u;for(o=0;i>o;o++)u=r[o].nodeName,a=e.getAttribute(u),s=t.getAttribute(u),a!=s&&n.push([u,a,s]);for(r=t.attributes,i=r.length,o=0;i>o;o++)u=r[o].nodeName,a=e.getAttribute(u),s=t.getAttribute(u),a!=s&&n.push([u,a,s])}return n}function n(e,t){var n=t.hashCode,r,i=e.length,o,a=[];for(r=0;i>r;r++)o=e[r],o.hashCode===n&&a.push(r);return a}function r(e,t){var r=[],o=[],a=[],s,u=e.length,l,c,d,f;for(s=0;u>s;s++)l=e[s],d=n(t,l),0!==d.length&&(d.length>1||(f=d[0],s!==f&&n(e,l).length<=1?(r.push(t[f]),l.marked=!0,t[f].marked=!0):s===f&&(l.marked=!0,t[f].marked=!0)));for(u=t.length,s=0;u>s;s++)l=t[s],l.marked||a.push(l);for(u=e.length,s=0;u>s;s++)l=e[s],l.marked||o.push(l);var p={c1:i.snapshot(e),c2:i.snapshot(t),relocations:r,insertions:o,removals:a};return p}e.addSubPackage("domdiff");var i={make:function(e,t){var n=document.createElement(e);return t&&(n.innerHTML=t.innerHTML?t.innerHTML:t),n},arrayCopy:function(e){var t=[],n,r=e.length;for(n=0;r>n;n++)t[n]=e[n];return t},mergeAttrs:function(e,t){var n=[],r=e.attributes,i=t.attributes,o;if(r&&i){var a=document.createElement(e.nodeName);for(o=r.length-1;o>=0;o--)a.setAttribute(r[o].nodeName,r[o].nodeValue);for(o=i.length-1;o>=0;o--)a.setAttribute(i[o].nodeName,i[o].nodeValue);for(o=a.attributes.length-1;o>=0;o--)n.push(a.attributes[o].nodeName)}return n},snapshot:function(e){for(var t=[],n=0,r=e.length;r>n;n++)t.push(e[n]);return t},hashCode:function(e,t){if(null===e||e===t)return 0;var n=0,r,i=e.length;for(r=0;i>r;++r)n=4294967295&31*n+e.charCodeAt(r);return n},hashAll:function(e,t){var n,r=e.childNodes===t?0:e.childNodes.length,o=0,a=e.nodeName;if(e.attributes){var s,u,l=e.attributes,c=l.length;for(u=0;c>u;u++)s=l[u],a+=s.nodeName+":"+s.nodeValue}for(o=i.hashCode((a+e.textContent).replace(/\s+/g,"")),n=r-1;n>=0;n--)o=4294967295&31*o+i.hashAll(e.childNodes[n]);return e.hashCode=o,o},find:function(e,t){for(var n=i.snapshot(t),r=n.splice(0,1)[0];-1!==r;)e=e.childNodes[r],r=n.splice(0,1)[0];return e}},o=function(e,t){for(var n=a(e,t),r=[n],o;"object"==typeof n;)o=a(e,t,i.arrayCopy(n)),r.push(o),n=o;return r.length>1&&r.splice(r.indexOf(0),1),r},a=function(e,t,n){var r=n&&0!==n.length?n.splice(0,1)[0]:0;if(-1===r)return 0;if(e.nodeType!==t.nodeType)return-1;if(3===e.nodeType&&3===t.nodeType)return e.textContent.trim()!=t.textContent.trim()?-1:0;if(e.nodeName!==t.nodeName)return-1;if(e.childNodes.length!==t.childNodes.length)return-1;var o,s=e.childNodes.length,u,l;for(o=r;s>o;o++)if(u=a(e.childNodes[o],t.childNodes[o],n),0!==u)return[o].concat(u);var c=i.mergeAttrs(e,t),d,s=c.length,f,p,h;for(d=0;s>d;d++)if(f=c[d],p=e.getAttribute(f),h=t.getAttribute(f),p!=h&&(p||""!=h)&&(h||""!=p))return-1;return 0},s=function(e,t){i.hashAll(e),i.hashAll(t),c1=i.snapshot(e.childNodes),c2=i.snapshot(t.childNodes);var n=r(c1,c2);return n.insertions.length>0||n.removals.length>0||n.relocations.length>0?n:!1},u=function(e,r){var a=i.make(r.nodeName,e),u=r,l=o(a,u),c,d,f,p=l.length,h;if(1===p&&0===l[0])return!1;for(f=0;p>f;f++)if(0!==l[f]){-1===l[f]&&(l[f]=[-1]),c=i.arrayCopy(l[f]),d=i.arrayCopy(l[f]);for(var g=a,_=u,m=c.splice(0,1)[0];-1!==m;)g=g.childNodes[m],_=_.childNodes[m],m=c.splice(0,1)[0];if(3===g.nodeType&&3===_.nodeType){var v=_.parentNode;v.replaceChild(g.cloneNode(),_)}else{var b=s(g,_),y,S,w;if(l[f].length>1)var E=t(g,_);else var E=[];if(E.length>0)for(S=E.length,y=0;S>y;y++)if(w=E[y],"nodeName"===w[0]){for(var T=i.find(u,d),I=document.createElement(w[1]);T.childNodes.length>0;)I.appendChild(T.childNodes[0]);for(var M=T.attributes.length-1;M>=0;M--)I.setAttribute(T.attributes[M].nodeName,T.attributes[M].nodeValue);T.parentNode.replaceChild(I,T)}else{var T=i.find(u,d);null==w[1]?T.removeAttribute(w[0]):T.setAttribute(w[0],w[1])}if(!b)continue;var v=i.find(u,d),C=i.find(a,d);if(S=b.removals.length,S>0)for(y=S-1;y>=0;y--)w=b.removals[y],v.removeChild(w);if(S=b.insertions.length,S>0)for(y=0;S>y;y++){w=b.insertions[y];var x=w.cloneNode(!0);x.hashCode=w.hashCode,v.appendChild(x)}var k=C.childNodes,O=v.childNodes,N,A;for(S=k.length,A=0;S>A;A++)if(N=n(O,k[A]),N.length<1)console.error("error: convert error");else{if(N.length>1){if(N[0]==A)continue;N=N[N.length-1],w=O[N]}else N=N[0],w=O[N];N!==A&&v.insertBefore(w,O[A])}}}return!0};e.domdiff.__reg("convert",u,"private")}(sumeru);var fw=fw||{};!function(e){e.__DAL={};var t=Library.objUtils,n=function(n){var r=n.getData(),i=n._getSnapshot(),o="",a={};for(var s in i)if(i[s]._isCollection)for(var u=0,l=i[s].length;l>u;u++)i[s].get(u)._isModel&&(i[s].get(u).dataMap={isReference:!0,val:"::referenceID::"+i[s].get(u)._getModelName()+"::"+i[s].get(u).getId()});else i[s]._isModel&&(i[s].dataMap={isReference:!0,val:"::referenceID::"+i[s]._getModelName()+"::"+i[s].getId()});if(r[n._idField])if(n._isDeleted())o="delete",a[n._idField]=r[n._idField];else{o="update";for(var u in r){if(!i[u]||!r[u]._isCollection&&i[u]!=r[u]||(r[u]._isCollection||r[u]._isModel)&&JSON.stringify(r[u])!=JSON.stringify(i[u])){if(u===n._idField||u===n._clientIdField)continue;a[u]=r[u]}a[n._idField]=i[n._idField]||r[n._idField]}}else o="insert",a=e.model._extend({},r),a[n._idField]=e.__load("__ObjectId")(),n.__smr_assist__.__extendPointer&&n.__smr_assist__.__extendPointer.set(n._idField,a[n._idField]);for(var s in a)t.isObject(a[s])&&a[s]._isCollection&&0===a[s].length&&delete a[s];return n._setDirty(!1),n.__smr_assist__.__extendPointer&&n.__smr_assist__.__extendPointer._setDirty(!1),{type:o,modelName:n._getModelName().replace(/Model\./,""),cnt:a}};e.__DAL.make=function(e){var t=e.type.toLowerCase();if(r[t]){var i=new r[t];i.config=e;var o=i.save;return i.save=function(e,t,r,i,a){var s=n(e);o(s,t,r,i,a)},i}};var r={};r.live=function(){this.proxyid=e.__random()},r.live.prototype={save:function(t,n,r,i,o){"undefined"!=typeof r||"undefined"!=typeof i?(r&&(i=""),e.netMessage.sendMessage({pubname:r,pilotid:i,modelchain:o,data:t},"data_write_from_client",function(t){e.log("Err : data_write_from_client "+t)},function(){}),n(t)):n(t)}},r.network=function(){this.proxyid=e.__random()},r.network.prototype={save:function(t,n){var r=this.config.url;e.dev("network layer saving : ",r+" ",t);var i=t.id;n(i)},get:function(e){},load:function(e,t){var n=[];t(n)}},r.localstorage=function(){this.proxyid=e.__random()},r.localstorage.prototype={save:function(t){e.dev("localstorage layer saving : "+t)},get:function(e){}},r.memory=function(){this.proxyid=e.__random(),this.data={},r.memory.manager[this.proxyid]=this},r.memory.manager={},r.memory.manager.resolveRef=function(e,t){var n=/::referenceID::(.*)::(.*)/,i=e.match(n);t(r.memory.manager[i[2]].get())},r.memory.prototype={save:function(t,n){return this.data=t,e.dev("memory layer save done",t),n(this.proxyid),!0},get:function(){return this.data},load:function(e,t){var n={};t(n)}}}(sumeru);var runnable=function(e,t,n,r,i,o,a){function s(){this.data=[]}function u(t,n,r,o){var a=[],s=0,u=i.get(t,function(e){var t=null;e.on("data",function(e){a.push(e),s+=e.length}),e.on("end",function(){switch(a.length){case 0:t=new Buffer(0);break;case 1:t=a[0];break;default:t=new Buffer(s);for(var e=0,r=0,i=a.length;i>e;e++){var o=a[e];o.copy(t,r),r+=o.length}}n(t)})});u.on("error",function(i){e.log("Error when do external fetch",t),r&&r(i),n([])}),u.setTimeout(S,function(r){e.log("Timeout when do external fetch",t),o&&o(),n([])})}function l(t,n,r,o,a){var s=[],u=0,l=i.request(t,function(e){var t=null;e.on("data",function(e){s.push(e),u+=e.length}),e.on("end",function(){switch(s.length){case 0:t=new Buffer(0);break;case 1:t=s[0];break;default:t=new Buffer(u);for(var e=0,n=0,i=s.length;i>e;e++){var o=s[e];o.copy(t,n),n+=o.length}}r(t)})});l.write(n),l.end(),l.on("error",function(i){e.log("Error when do external post"),t&&n&&e.log(t,n),o&&o(i),r([])}),l.setTimeout(S,function(){e.log("Timeout when do external post"),t&&n&&e.log(t,n),a&&a(),r([])})}function c(t,n,i){var o=r[n],a=o.buffer?t:t.toString();if(!o.resolve)return e.log("Need resolve method for external fetch!"),void 0;try{var s=o.resolve(a);return s=Array.isArray(s)?s:[s]}catch(u){return e.log("Please check fetch url, 3rd-party server encounters an error: ",i,"\n",a,"\n"),void 0}}function d(t,n,i){var a=e.server_model.getModelTemp(t),u=r[n],l=E[i],c=new s;return l&&(l.forEach(function(t){var n=e.utils.deepClone(a);for(var r in n)n[r]=t[r];var s=u.uniqueColumn||u.keyColume,l=null;s&&(l=T[i]&&T[i].findOne(s,n[s])),n.smr_id=l?l.smr_id:o.ObjectId(),c.insert(n)}),T[i]=null),c}function f(t,n,i,o,a){var s=r[n],f=s.method||"get",p=function(r){if("undefined"==typeof E[i])var s=!0;var u=c(r,n,i);if(s){E[i]=u,T[i]=d(t,n,i);var l=e.utils.deepClone(T[i].getData());o(l)}else{var f=JSON.stringify(u)===JSON.stringify(E[i]);!f&&u&&(E[i]=u,T[i]=d(t,n,i),e.netMessage.sendLocalMessage({modelName:t},"trigger_push"))}a&&a()};if("post"===f.toLowerCase()){var h=encodeURIComponent(s.postData);try{var g=w&&w.parse(i)}catch(_){return e.log("externalConfig: fetchUrl must return a url \n\n",i)}if(!g.hostname||!g.pathname)return e.log("unexpected post url",i);var m={hostname:g.hostname,path:g.pathname,port:g.port||80,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":h.length}};try{l(m,h,p)}catch(_){return e.log("Fetch by post request failed",_),void 0}}else try{u(i,p)}catch(_){e.log("Fetch by get request failed",_)}}function p(t,n,r,i,o){var a="on",s,u;if(t.prepare)s=t.prepare;else{var l=a+n.charAt(0).toUpperCase()+n.substring(1);s=t[l]}if(!s)return e.log("External Post",o,"unhandled operation type of",n),!1;if("delete"===n){for(var c,d=0,f=I[i].length;f>d;d++){var p=I[i][d];if(c=T[p].find(r.smr_id))break}c&&(u=c)}else if("update"===n){for(var c,d=0,f=I[i].length;f>d;d++){var p=I[i][d];if(c=T[p].find(r.smr_id))break}c&&(u=e.utils.merge(r,c))}else u=r;return"undefined"==typeof u&&e.log("Cannot find model ",r.smr_id,"external post"),t.prepare?s(n,u):s(u)}function h(t,n,r){var i="Url",o;return r=r.concat(),t.postUrl?(Array.prototype.unshift.call(r,n),o=t.postUrl.apply(null,r)):o=t[n+i].apply(null,r),o?o:(e.log("External Post ",pubName,"options have no post config!"),!1)}function g(t,n,i,o){var a=r[n],s=a.method||"get",u;"post"===s.toLowerCase()?(u=a.fetchUrl&&a.fetchUrl.apply(null,i),a.postData=i[i.length-1]||""):u=a.fetchUrl&&a.fetchUrl.apply(null,i)||a.geturl(i),I[t]||(I[t]=[]),I[t].indexOf(u)<0&&I[t].push(u);var l=T[u];if(l){var c=e.utils.deepClone(l.getData());o(c)}else f(t,n,u,o);a.fetchInterval&&!M[u]&&(M[u]=setInterval(function(){f(t,n,u,o)},a.fetchInterval))}function _(e,t,n,i,o,a){var s=r[t];o=o.concat(),Array.prototype.pop.call(o);var u=p(s,n,i,e,t),c=h(s,n,o);if(!u||!c)return!1;var d=encodeURIComponent(JSON.stringify(u)),g={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":d.length}},_=Library.objUtils.extend(!0,g,c);l(_,d,function(n){I[e].forEach(function(n){f(e,t,n,function(){})}),a()})}function m(t,n,r){if(e.IS_SUMERU_SERVER)u(t,function(e){e=r?e:e.toString(),n(e)});else{t&&n||e.log("Please specify url and callback for sumeru.external.get!");var i="WAITING_EXTERNAL_GET_CALLBACK_"+e.utils.randomStr(8);e.netMessage.setReceiver({onMessage:{target:i,overwrite:!0,once:!0,handle:function(e){n(e)}}}),e.netMessage.sendMessage({cbn:i,url:t,buffer:r},"SEND_EXTERNAL_GET")}}function v(t,n,r){if(e.IS_SUMERU_SERVER){n=encodeURIComponent(JSON.stringify(n));var i={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":n.length}},o=Library.objUtils.extend(!0,i,t);l(o,n,function(e){r(e)})}else{if(!t||!n)return e.log("please specify options or postData for sumeru.external.post"),!1;r=r||function(){};var a="WAITING_EXTERNAL_POST_CALLBACK_"+e.utils.randomStr(8);e.netMessage.setReceiver({onMessage:{target:a,overwrite:!0,once:!0,handle:function(e){r(e)}}}),e.netMessage.sendMessage({cbn:a,options:t,postData:n},"SEND_EXTERNAL_POST")}}function b(t,n,i,o){if(e.IS_SUMERU_SERVER){var a=I[t],s=r[n];f(t,n,i,function(){},function(){o({msg:"ok"})})}else{if(arguments.length<3)return e.log("please sepecify modelName, pubName and url in order."),!1;var u="WAITING_SYNC_CALLBACK_"+e.utils.randomStr(8);e.netMessage.setReceiver({onMessage:{target:u,overwrite:!0,once:!0,handle:function(e){o&&o(e)}}}),e.netMessage.sendMessage({cbn:u,modelName:t,pubName:n,url:i},"SEND_SYNC_REQUEST")}}var y=e.addSubPackage("external"),S=6e3,w=e.IS_SUMERU_SERVER&&a,E={},T={},I={},M={};s.prototype={getData:function(){return this.data},insert:function(e){this.data.push(e)},remove:function(e){var t=this.find(e);if(t){var n=this.data.indexOf(t);return this.data.splice(n,1),!0}return!1},update:function(e,t){var n=this.data.indexOf(e);this.data.splice(n,1,t)},find:function(t){var n=this.data.filter(function(e){return e.smr_id===t});return n.length>1&&e.log("ERROR: uniqueColumn data is not unique, it may cause error. "),n.length?n[0]:null},findOne:function(t,n){if(!t||!n)return null;var r=this.data.filter(function(e){return e[t]===n});return r.length>1&&e.log("ERROR: uniqueColume data is not unique, it may cause error. "),r.length?r[0]:null}},e.netMessage.setReceiver({onMessage:{target:"SEND_EXTERNAL_POST",overwrite:!0,handle:function(t,n,r){var i=t.cbn,o=encodeURIComponent(JSON.stringify(t.postData)),a={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":o.length}},s=Library.objUtils.extend(!0,a,t.options);l(s,o,function(t){e.netMessage.sendMessage(t.toString(),i,r._sumeru_socket_id)})}}}),e.netMessage.setReceiver({onMessage:{target:"SEND_EXTERNAL_GET",overwrite:!0,handle:function(t,n,r){var i=t.cbn,o=t.url,a=t.buffer;u(o,function(t){t=a?t:t.toString(),e.netMessage.sendMessage(t,i,r._sumeru_socket_id)})}}}),e.netMessage.setReceiver({onMessage:{target:"SEND_SYNC_REQUEST",overwrite:!0,handle:function(t,n,i){var o=t.cbn,a=t.modelName,s=t.pubName,u=t.url,l=I[a],c=r[s];return l&&c?l.indexOf(u)<0?(e.netMessage.sendMessage({msg:"unknown url"},o,i._sumeru_socket_id),!1):(f(a,s,u,function(){},function(){e.netMessage.sendMessage({msg:"ok"},o,i._sumeru_socket_id)}),void 0):(e.netMessage.sendMessage({msg:"unknown modelName or pubName"},o,i._sumeru_socket_id),!1)}}}),y.__reg("doFetch",g,"private"),y.__reg("doPost",_,"private"),y.__reg("get",m),y.__reg("post",v),y.__reg("sync",b)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){function t(e,t){for(var n,r,i=0,o=t.length;o>i;i++)n=t[i].type,r=t[i].cnt,"append"==n?e.splice(e.length,0,r):"update"==n?e[r.id]=r.cnt:"splice"==n&&e.splice(r)}function n(e,t){for(var n,r,i=0,o=t.length;o>i;i++)if(n=t[i].type,r=t[i].cnt,"insert"==n)for(var a in r)e[a]=r[a];else if("update"==n)for(var a in r)e[a]=r[a];else if("delete"==n)for(var a,s=r.length;s>a;a++)e[a]=void 0}function r(t,o){for(var a,s,u=t._modelName,l=e.model._getModelTemp(u)._fieldsMap,c,d,f,p=0,h=o.length;h>p;p++)if(a=o[p].type,s=o[p].cnt,"insert"==a)for(var g in s)if(c=l[g].type,"model"==c)if(d=l[g].model,f=l[g].relation,"many"==f){var _=e.collection.create({modelName:d},s[g]);t._baseSet(g,_)}else subModel=e.model.create(d,s[g]),t._baseSet(g,subModel);else t._baseSet(g,s[g]);else if("update"==a)for(var g in s)c=l[g].type,"model"==c?(d=l[g].model,f=l[g].relation,"many"==f?i(t[g],s[g]):r(t[g],s[g])):"array"==c?t._baseSet(g,s[g]):"object"==c?n(t[g],s[g]):t._baseSet(g,s[g]);else if("delete"==a)for(var m=0,v=s.length;v>m;m++)t._delete(s[m])}function i(t,n,i){for(var o=!1,a=0,s=n.length;s>a;a++){var u=n[a];if("insert"==u.type){var l=u.cnt,c=t.find({smr_id:l.smr_id});if(c.length)o=!1;else{var d=e.pubsub._subscribeMgr[t.pubName].externalInfo;if(d){var f=d.uniqueColumn,p={};p[f]=l[f];var h=t.find(p);h.length?h[0].set("smr_id",l.smr_id):t.add(l)}else t.add(l);o=!0}}else if("delete"==u.type){var l=u.cnt;t.remove({"smr_id IN":l}),o=!0}else if("update"==u.type){var g=t.find({smr_id:u.id});if(!(g.length>0))continue;g=g[0];var l=r(g,u.cnt);o=!0}t.setVersion(i)}return o}function o(e,t){var n=[],r=[],i=[];t.forEach(function(e){if("insert"===e.type)n.push(e.cnt);else if("delete"===e.type)e.cnt.forEach(function(e){r.push(e)});else if("update"===e.type){var t=e.cnt,o=e.id;e.cnt.forEach(function(e){i.push({cnt:e.cnt,smr_id:o})})}}),n.length&&e.onInsert&&e.onInsert(n),r.length&&e.onDelete&&e.onDelete(r),i.length&&e.onUpdate&&e.onUpdate(i)}function a(e,t,n,r,a,u){var c=r.collection,d=!1,f=[];if(a?(c=n,d=!0):"data_write_from_server_delta"==e?(f=n,d=i(c,f,u)):c._isSynced()&&c.stringify()===JSON.stringify(n)||(c.setData(n),c.setVersion(u),d=!0),a||c._takeSnapshot(),o(c,f),d===!0){var p=[];s._tapped_blocks&&l?p=s._tapped_blocks:s.__reg("_tapped_blocks",p,!0);var h=new RegExp("@@_sumeru_@@_page_([\\d]+)"),g=t.match(h);g?r.callback(c,{page:g[1]}):r.callback(c,{delta:f}),s&&s.reactiveRender(p)}a||c._setSynced(!0)}var s=e.controller,u=e.model,l=e.IS_SUMERU_SERVER,c=e.pubsub._postponeQueue,d=function(t){e.onGlobalMessage?e.onGlobalMessage(t):e.dev("GLOBAL MESSAGE : "+t)},f=function(t,n){var r="data_auth_from_server"==n?"auth faild":t;e.onGlobalError?e.onGlobalError(r):e.log("GLOBAL ERROR : "+r)},p=function(t){if(!t.needAuth){var n=t.pubname,r=e.pubsub._subscribeMgr[n].stub,i=!1;return r.forEach(function(e,t){e.env.onerror?(e.env.onerror("auth failed"),i=!0):i=!1||i}),i}},h=function(t){var n=t.pubname,r=e.pubsub._subscribeMgr[n].stub,i=!1;return r.forEach(function(e,n){e.env.onerror?(e.env.onerror("dberror:"+t.data.stringify()),i=!0):i=!1||i}),i},g=function(t){var n=t.pubname,r=t.pilotid;if(n){var i=e.pubsub._subscribeMgr[n].stub,o=!1;return i.forEach(function(e,n){if(e.collection.onValidation){var r=t.data;if(""!=t.modelchain)for(var n=0,i=r.length;i>n;n++)r[n].key=t.modelchain+"."+r[n].key;e.collection.onValidation.call(e.collection,r.length>0?!1:!0,"server",r),o=!0}else o=!1||o}),o}var a=e.msgpilot.getPilot(r),o=!1;if(a.stub.onValidation){var s=t.data;a.stub.onValidation.call(a.stub,s.length>0?!1:!0,"server",s),o=!0}else o=!1||o;return o},_=function(t){var n=(new Date).valueOf();serverTimeStamp=t.timestamp,"undefined"!=typeof t.swappk&&e.myrsa.setPk2(t.swappk);var r=function(){var e=(new Date).valueOf(),t=e-n,r=t+serverTimeStamp;return r};e.utils.__reg("getTimeStamp",r),Library.objUtils.extend(sumeru.pubsub._publishModelMap,t.pubmap),e.netMessage.sendLocalMessage({},"after_echo_from_server")},m=function(t,n){var r=t.pubname,i=t.pilotid,o=t.uk||"",s=t.data,u=t.version,l=t.external||"";if(r){if(!(r in e.pubsub._subscribeMgr))return;"data_write_from_server"==n&&1==e.pubsub._subscribeMgr[r].topPriority&&"undefined"!=typeof e.pubsub._priorityAsyncHandler&&e.pubsub._priorityAsyncHandler.decrease(),l&&(e.pubsub._subscribeMgr[r].externalInfo=l);for(var d=e.pubsub._subscribeMgr[r].stub,f=sumeru.pubsub._publishModelMap[r.replace(/@@_sumeru_@@_page_([\d]+)/,"")].plainstruct,p=0,h=d.length,g;h>p;p++)if(g=d[p],!o||o==g.id){var _=g.collection;f?a(n,r,s,g,f,u):_.__smr__.isHolding?c.push({collection:_,runner:function(){a(n,r,s,g,!1,u)}}):a(n,r,s,g,!1,u)}}else{var m=sumeru.msgpilot.getPilot(i);"model"===m.type||a(n,i,s,g,!1,u)}},v=function(t,n){var r=t.pubname,i=e.pubsub._subscribeMgr[r].stub,o=!1;return i.forEach(function(e,t){e.env.onerror?(e.env.onerror("auth failed"),o=!0):o=!1||o}),o},b=function(t,n){var r=t.pubname,i=e.pubsub._subscribeMgr[r].stub;i.forEach(function(e,t){var n=e.collection,r=[];s.__reg("_tapped_blocks",r,!0),e.callback(n,{delta:[]}),s.reactiveRender(r)})},y=function(t,n){if(t&&"object"==typeof t)for(var r in t)e.config.set(r,t[r]);e.config.commit()};e.netMessage.setReceiver({onMessage:{overwrite:!0,target:"config_write_from_server",handle:y},onLocalMessage:{target:"config_write_from_server",handle:y}}),e.netMessage.setReceiver({onMessage:{overwrite:!0,target:"echo_from_server",handle:_},onLocalMessage:{overwrite:!0,target:["data_write_latency"],handle:b}}),e.netMessage.setReceiver({onMessage:{overwrite:!0,target:["data_write_from_server","data_write_from_server_delta"],handle:m},onLocalMessage:{overwrite:!0,target:["data_write_from_server","data_write_from_server_delta"],handle:m},onError:v,onGlobalError:f,onGlobalMessage:d}),e.netMessage.setReceiver({onError:{overwrite:!0,target:["data_auth_from_server"],handle:p}}),e.netMessage.setReceiver({onError:{overwrite:!0,target:["data_write_from_server_dberror"],handle:h}}),e.netMessage.setReceiver({onError:{overwrite:!0,target:["data_write_from_server_validation"],handle:g}})};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var globalConfig=function(e){var t=8080,n=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],r=!1;if(e.BAE_VERSION>0&&(t=0,n=["xhr-streaming"],r=!0),e.config.defineModule("cluster"),e.config.cluster({enable:!0,cluster_mgr:"127.0.0.1",cluster_mgr_port:6379}),e.config({httpServerPort:t,protocols_whitelist:n,view_from_cache:r}),e.config({clientValidation:!0,serverValidation:!0}),"undefined"!=typeof location&&e.config({selfGroupManagerAddr:"0.0.0.0",selfGroupManagerPort:"8089"}),"undefined"!=typeof exports&&"undefined"!=typeof module){var i=process.dstDir+"/server/tmp/config";e.config({configPath:i})}var o=e.config.defineModule("view");o({path:"/"})};"undefined"!=typeof module&&module.exports?module.exports=globalConfig:globalConfig(sumeru);var SUMERU_ROUTER=void 0===SUMERU_ROUTER?!0:SUMERU_ROUTER;!function(e){function t(t){r=e.uri.getInstance(t),a=l!=r.session,l=r.session,i=r.controller!=s,s=r.controller,(a||i)&&e.session.preResume(l,s),0==d&&(i||o)&&e.init(function(t,n){return function(){e.controller.dispatch(t,n,f),f=!1}}(s,r.contr_argu)),d=i=a=c=o=!1}var n=e.addSubPackage("router"),r,i=!0,o=!0,a=!0,s=null,u=null,l=null,c=null,d=!1,f=!1,p=function(e){var t="object"==typeof e?e:JSON.parse(e),n=[];for(var r in t)n.push(r+"="+t[r]);return n.join("&")};n.__reg("joinSessionToHash",function(e){if(a=c!=e,c=e,a){var t=e?"?"+p(e):"";t&&(t=r.path+r.controller+t),History.replaceState(e,document.title,t)}},!0),n.__reg("redirect",function(t,n,i){var o=e.uri.getInstance(t);e.dev("redirect....",o.controller,t),f=!!n,"string"==typeof i&&"replace"==i?History.replaceState(l,document.title,r.path+t):History.pushState(l,document.title,r.path+t)}),e.event.domReady(function(){"object"==typeof location&&SUMERU_ROUTER&&(History.Adapter.bind(window,"statechange",function(){var e=History.getState();History.log("statechange:",e.data,e.title,e.cleanUrl),t(e.cleanUrl.substr(location.origin.length))}),t(location.href.replace(/&?_suid=\d*/g,"").substr(location.origin.length)))})}(sumeru);var runnable=function(e){var t=[],n=function(e){for(var n,r=0,i=arguments.length;i>r;r++)if(n=arguments[r],Library.objUtils.isObject(n)&&"undefined"!=typeof n.pattern)if("file"==n.type){if(n.max_size_allowed){var o=n.max_size_allowed.toString().toLowerCase().match(/(\d+)([mk]?)/);o&&(n.max_size_allowed="m"==o[2]?1024*1024*o[1]:"k"==o[2]?1024*o[1]:o[1])}t.push({path:n.pattern,type:"file",upload_dir:n.upload_dir,max_size_allowed:n.max_size_allowed,file_ext_allowed:n.file_ext_allowed,rename:n.rename,server_render:!1})}else n.action&&t.push({path:n.pattern,action:n.action,server_render:n.server_render!==!1})},r=function(){return t},i=function(e){if(e){for(var r=!0,i=0,o=t.length;o>i;i++)t[i].action==e&&(r=t[i].server_render);
n({pattern:"",action:e,server_render:r})}return!0},o=[];e.router.addSubPackage("externalProcessor");var a=function(e){for(var t,n=0,r=arguments.length;r>n;n++)t=arguments[n],"function"==typeof t&&o.push(t)},s=function(){return o};e.router.__reg("getRouterByPath",function(e){for(var n=t.length-1;n>=0;n--){var r=new RegExp("^"+t[n].path+"$","i");if(""==t[n].path&&""==e||""!==t[n].path&&r.test(e)===!0)return t[n]}return!1}),e.router.__reg("add",n),e.router.__reg("getAll",r),e.router.__reg("setDefault",i),e.router.externalProcessor.__reg("add",a),e.router.externalProcessor.__reg("getAll",s)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),function(e){e.addSubPackage("historyCache");var t=[],n=function(e,n){if(n)return i(e),!1;for(var r=!1,o=t.length-1;o>=0;o--)if(t[o]&&t[o][0]===e[0]){r=!0;break}if(r){if(o===t.length-1)return!1;for(var a=t.length-1;a>o;a--)t.pop();var s=JSON.stringify(t[o]);return JSON.parse(s)}return i(e),!1},r=function(){return t},i=function(e){e&&e[0]&&e[1]&&t.push(e)};e.historyCache.__reg("hitUrl",n),e.historyCache.__reg("getCache",r)}(sumeru);var runnable=function(e){var t=0,n=16,r=256,i=1,o=17,a=273,s=4369,u=t,l=0;if(!e.reachability){var c=e.addSubPackage("reachability"),d={},f=function(e){e===t?d.offline&&d.offline():e===n?d.connecting&&d.connecting():e===r&&d.online&&d.online()},p=function(e,t){d[e]=t},h=function(e){return f(e),u=e},g=function(){return u};c.STATUS_OFFLINE=t,c.STATUS_CONNECTING=n,c.STATUS_CONNECTED=r,"undefined"!=typeof module&&module.exports||(window.addEventListener("offline",function(){e.reachability.setStatus_(t),e.closeConnect&&e.closeConnect()},!1),window.addEventListener("online",function(){e.reconnect&&e.reconnect()},!1)),c.__reg("setStatus_",h,"private"),c.__reg("getStatus",g,"private"),c.__reg("setEvent",p,"private")}};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){if(!e.writeBuffer_){var t=e.addSubPackage("writeBuffer_"),n=e.reachability,r,i=[],o=function(e){r=e},a=function(e,t,n){i.push({msg:e,onError:t,onSuccess:n}),s()},s=function(){if(0==i.length)return!0;for(var e;n.getStatus()==n.STATUS_CONNECTED&&(e=i.shift());)r(e.msg,e.onError,e.onSuccess)};t.__reg("write",a,"private"),t.__reg("setOutput",o,"private"),t.__reg("resume",s,"private")}};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){var t={},n=0,r=function(){return"pilot"+n++},i=function(e,n){if(!fw.IS_SUMERU_SERVER){var n=n||"model";if(!e._getPilotId()){var i=r();t[i]={type:n,stub:e},e._setPilotId(i)}}},o=function(e){return t[e]};if(!e.msgpilot){var a=e.addSubPackage("msgpilot");a.__reg("setPilot",i,"private"),a.__reg("getPilot",o,"private")}};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e,t){var n=e.addSubPackage("uri"),r=function(){this.path=null,this.params=null,this.controller=null,this.original=null,this.session="",this.router=null,this.contr_argu=[]},i=null,o=function(n){-1!=n.indexOf("#")&&(n=n.replace("#","")),n=n.replace(/\/+/g,"/"),-1!=n.indexOf(".html/")&&(n.match(/^[^?]*\.\w+$/)||n.match(/\.\w+\?/))&&(n=n.substring(n.indexOf(".html/")+5));var r=n,o="",a="";if(-1!=r.search(/[?#!]/)&&(o=r.substring(r.search(/[?#!]/)+1),r=r.substring(0,r.search(/[?#!]/))),-1!=r.indexOf(".html")?(a=r.substring(r.indexOf(".html")+5),r=r.substring(0,r.indexOf(".html")+5)):r.match(/\.\w+$/)||(a=r,r="/"),n.match(/\.\w+/)&&!n.match(/\.html/))return this.controller=null,this.path=r,this;i||(i=e.router.getAll());for(var s=[],u,l=-1,c=-1,d=0,f=i.length;f>d;d++)i[d].path.toString().length>l&&(u=a.match(i[d].path))&&(l=i[d].path.toString().length,c=d);c>-1?(t&&!i[c].server_render?("file"===i[c].type?e.log("router:fileUpload matche.",i[c].path):e.log("router:server_render is false.",i[c].path),a=null):0==l?(0==a.indexOf("/")&&(a=a.substr(1)),s=a.split("/"),s.unshift(""),a=""==s[1]?"":0):(u=a.match(i[c].path),s=a.replace(i[c].path,""),a=u[0],s=s.split("/"),s[0]=a),"file"===i[c].type&&(a=null),this.router=i[c]):(a=null,s.push(""));var p=e.utils.uriParamToMap(o),h=a+"!",g={};g[h]=JSON.stringify(p),g=JSON.stringify(g);var _=g.substring(1,g.length-1);return this.path=r,this.params=p,this.controller=a,this.session=_,this.contr_argu=s,this};r.prototype={parseFromUrl:o,init:function(e){this.original=e,this.parseFromUrl(e)}},n.__reg("getInstance",function(e){var t=new r;return t.init(e),t})};"undefined"!=typeof module&&module.exports?module.exports=function(e){runnable(e,!0)}:runnable(sumeru),function(e){var t=!1,n=Library.cookie,r=null,i=e.reachability,o=e.config,a=e.netMessage,s=e.myrsa,u=e.writeBuffer_,l=null,c=n.getCookie("authMethod");if(!(l=n.getCookie("clientId"))){var d=Date.now().toString(32);l=d+"_"+sumeru.utils.randomStr(12),n.addCookie("clientId",l,175200)}n.getCookie("OPEN_STICKY_SESSION")||n.addCookie("OPEN_STICKY_SESSION",1),e.__reg("clientId",l),a.addOutFilter(function(e){return e.clientId=l,e.authMethod=c,e},0);var f=function(n,l){var c=e.__random(),d=o.get("rsa_enable");if(i.getStatus()!=i.STATUS_OFFLINE)return e.dev("Another connection still open, stop connect"),void 0;if((n=n||0)>500)throw"Fail to connect to network";var p;p=o.get("httpServerPort")&&"80"!=o.get("httpServerPort")&&-1==location.hostname.indexOf(".duapp.com")?location.hostname+":"+o.get("httpServerPort")+"/socket/":location.hostname+"/socket/",p=p.replace(".duapp.com",".sx.duapp.com"),e.dev("OPEN : "+p),i.setStatus_(i.STATUS_CONNECTING),r=new SockJS("http://"+p,void 0,{protocols_whitelist:o.get("protocols_whitelist")}),r.onmessage=function(e){a.onData(d?s.decrypt(e.data):e.data)},r.onopen=function(){i.setStatus_(i.STATUS_CONNECTED);var t={},u="sumeru_app_uuid";d?(0===n?(s.setPk2(o.get("rsa_pk")),s.generate()):(t.swappk=s.getPk(),s.setPk2("")),t.socketId=c,t.uuid=u,t.pk=s.getPk()):t={socketId:c,uuid:u},e.dev("ON OPEN : "+r.readyState+" : "+JSON.stringify(t)),a.sendMessage(t,"echo")},r.onclose=function(t){var r=null;e.log("Socket has been closed : ",t.reason),i.setStatus_(i.STATUS_OFFLINE),1e3!=t.code&&(r=setTimeout(function(){navigator.onLine===!0?f(++n):clearTimeout(r)},1e3))};var h=function(t,n,i){if(0===r.readyState)return setTimeout(function(){h(t,n,i)},50),void 0;var o;o=d&&null===t.match(/"target":"echo"/)?s.encrypt(t):t;try{r.send(o)}catch(a){e.log("error : "+r.readyState+" "+t),n&&n(a)}i&&i()};a.setReceiver({onLocalMessage:{target:["after_echo_from_server"],overwrite:!0,handle:function(){e.auth.init(function(){t=!0,l&&l(),u.resume(),n>0&&(n=0,e.pubsub.__load("_redoAllSubscribe")())})}}}),u.setOutput(h),a.setOutput(u.write)};e.init=function(n){t?n&&n():f(0,n),e.transition._init()},e.reconnect=function(){f(1)},e.closeConnect=function(){r&&r.close()}}(sumeru);var runnable=function(e){var t=e.addSubPackage("render"),n="main_tpl",r={},i=function(e){return"view/"+e},o=function(e){return i(e)+"@@content"},a=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};t.__reg("_buildRender",function(t,s,u){var l=t.__currentTplName,c=t.__isSubController,d=t.__UK+"_",f=i(l),p=(c?d:"")+f,h=(c?d:"")+o(l),g=t.__getId(),_;void 0===r[p]&&(r[p]={type:n,domId:"",usering:[]});var m=r[p];m.type=t.__isSubController?t.getMain().__getId():n,m.domId=h,-1==m.usering.indexOf(g)&&m.usering.push(g),m.usering.length>1&&e.controller.findAndDestroy(m.usering,g);var m={tplContent:null,renderBone:null,renderBlock:{},blocksRelation:{}};m.domId=h;var v=/(<[\s]*block[^>]+tpl-id=['"])(.+)(['"][^>]*>)/gm;s=s.replace(v,function(e,t,n,r){var i=t+d+n+r;return i});var b={},y=/(<[\s]*block[^>]+tpl-id=['"]([^'"\s]+)['"][^>]*>)([\s\S]*)/im,S=/<[\s]*\/[\s]*block[\s]*>/im,w=/(<[\s]*\/[\s]*block[\s]*>)[\s\S]*/im,E=s,T=s,I=[b],M=function(){for(var e,t,n,r,i,o;e=E.match(y);){if(i=e[2],n=e[1].length,t=E.indexOf(e[1]),r=E.search(S),-1==r&&(r=E.length),t>r)return;var l=I[I.length-1];if(l[i]={},E=E.substr(t+n),r-=t+n,o=E.search(y),I.push(l[i]),-1!=o&&r>o){M(l[i]),I.pop();var c=E.match(w);if(c){var d=E.search(w),f=c[1].length;E=E.substr(d+f);var p=new RegExp("<[\\s]*block[^>]+tpl-id=['\"]"+i+"['\"][^>]*>([\\s\\S]+)<[\\s]*/[\\s]*block[\\s]*>"+a(E)+"$","mi"),h=s.match(p);h&&(m.renderBlock[i]=u.compile(h[1]))}}else{I.pop(),m.renderBlock[i]=u.compile(E.substr(0,r));var g=new RegExp("(<[\\s]*block[^>]+tpl-id=['\"]"+i+"['\"][^>]*>)[\\s\\S]*?(<[\\s]*/[\\s]*block[\\s]*>)","mi");T=T.replace(g,"$1$2");var c=E.match(w);if(c){var d=E.search(w),f=c[1].length;E=E.substr(d+f)}}}};M(),delete I,m.blocksRelation=b;var C=m.renderBone=u.compile(T);return m.tplContent=C({}),m},!0)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),function(e){var t=e.render,n={},r={};tplContentToController={};var i={top:"",left:"",right:"",bottom:"",width:"",height:"",display:"",position:"",margin:"",padding:""},o=function(e){return"view/"+e},a=function(e){return o(e)+"@@content"},s=t.__reg("getTplContent",function(e){var t=a(e.__currentTplName);return e.__isSubController&&(t=e.__UK+"_"+t),document.getElementById(t)}),u=t.__reg("clearTplContent",function(t){var n=s(t);if(n)if(n.innerHTML="",t.__isSubController){var r=t.__UK+"_",a=r+o(t.__currentTplName);tplContentToController[a]=null,delete tplContentToController[a],n.parentElement.removeChild(n)}else e.utils.setStyles(n,i)});t.__reg("buildRender",function(e){var n=e.__currentTplName,r=e.__isSubController,i=e.__UK+"_",s=o(n),u=(r?i:"")+a(n),l,c=document.getElementById(s).innerHTML,d=t._buildRender(e,c,Handlebars);if(!(l=document.getElementById(u))){var f;f=e.__isSubController?a(e.getMain().__currentTplName):"_smr_runtime_wrapper",l=document.createElement("section"),l.id=u,document.getElementById(f).appendChild(l)}var p=l.innerHTML.match(/tpl-id=["'](T[^_]*)/);if(p){var h=new RegExp(p[1],"g");l.innerHTML=l.innerHTML.toString().replace(h,e.__UK)}else l.innerHTML=d.tplContent;return d}),t.__reg("getTplStatus",function(e){var t=o(e);return n[t]}),t.__reg("delTpl",function(e){var t=o(e);delete n[t]}),t.__reg("getTpl",function(e,t,i){var a=o(e),s=t.__UK+"_";if("undefined"!=typeof n[a])"loading"===n[a]?r[a].push(i):i();else{var u=Library.net;n[a]="loading",r[a]=new Array,r[a].push(i),u.get({url:sumeru.config.view.get("path")+a+".html",callback:function(e){n[a]="loaded";var t=document.createElement("script");t.id=a,t.type="text/x-sumeru-template",t.innerHTML=e,document.getElementById("_smr_runtime_wrapper").appendChild(t);for(var i=0;i<r[a].length;i++)r[a][i]()}})}},!0)}(sumeru);var COMMON_STATUS_CODE={1000:{code:"1000",msg:"METHOD UNSUPPORTED"},1001:{code:"1001",msg:"INVALID USERNAME OR PWD"},1002:{code:"1002",msg:"NEED VERIF CODE"},1003:{code:"1003",msg:"INVALID VERIF CODE"},1004:{code:"1004",msg:"INVAILD SESSION"},1005:{code:"1005",msg:"OLD_PWD === NEW_PWD"},2006:{code:"2006",msg:"MISSING CALLBACK"},2005:{code:"2005",msg:"DUPLICATE KEY"},2004:{code:"2004",msg:"SERVER ERROR"},2003:{code:"2003",msg:"MISSING PARAMS"},2001:{code:"2001",msg:"INVALID SESSION"},2000:{code:"2000",msg:"USER_TYPE UNSUPPORTED"}};"undefined"!=typeof module&&(module.exports=COMMON_STATUS_CODE),Model=Model||{},Model.smr_Authentication=function(e){e.config={fields:[{name:"clientId",type:"string"},{name:"token",type:"string",defaultValue:"guest"},{name:"userId",type:"string"},{name:"info",type:"object"},{name:"authMethod",type:"string"},{name:"expires",type:"int"},{name:"status",type:"string",defaultValue:"offline"},{name:"remoteAddr",type:"string"}],indexes:[{clientId:1},{expires:-1}]}},Model.smr_LocaleUser=function(e){e.config={fields:[{name:"userId",type:"string"},{name:"token",type:"string"},{name:"pwd",type:"string"},{name:"info",type:"object"},{name:"secretKey",type:"string"}],indexes:[{userId:1},{token:1,pwd:1}]}},function(e){if(!e.auth){var t=new e.utils.emitter,n=e.addSubPackage("auth"),r=t.emit;emit=function(){r.apply(t,arguments)},t.emit=function(){if(t.emit.caller!=t.addEventListener)throw"reject calls from outside";r.apply(t,arguments)};var i=e.netMessage,o=Library.cookie,a=new e.pubsub._pubsubObject,s=175200,u="not_login",l="doing_login",c="logined",d=u,f=null,p=null,h=function(){return d},g=function(){return f},_=function(){return p},m=function(t,n,r){var o="WAITING_CALLBACK_"+e.utils.randomStr(8);if(!r||"function"!=typeof r)throw COMMON_STATUS_CODE["2006"];i.setReceiver({onMessage:{target:o,overwrite:!0,once:!0,handle:function(e){"0"==e.code?r(null,e.content):r(COMMON_STATUS_CODE[e.code],e.content)}}}),i.sendMessage({cbn:o,content:t},n)};t.on("newListener",function(e,t){"statusChange"==e&&t.call(this,f,d,p)});var v=function(t,n,r){var i=["statusChange"];if(f=t,d!=n){switch(n){case c:p=r;break;case l:if(p)return e.dev("already logoin!"),void 0;case u:default:p=null}d=n;for(var o=0;o<arguments.length;o++)i.push(arguments[o]);emit.apply({},i)}},b=function(e,t,n,r){var i=arguments.length;if(4!=i)switch(i){case 3:r="local";break;case 2:r="local",n={};break;default:throw COMMON_STATUS_CODE["2003"]}v(null,l),setTimeout(function(){return e&&t?(m({token:e,pwd:t,type:r,args:n},"SMR_AUTH_EVENT_LOGIN",function(e){e?v(e,u):(o.addCookie("authMethod",r,s),I())}),void 0):(v(COMMON_STATUS_CODE["2003"],u),void 0)},0)},y=function(){authMethod=o.getCookie("authMethod"),d==c&&authMethod&&m({type:authMethod},"SMR_USER_EVENT_LOGOUT",function(e){v(e,u)})},S=function(e,t,n,r,i){return e&&t&&r?(m({type:r,token:e,pwd:t,userInfo:n||{}},"SMR_USER_EVENT_REGIST",i),void 0):(i(COMMON_STATUS_CODE["2003"]),void 0)},w=function(e,t,n){if(!n)throw COMMON_STATUS_CODE["2006"];return e&&t?(m({type:t,userInfo:e},"SMR_USER_EVENT_REGIST_TEST",n),void 0):(n(COMMON_STATUS_CODE["2003"]),void 0)},E=function(e,t,n,r,i){if(!i)throw COMMON_STATUS_CODE["2006"];return e&&t&&n&&r?t==n?(i(COMMON_STATUS_CODE["1005"],null),void 0):(m({token:e,oldPwd:t,newPwd:n,type:r},"SMR_USER_EVENT_MODIFY_PWD",i),void 0):(i(COMMON_STATUS_CODE["2003"],null),void 0)},T=function(e,t,n,r,i){if(!i){if("function"!=typeof r)throw COMMON_STATUS_CODE["2006"];i=r,r="local"}return e&&n&&t&&"object"==typeof n?(m({token:e,pwd:t,info:n,type:r},"SMR_USER_EVENT_MODIFY_INFO",i),void 0):(i(COMMON_STATUS_CODE["2003"],null),void 0)},I=function(t){var n=e.clientId,r=o.getCookie("authMethod");a.subscribe("auth-init",n,r,function(e){e&&e.length>0?v(null,c,e[0]):v(null,u,null),t&&t()})},M=function(){return console.warn("Deprecated : sumeru.auth.isLogin will be replaced by sumeru.auth.getStatus()"),"logined"==this.getStatus()},C=function(){return console.warn("Deprecated : sumeru.auth.isLogin will be replaced by sumeru.auth.getUserInfo()"),this.isLogin()?this.getUserInfo().token:null};e.utils.cpp(t,{login:b,logout:y,modifyUserInfo:T,modifyPassword:E,registerValidate:w,register:S,getStatus:h,getLastError:g,getUserInfo:_,isLogin:M,getToken:C}),n.__reg("create",function(e){return t}),n.__reg("init",I)}}(sumeru),Library.fileUploader=sumeru.Library.create(function(e){var t=function(e){this.fileName="defaultFile",this.extension="",this.fileSize=0,this.iPreviousBytesLoaded=0,this.iPercentComplete=0,this.routerPath="",this.form=null,this.target="",this.status=t.PENDING;var n=this;for(var r in e)this[r]=e[r];var i=sumeru.router.getRouterByPath(this.routerPath);if("file"!==i.type)throw"router matches type not file, fileuploader init failed!";this.max_size_allowed=i.max_size_allowed||0,this.file_ext_allowed=i.file_ext_allowed||"";var o=function(e){var t=e.target.files[0];if(this.max_size_allowed>0&&t.size>this.max_size_allowed)return n.onError("too big file"),void 0;var r=t.name.replace(/.*\./,"").toLowerCase(),i=!1;if(this.file_ext_allowed){i=!0;for(var o=0,a=this.file_ext_allowed;a>o;o++)this.file_ext_allowed[o].toLowerCase()==r&&(i=!1)}return 1==i?(n.onError("extention not allowed"),void 0):(this.fileSize=t.size,this.fileName=t.name,this.extension=r,!0)};this.form.querySelector("input[type='file']").addEventListener("change",function(){o.apply(n,arguments),n.fileSelect&&n.fileSelect.apply(n,arguments)})};return t.PENDING=0,t.UPLOADING=1,t.COMPLETE=3,t.ABORT=5,t.ERROR=6,t.prototype.startUpload=function(){var e=this;e.status=t.UPLOADING;var n=function(e){if(e.lengthComputable){var n=e.loaded,r=n-this.iPreviousBytesLoaded;if(0!=r){this.iPreviousBytesLoaded=n,r=2*r,this.iPercentComplete=Math.round(100*e.loaded/e.total),this.iBytesTransfered=t.bytesToSize(n);var i=this.fileSize-n;this.secondsRemaining=i/r;var o=r.toString()+"B/s";r>1048576?o=(Math.round(100*r/1048576)/100).toString()+"MB/s":r>1024&&(o=(Math.round(100*r/1024)/100).toString()+"KB/s"),this.iSpeed=o}}},r=new FormData(e.form),i=new XMLHttpRequest;i.upload.addEventListener("progress",function(){n.apply(e,arguments),e.onProgress&&e.onProgress.apply(e,arguments),e.status=t.UPLOADING},!1),i.addEventListener("load",function(n){try{var r=JSON.parse(n.target.responseText);r.errno?e.onError.call(e,r.data):e.onSuccess.call(e,r.data)}catch(i){e.onError.call(e,i.message)}e.status=t.COMPLETE},!1),i.addEventListener("error",function(){e.onError.apply(e,arguments),e.status=t.ERROR},!1),i.addEventListener("abort",function(){e.onAbort.apply(e,arguments),e.status=t.ABORT},!1),i.open("POST",e.routerPath),i.send(r)},t.prototype.onSuccess=function(e,t){},t.prototype.onAbort=function(e,t){},t.prototype.onError=function(e){fw.log("error ",e)},t.prototype.onComplete=function(e,t){},e.secondsToTime=t.secondsToTime=function(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),r=Math.floor(e-3600*t-60*n);return 10>t&&(t="0"+t),10>n&&(n="0"+n),10>r&&(r="0"+r),t&&(t="00"),t+":"+n+":"+r},e.bytesToSize=t.bytesToSize=function(e){var t=["Bytes","KB","MB","GB"];if(0==e)return"n/a";var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return(e/Math.pow(1024,n)).toFixed(1)+" "+t[n]},e.init=function(e){return new t(e)},e});